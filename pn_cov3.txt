============================= test session starts =============================
platform win32 -- Python 3.11.8, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Nemo\AppData\Local\Programs\Python\Python311\python.exe
cachedir: .pytest_cache
rootdir: D:\Projet_streamlit\assistant_matanne
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.1, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 85 items

tests/services/test_push_notifications.py::TestConfiguration::test_vapid_public_key_exists PASSED [  1%]
tests/services/test_push_notifications.py::TestConfiguration::test_vapid_email_format PASSED [  2%]
tests/services/test_push_notifications.py::TestNotificationType::test_stock_low PASSED [  3%]
tests/services/test_push_notifications.py::TestNotificationType::test_expiration_warning PASSED [  4%]
tests/services/test_push_notifications.py::TestNotificationType::test_expiration_critical PASSED [  5%]
tests/services/test_push_notifications.py::TestNotificationType::test_meal_reminder PASSED [  7%]
tests/services/test_push_notifications.py::TestNotificationType::test_activity_reminder PASSED [  8%]
tests/services/test_push_notifications.py::TestNotificationType::test_shopping_list_shared PASSED [  9%]
tests/services/test_push_notifications.py::TestNotificationType::test_shopping_list_updated PASSED [ 10%]
tests/services/test_push_notifications.py::TestNotificationType::test_milestone_reminder PASSED [ 11%]
tests/services/test_push_notifications.py::TestNotificationType::test_health_check_reminder PASSED [ 12%]
tests/services/test_push_notifications.py::TestNotificationType::test_system_update PASSED [ 14%]
tests/services/test_push_notifications.py::TestNotificationType::test_sync_complete PASSED [ 15%]
tests/services/test_push_notifications.py::TestPushSubscription::test_create_subscription PASSED [ 16%]
tests/services/test_push_notifications.py::TestPushSubscription::test_subscription_defaults PASSED [ 17%]
tests/services/test_push_notifications.py::TestPushSubscription::test_subscription_with_user_agent PASSED [ 18%]
tests/services/test_push_notifications.py::TestPushSubscription::test_subscription_inactive PASSED [ 20%]
tests/services/test_push_notifications.py::TestPushNotification::test_create_notification PASSED [ 21%]
tests/services/test_push_notifications.py::TestPushNotification::test_notification_defaults PASSED [ 22%]
tests/services/test_push_notifications.py::TestPushNotification::test_notification_with_type PASSED [ 23%]
tests/services/test_push_notifications.py::TestPushNotification::test_notification_with_custom_vibrate PASSED [ 24%]
tests/services/test_push_notifications.py::TestPushNotification::test_notification_with_actions PASSED [ 25%]
tests/services/test_push_notifications.py::TestPushNotification::test_notification_with_data PASSED [ 27%]
tests/services/test_push_notifications.py::TestPushNotification::test_notification_silent_mode PASSED [ 28%]
tests/services/test_push_notifications.py::TestNotificationPreferences::test_create_preferences PASSED [ 29%]
tests/services/test_push_notifications.py::TestNotificationPreferences::test_preferences_defaults PASSED [ 30%]
tests/services/test_push_notifications.py::TestNotificationPreferences::test_preferences_quiet_hours PASSED [ 31%]
tests/services/test_push_notifications.py::TestNotificationPreferences::test_preferences_custom_quiet_hours PASSED [ 32%]
tests/services/test_push_notifications.py::TestNotificationPreferences::test_preferences_max_per_hour PASSED [ 34%]
tests/services/test_push_notifications.py::TestNotificationPreferences::test_preferences_digest_mode PASSED [ 35%]
tests/services/test_push_notifications.py::TestNotificationPreferences::test_preferences_all_disabled PASSED [ 36%]
tests/services/test_push_notifications.py::TestPushNotificationService::test_init PASSED [ 37%]
tests/services/test_push_notifications.py::TestPushNotificationService::test_save_subscription PASSED [ 38%]
tests/services/test_push_notifications.py::TestPushNotificationService::test_save_subscription_duplicate PASSED [ 40%]
tests/services/test_push_notifications.py::TestPushNotificationService::test_remove_subscription PASSED [ 41%]
tests/services/test_push_notifications.py::TestPushNotificationService::test_remove_subscription_nonexistent_user PASSED [ 42%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_has_subscriptions_internal PASSED [ 43%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_has_preferences_internal PASSED [ 44%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_has_sent_count_internal PASSED [ 45%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_get_user_subscriptions_from_cache PASSED [ 47%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_get_user_subscriptions_from_db PASSED [ 48%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_get_preferences_creates_default PASSED [ 49%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_get_preferences_from_cache PASSED [ 50%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_update_preferences PASSED [ 51%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_should_send_returns_true PASSED [ 52%]
tests/services/test_push_notifications.py::TestPushNotificationServiceMethods::test_should_send_returns_false_disabled PASSED [ 54%]
tests/services/test_push_notifications.py::TestPushNotificationServiceNotifications::test_send_notification_no_subscriptions PASSED [ 55%]
tests/services/test_push_notifications.py::TestPushNotificationServiceNotifications::test_send_notification_preference_blocked PASSED [ 56%]
tests/services/test_push_notifications.py::TestPushNotificationServiceNotifications::test_send_notification_success PASSED [ 57%]
tests/services/test_push_notifications.py::TestPushNotificationServiceNotifications::test_send_notification_updates_count PASSED [ 58%]
tests/services/test_push_notifications.py::TestPushNotificationServiceNotifications::test_send_notification_handles_web_push_error PASSED [ 60%]
tests/services/test_push_notifications.py::TestPushNotificationServiceNotifications::test_send_notification_deactivates_on_410 PASSED [ 61%]
tests/services/test_push_notifications.py::TestPushNotificationServiceNotifications::test_send_to_all_users PASSED [ 62%]
tests/services/test_push_notifications.py::TestPushNotificationServicePredefinedNotifications::test_notify_stock_low PASSED [ 63%]
tests/services/test_push_notifications.py::TestPushNotificationServicePredefinedNotifications::test_notify_expiration_expired PASSED [ 64%]
tests/services/test_push_notifications.py::TestPushNotificationServicePredefinedNotifications::test_notify_expiration_tomorrow PASSED [ 65%]
tests/services/test_push_notifications.py::TestPushNotificationServicePredefinedNotifications::test_notify_expiration_critical PASSED [ 67%]
tests/services/test_push_notifications.py::TestPushNotificationServicePredefinedNotifications::test_notify_expiration_warning PASSED [ 68%]
tests/services/test_push_notifications.py::TestPushNotificationServicePredefinedNotifications::test_notify_meal_reminder PASSED [ 69%]
tests/services/test_push_notifications.py::TestPushNotificationServicePredefinedNotifications::test_notify_shopping_list_shared PASSED [ 70%]
tests/services/test_push_notifications.py::TestWebPushSending::test_send_web_push_import_error PASSED [ 71%]
tests/services/test_push_notifications.py::TestWebPushSending::test_send_web_push_success PASSED [ 72%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_get_supabase_client_not_configured PASSED [ 74%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_save_subscription_to_db_no_client PASSED [ 75%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_save_subscription_to_db_with_client PASSED [ 76%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_remove_subscription_from_db_no_client PASSED [ 77%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_remove_subscription_from_db_with_client PASSED [ 78%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_load_subscriptions_from_db_no_client PASSED [ 80%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_load_subscriptions_from_db_with_client PASSED [ 81%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_load_subscriptions_from_db_error PASSED [ 82%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_save_preferences_to_db_no_client PASSED [ 83%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_save_preferences_to_db_with_client PASSED [ 84%]
tests/services/test_push_notifications.py::TestSupabaseIntegration::test_save_preferences_to_db_error PASSED [ 85%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_sauvegarder_abonnement_db_nouveau_mocked PASSED [ 87%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_sauvegarder_abonnement_db_update_existing PASSED [ 88%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_lister_abonnements_utilisateur_mocked PASSED [ 89%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_lister_abonnements_utilisateur_vide PASSED [ 90%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_supprimer_abonnement_db_existe PASSED [ 91%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_supprimer_abonnement_db_inexistant PASSED [ 92%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_obtenir_preferences_db_existe PASSED [ 94%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_obtenir_preferences_db_inexistant PASSED [ 95%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_sauvegarder_preferences_db_nouveau PASSED [ 96%]
tests/services/test_push_notifications.py::TestSQLAlchemyMethods::test_sauvegarder_preferences_db_update PASSED [ 97%]
tests/services/test_push_notifications.py::TestFactory::test_get_push_notification_service PASSED [ 98%]
tests/services/test_push_notifications.py::TestFactory::test_get_push_notification_service_singleton PASSED [100%]

=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.11.8-final-0 _______________

Name                                 Stmts   Miss Branch BrPart   Cover   Missing
---------------------------------------------------------------------------------
src\services\push_notifications.py     320     50     54      1  85.29%   348->347, 392-394, 494-501, 532-533, 548-549, 792-886, 891-962
---------------------------------------------------------------------------------
TOTAL                                  320     50     54      1  85.29%
======================= 85 passed, 5 warnings in 1.57s ========================
