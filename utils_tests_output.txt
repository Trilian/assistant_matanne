============================= test session starts =============================
platform win32 -- Python 3.11.8, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Nemo\AppData\Local\Programs\Python\Python311\python.exe
cachedir: .pytest_cache
rootdir: D:\Projet_streamlit\assistant_matanne
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: anyio-4.12.1, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 165 items

tests/services/test_backup_utils.py::TestBackupId::test_generate_backup_id_default PASSED [  0%]
tests/services/test_backup_utils.py::TestBackupId::test_generate_backup_id_specific_date PASSED [  1%]
tests/services/test_backup_utils.py::TestBackupId::test_generate_backup_id_midnight PASSED [  1%]
tests/services/test_backup_utils.py::TestBackupId::test_parse_backup_id_valid PASSED [  2%]
tests/services/test_backup_utils.py::TestBackupId::test_parse_backup_id_invalid PASSED [  3%]
tests/services/test_backup_utils.py::TestBackupId::test_is_valid_backup_id PASSED [  3%]
tests/services/test_backup_utils.py::TestChecksum::test_calculate_checksum_simple PASSED [  4%]
tests/services/test_backup_utils.py::TestChecksum::test_calculate_checksum_deterministic PASSED [  4%]
tests/services/test_backup_utils.py::TestChecksum::test_calculate_checksum_different_data PASSED [  5%]
tests/services/test_backup_utils.py::TestChecksum::test_verify_checksum_valid PASSED [  6%]
tests/services/test_backup_utils.py::TestChecksum::test_verify_checksum_invalid PASSED [  6%]
tests/services/test_backup_utils.py::TestSerialization::test_serialize_value_datetime PASSED [  7%]
tests/services/test_backup_utils.py::TestSerialization::test_serialize_value_primitives PASSED [  7%]
tests/services/test_backup_utils.py::TestSerialization::test_deserialize_value_datetime PASSED [  8%]
tests/services/test_backup_utils.py::TestSerialization::test_deserialize_value_non_datetime PASSED [  9%]
tests/services/test_backup_utils.py::TestSerialization::test_model_to_dict_simple PASSED [  9%]
tests/services/test_backup_utils.py::TestValidation::test_validate_backup_structure_valid PASSED [ 10%]
tests/services/test_backup_utils.py::TestValidation::test_validate_backup_structure_missing_metadata PASSED [ 10%]
tests/services/test_backup_utils.py::TestValidation::test_validate_backup_structure_missing_data PASSED [ 11%]
tests/services/test_backup_utils.py::TestValidation::test_validate_backup_structure_not_dict PASSED [ 12%]
tests/services/test_backup_utils.py::TestValidation::test_validate_backup_metadata_valid PASSED [ 12%]
tests/services/test_backup_utils.py::TestValidation::test_validate_backup_metadata_missing_id PASSED [ 13%]
tests/services/test_backup_utils.py::TestFileUtils::test_is_compressed_file_gz PASSED [ 13%]
tests/services/test_backup_utils.py::TestFileUtils::test_is_compressed_file_json PASSED [ 14%]
tests/services/test_backup_utils.py::TestFileUtils::test_get_backup_filename_compressed PASSED [ 15%]
tests/services/test_backup_utils.py::TestFileUtils::test_get_backup_filename_uncompressed PASSED [ 15%]
tests/services/test_backup_utils.py::TestFileUtils::test_parse_backup_filename_compressed PASSED [ 16%]
tests/services/test_backup_utils.py::TestFileUtils::test_parse_backup_filename_uncompressed PASSED [ 16%]
tests/services/test_backup_utils.py::TestFileUtils::test_parse_backup_filename_invalid PASSED [ 17%]
tests/services/test_backup_utils.py::TestFileUtils::test_format_file_size_bytes PASSED [ 18%]
tests/services/test_backup_utils.py::TestFileUtils::test_format_file_size_kb PASSED [ 18%]
tests/services/test_backup_utils.py::TestFileUtils::test_format_file_size_mb PASSED [ 19%]
tests/services/test_backup_utils.py::TestFileUtils::test_format_file_size_gb PASSED [ 20%]
tests/services/test_backup_utils.py::TestRestoreOrder::test_get_restore_order_returns_list PASSED [ 20%]
tests/services/test_backup_utils.py::TestRestoreOrder::test_get_restore_order_ingredients_first PASSED [ 21%]
tests/services/test_backup_utils.py::TestRestoreOrder::test_get_restore_order_recettes_before_repas PASSED [ 21%]
tests/services/test_backup_utils.py::TestRestoreOrder::test_filter_and_order_tables PASSED [ 22%]
tests/services/test_backup_utils.py::TestRestoreOrder::test_filter_and_order_tables_unknown PASSED [ 23%]
tests/services/test_backup_utils.py::TestBackupStats::test_calculate_backup_stats PASSED [ 23%]
tests/services/test_backup_utils.py::TestBackupStats::test_calculate_backup_stats_empty PASSED [ 24%]
tests/services/test_backup_utils.py::TestBackupStats::test_compare_backup_stats_identical PASSED [ 24%]
tests/services/test_backup_utils.py::TestBackupStats::test_compare_backup_stats_different PASSED [ 25%]
tests/services/test_backup_utils.py::TestRotation::test_get_backups_to_rotate_under_limit PASSED [ 26%]
tests/services/test_backup_utils.py::TestRotation::test_get_backups_to_rotate_over_limit PASSED [ 26%]
tests/services/test_backup_utils.py::TestRotation::test_should_run_backup_first_time PASSED [ 27%]
tests/services/test_backup_utils.py::TestRotation::test_should_run_backup_interval_passed PASSED [ 27%]
tests/services/test_backup_utils.py::TestRotation::test_should_run_backup_interval_not_passed PASSED [ 28%]
tests/services/test_backup_utils.py::TestEdgeCases::test_empty_data_serialization PASSED [ 29%]
tests/services/test_backup_utils.py::TestEdgeCases::test_unicode_checksum PASSED [ 29%]
tests/services/test_backup_utils.py::TestEdgeCases::test_deserialize_value_with_z_timezone PASSED [ 30%]
tests/services/test_backup_utils.py::TestEdgeCases::test_format_file_size_zero PASSED [ 30%]
tests/services/test_backup_utils.py::TestEdgeCases::test_validate_backup_structure_nested_invalid PASSED [ 31%]
tests/services/test_backup_utils.py::TestPerformance::test_checksum_performance PASSED [ 32%]
tests/services/test_backup_utils.py::TestPerformance::test_filter_and_order_performance PASSED [ 32%]
tests/services/test_push_notifications_utils.py::TestNotificationTypeMapping::test_get_notification_type_mapping_returns_dict PASSED [ 33%]
tests/services/test_push_notifications_utils.py::TestNotificationTypeMapping::test_get_notification_type_mapping_all_types PASSED [ 33%]
tests/services/test_push_notifications_utils.py::TestCheckNotificationTypeEnabled::test_type_enabled PASSED [ 34%]
tests/services/test_push_notifications_utils.py::TestCheckNotificationTypeEnabled::test_type_disabled PASSED [ 35%]
tests/services/test_push_notifications_utils.py::TestCheckNotificationTypeEnabled::test_type_not_in_prefs_defaults_true PASSED [ 35%]
tests/services/test_push_notifications_utils.py::TestCheckNotificationTypeEnabled::test_string_type PASSED [ 36%]
tests/services/test_push_notifications_utils.py::TestCheckNotificationTypeEnabled::test_unknown_string_type PASSED [ 36%]
tests/services/test_push_notifications_utils.py::TestQuietHours::test_is_quiet_hours_during_quiet PASSED [ 37%]
tests/services/test_push_notifications_utils.py::TestQuietHours::test_is_quiet_hours_outside_quiet PASSED [ 38%]
tests/services/test_push_notifications_utils.py::TestQuietHours::test_is_quiet_hours_no_quiet PASSED [ 38%]
tests/services/test_push_notifications_utils.py::TestQuietHours::test_is_quiet_hours_same_day_range PASSED [ 39%]
tests/services/test_push_notifications_utils.py::TestQuietHours::test_is_quiet_hours_invalid_hour PASSED [ 40%]
tests/services/test_push_notifications_utils.py::TestQuietHours::test_can_send_during_quiet_hours_critical PASSED [ 40%]
tests/services/test_push_notifications_utils.py::TestQuietHours::test_can_send_during_quiet_hours_normal PASSED [ 41%]
tests/services/test_push_notifications_utils.py::TestShouldSendNotification::test_should_send_normal_case PASSED [ 41%]
tests/services/test_push_notifications_utils.py::TestShouldSendNotification::test_should_send_type_disabled PASSED [ 42%]
tests/services/test_push_notifications_utils.py::TestShouldSendNotification::test_should_send_quiet_hours PASSED [ 43%]
tests/services/test_push_notifications_utils.py::TestShouldSendNotification::test_should_send_critical_during_quiet PASSED [ 43%]
tests/services/test_push_notifications_utils.py::TestShouldSendNotification::test_should_send_limit_reached PASSED [ 44%]
tests/services/test_push_notifications_utils.py::TestBuildPayload::test_build_push_payload_basic PASSED [ 44%]
tests/services/test_push_notifications_utils.py::TestBuildPayload::test_build_push_payload_with_actions PASSED [ 45%]
tests/services/test_push_notifications_utils.py::TestBuildPayload::test_build_push_payload_with_timestamp PASSED [ 46%]
tests/services/test_push_notifications_utils.py::TestBuildPayload::test_build_subscription_info PASSED [ 46%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_stock_notification PASSED [ 47%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_stock_notification_without_unit PASSED [ 47%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_expiration_notification_expired PASSED [ 48%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_expiration_notification_tomorrow PASSED [ 49%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_expiration_notification_warning PASSED [ 49%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_meal_reminder_notification PASSED [ 50%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_shopping_shared_notification PASSED [ 50%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_activity_reminder_notification PASSED [ 51%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_activity_reminder_without_location PASSED [ 52%]
tests/services/test_push_notifications_utils.py::TestCreateNotifications::test_create_milestone_reminder_notification PASSED [ 52%]
tests/services/test_push_notifications_utils.py::TestCounterUtils::test_generate_count_key PASSED [ 53%]
tests/services/test_push_notifications_utils.py::TestCounterUtils::test_generate_count_key_default_time PASSED [ 53%]
tests/services/test_push_notifications_utils.py::TestCounterUtils::test_parse_count_key_valid PASSED [ 54%]
tests/services/test_push_notifications_utils.py::TestCounterUtils::test_parse_count_key_invalid FAILED [ 55%]
tests/services/test_push_notifications_utils.py::TestCounterUtils::test_should_reset_counter_same_hour PASSED [ 55%]
tests/services/test_push_notifications_utils.py::TestCounterUtils::test_should_reset_counter_new_hour PASSED [ 56%]
tests/services/test_push_notifications_utils.py::TestValidation::test_validate_subscription_valid PASSED [ 56%]
tests/services/test_push_notifications_utils.py::TestValidation::test_validate_subscription_no_endpoint PASSED [ 57%]
tests/services/test_push_notifications_utils.py::TestValidation::test_validate_subscription_http_endpoint PASSED [ 58%]
tests/services/test_push_notifications_utils.py::TestValidation::test_validate_subscription_missing_keys PASSED [ 58%]
tests/services/test_push_notifications_utils.py::TestValidation::test_validate_preferences_valid PASSED [ 59%]
tests/services/test_push_notifications_utils.py::TestValidation::test_validate_preferences_invalid_hours PASSED [ 60%]
tests/services/test_push_notifications_utils.py::TestValidation::test_validate_preferences_low_max_per_hour PASSED [ 60%]
tests/services/test_push_notifications_utils.py::TestEdgeCases::test_notification_with_special_characters PASSED [ 61%]
tests/services/test_push_notifications_utils.py::TestEdgeCases::test_empty_preferences PASSED [ 61%]
tests/services/test_push_notifications_utils.py::TestEdgeCases::test_payload_with_empty_data PASSED [ 62%]
tests/services/test_push_notifications_utils.py::TestEdgeCases::test_quiet_hours_edge_midnight PASSED [ 63%]
tests/services/test_push_notifications_utils.py::TestEdgeCases::test_expiration_exactly_today PASSED [ 63%]
tests/services/test_push_notifications_utils.py::TestNotificationTypeEnum::test_notification_types_values PASSED [ 64%]
tests/services/test_push_notifications_utils.py::TestNotificationTypeEnum::test_notification_type_from_string PASSED [ 64%]
tests/services/test_push_notifications_utils.py::TestNotificationTypeEnum::test_notification_type_invalid_string PASSED [ 65%]
tests/services/test_planning_utils.py::TestWeekdayNames::test_get_weekday_names_returns_7_days PASSED [ 66%]
tests/services/test_planning_utils.py::TestWeekdayNames::test_get_weekday_names_returns_copy PASSED [ 66%]
tests/services/test_planning_utils.py::TestWeekdayNames::test_get_weekday_name_valid_index PASSED [ 67%]
tests/services/test_planning_utils.py::TestWeekdayNames::test_get_weekday_name_invalid_index PASSED [ 67%]
tests/services/test_planning_utils.py::TestWeekdayNames::test_get_weekday_index_valid PASSED [ 68%]
tests/services/test_planning_utils.py::TestWeekdayNames::test_get_weekday_index_invalid PASSED [ 69%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_calculate_week_dates_returns_7_dates PASSED [ 69%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_calculate_week_dates_consecutive PASSED [ 70%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_calculate_week_dates_starts_correctly PASSED [ 70%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_get_week_range PASSED [ 71%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_get_monday_of_week_already_monday PASSED [ 72%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_get_monday_of_week_from_thursday PASSED [ 72%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_get_monday_of_week_from_sunday PASSED [ 73%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_get_monday_of_week_datetime PASSED [ 73%]
tests/services/test_planning_utils.py::TestCalculateWeekDates::test_format_week_label PASSED [ 74%]
tests/services/test_planning_utils.py::TestProteinType::test_determine_protein_type_poisson PASSED [ 75%]
tests/services/test_planning_utils.py::TestProteinType::test_determine_protein_type_viande_rouge PASSED [ 75%]
tests/services/test_planning_utils.py::TestProteinType::test_determine_protein_type_vegetarien PASSED [ 76%]
tests/services/test_planning_utils.py::TestProteinType::test_determine_protein_type_default_volaille PASSED [ 76%]
tests/services/test_planning_utils.py::TestProteinType::test_get_default_protein_schedule PASSED [ 77%]
tests/services/test_planning_utils.py::TestWeekBalance::test_calculate_week_balance PASSED [ 78%]
tests/services/test_planning_utils.py::TestWeekBalance::test_calculate_week_balance_empty PASSED [ 78%]
tests/services/test_planning_utils.py::TestWeekBalance::test_calculate_week_balance_with_keywords PASSED [ 79%]
tests/services/test_planning_utils.py::TestWeekBalance::test_is_balanced_week_valid PASSED [ 80%]
tests/services/test_planning_utils.py::TestWeekBalance::test_is_balanced_week_not_enough_fish PASSED [ 80%]
tests/services/test_planning_utils.py::TestWeekBalance::test_is_balanced_week_too_much_red_meat PASSED [ 81%]
tests/services/test_planning_utils.py::TestMealFormatting::test_format_meal_for_display PASSED [ 81%]
tests/services/test_planning_utils.py::TestMealFormatting::test_format_meal_for_display_with_emoji PASSED [ 82%]
tests/services/test_planning_utils.py::TestMealFormatting::test_format_meal_for_display_fallback_to_notes PASSED [ 83%]
tests/services/test_planning_utils.py::TestMealFormatting::test_format_planning_summary PASSED [ 83%]
tests/services/test_planning_utils.py::TestMealFormatting::test_group_meals_by_type PASSED [ 84%]
tests/services/test_planning_utils.py::TestIngredientAggregation::test_aggregate_ingredients_basic PASSED [ 84%]
tests/services/test_planning_utils.py::TestIngredientAggregation::test_aggregate_ingredients_different_units PASSED [ 85%]
tests/services/test_planning_utils.py::TestIngredientAggregation::test_aggregate_ingredients_empty_name PASSED [ 86%]
tests/services/test_planning_utils.py::TestIngredientAggregation::test_sort_ingredients_by_rayon PASSED [ 86%]
tests/services/test_planning_utils.py::TestIngredientAggregation::test_sort_ingredients_by_rayon_list_input PASSED [ 87%]
tests/services/test_planning_utils.py::TestIngredientAggregation::test_get_rayon_order PASSED [ 87%]
tests/services/test_planning_utils.py::TestValidation::test_validate_planning_dates_valid PASSED [ 88%]
tests/services/test_planning_utils.py::TestValidation::test_validate_planning_dates_wrong_order PASSED [ 89%]
tests/services/test_planning_utils.py::TestValidation::test_validate_planning_dates_not_7_days PASSED [ 89%]
tests/services/test_planning_utils.py::TestValidation::test_validate_planning_dates_not_monday PASSED [ 90%]
tests/services/test_planning_utils.py::TestValidation::test_validate_meal_selection_valid PASSED [ 90%]
tests/services/test_planning_utils.py::TestValidation::test_validate_meal_selection_missing_recipe PASSED [ 91%]
tests/services/test_planning_utils.py::TestAIPrompt::test_build_planning_prompt_context_basic PASSED [ 92%]
tests/services/test_planning_utils.py::TestAIPrompt::test_build_planning_prompt_context_with_preferences PASSED [ 92%]
tests/services/test_planning_utils.py::TestAIPrompt::test_build_planning_prompt_context_with_constraints PASSED [ 93%]
tests/services/test_planning_utils.py::TestAIPrompt::test_parse_ai_planning_response PASSED [ 93%]
tests/services/test_planning_utils.py::TestAIPrompt::test_parse_ai_planning_response_normalize_day PASSED [ 94%]
tests/services/test_planning_utils.py::TestAIPrompt::test_parse_ai_planning_response_missing_fields PASSED [ 95%]
tests/services/test_planning_utils.py::TestConstants::test_jours_semaine_constant PASSED [ 95%]
tests/services/test_planning_utils.py::TestConstants::test_types_repas_constant PASSED [ 96%]
tests/services/test_planning_utils.py::TestConstants::test_types_proteines_constant PASSED [ 96%]
tests/services/test_planning_utils.py::TestEdgeCases::test_aggregate_ingredients_null_quantity PASSED [ 97%]
tests/services/test_planning_utils.py::TestEdgeCases::test_format_meal_unknown_type PASSED [ 98%]
tests/services/test_planning_utils.py::TestEdgeCases::test_calculate_week_dates_across_month PASSED [ 98%]
tests/services/test_planning_utils.py::TestEdgeCases::test_calculate_week_dates_across_year PASSED [ 99%]
tests/services/test_planning_utils.py::TestEdgeCases::test_empty_planning_summary PASSED [100%]

================================== FAILURES ===================================
E   AssertionError: assert 'no' == 'no_underscore'
      
      - no_underscore
      + no
---------------------------- Captured stdout setup ----------------------------
[32mINFO[0m | src.core.cache            | Cache cleared
---------------------------- Captured stderr setup ----------------------------
2026-02-08 11:58:09.922 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.923 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
2026-02-08 11:58:09.924 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.
----------------------------- Captured log setup ------------------------------
INFO     src.core.cache:cache.py:164 Cache cleared
D:\Projet_streamlit\assistant_matanne\tests\services\test_push_notifications_utils.py:431: AssertionError: assert 'no' == 'no_underscore'
=========================== short test summary info ===========================
FAILED tests/services/test_push_notifications_utils.py::TestCounterUtils::test_parse_count_key_invalid - AssertionError: assert 'no' == 'no_underscore'
  
  - no_underscore
  + no
================== 1 failed, 164 passed, 5 warnings in 3.01s ==================
