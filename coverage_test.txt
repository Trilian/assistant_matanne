============================= test session starts =============================
platform win32 -- Python 3.11.8, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Nemo\AppData\Local\Programs\Python\Python311\python.exe
cachedir: .pytest_cache
rootdir: D:\Projet_streamlit\assistant_matanne
configfile: pytest.ini
plugins: anyio-4.12.1, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 98 items

tests/core/test_lazy_loader.py::test_import_lazy_loader PASSED           [  1%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereCharger::test_charger_module_existant PASSED [  2%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereCharger::test_charger_module_cache_hit PASSED [  3%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereCharger::test_charger_module_reload_force PASSED [  4%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereCharger::test_charger_module_inexistant PASSED [  5%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereCharger::test_charger_enregistre_temps PASSED [  6%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereCharger::test_charger_alias_load PASSED [  7%]
tests/core/test_lazy_loader.py::TestChargeurModuleDifferePrecharger::test_precharger_synchrone PASSED [  8%]
tests/core/test_lazy_loader.py::TestChargeurModuleDifferePrecharger::test_precharger_background PASSED [  9%]
tests/core/test_lazy_loader.py::TestChargeurModuleDifferePrecharger::test_precharger_module_inexistant_ne_propage_pas_erreur PASSED [ 10%]
tests/core/test_lazy_loader.py::TestChargeurModuleDifferePrecharger::test_precharger_alias_preload PASSED [ 11%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereStatistiques::test_obtenir_statistiques_vide PASSED [ 12%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereStatistiques::test_obtenir_statistiques_avec_modules PASSED [ 13%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereStatistiques::test_alias_get_stats PASSED [ 14%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereViderCache::test_vider_cache PASSED [ 15%]
tests/core/test_lazy_loader.py::TestChargeurModuleDiffereViderCache::test_alias_clear_cache PASSED [ 16%]
tests/core/test_lazy_loader.py::TestLazyImportDecorator::test_lazy_import_sans_attr_name PASSED [ 17%]
tests/core/test_lazy_loader.py::TestLazyImportDecorator::test_lazy_import_avec_attr_name PASSED [ 18%]
tests/core/test_lazy_loader.py::TestLazyImportDecorator::test_lazy_import_charge_module PASSED [ 19%]
tests/core/test_lazy_loader.py::TestRouteurOptimise::test_class_exists PASSED [ 20%]
tests/core/test_lazy_loader.py::TestRouteurOptimise::test_has_module_registry PASSED [ 21%]
tests/core/test_lazy_loader.py::TestRouteurOptimise::test_module_registry_contient_accueil PASSED [ 22%]
tests/core/test_lazy_loader.py::TestRouteurOptimise::test_module_registry_structure PASSED [ 23%]
tests/core/test_lazy_loader.py::TestRouteurOptimise::test_charger_module_inexistant PASSED [ 24%]
tests/core/test_lazy_loader.py::TestRouteurOptimise::test_class_instantiable PASSED [ 25%]
tests/core/test_lazy_loader.py::TestAfficherStats::test_afficher_stats_charge_modules PASSED [ 26%]
tests/core/test_lazy_loader.py::TestIntegrationLazyLoader::test_workflow_complet PASSED [ 27%]
tests/core/test_lazy_loader.py::TestIntegrationLazyLoader::test_thread_safety_basique PASSED [ 28%]
tests/core/test_decorators.py::TestAvecSessionDb::test_decorator_preserves_function_name PASSED [ 29%]
tests/core/test_decorators.py::TestAvecSessionDb::test_decorator_preserves_docstring PASSED [ 30%]
tests/core/test_decorators.py::TestAvecSessionDb::test_accepts_explicit_db_session PASSED [ 31%]
tests/core/test_decorators.py::TestAvecSessionDb::test_accepts_explicit_session_param PASSED [ 32%]
tests/core/test_decorators.py::TestAvecSessionDb::test_works_with_positional_args PASSED [ 33%]
tests/core/test_decorators.py::TestAvecSessionDb::test_works_with_kwargs PASSED [ 34%]
tests/core/test_decorators.py::TestAvecSessionDb::test_callable PASSED   [ 35%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_stores_result PASSED [ 36%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_retrieves_from_cache PASSED [ 37%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_respects_ttl PASSED [ 38%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_uses_custom_key_func PASSED [ 39%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_uses_key_prefix PASSED [ 40%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_excludes_db_from_key PASSED [ 41%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_different_keys PASSED [ 42%]
tests/core/test_decorators.py::TestAvecCache::test_with_cache_key_func_with_defaults PASSED [ 43%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_catches_errors PASSED [ 44%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_returns_fallback_on_error PASSED [ 45%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_returns_successful_value PASSED [ 46%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_catches_all_exceptions PASSED [ 47%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_reraises_exception_app PASSED [ 48%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_logs_with_specified_level PASSED [ 50%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_afficher_erreur_option PASSED [ 51%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_preserves_function_metadata PASSED [ 52%]
tests/core/test_decorators.py::TestAvecGestionErreurs::test_with_complex_default_return PASSED [ 53%]
tests/core/test_decorators.py::TestAvecValidation::test_validation_passes PASSED [ 54%]
tests/core/test_decorators.py::TestAvecValidation::test_validation_fails_with_invalid_data PASSED [ 55%]
tests/core/test_decorators.py::TestAvecValidation::test_validation_without_field_mapping PASSED [ 56%]
tests/core/test_decorators.py::TestDecoratorStacking::test_cache_and_error_handling_stack PASSED [ 57%]
tests/core/test_decorators.py::TestDecoratorStacking::test_all_decorators_stacked PASSED [ 58%]
tests/core/test_decorators.py::TestEdgeCases::test_decorator_with_generator PASSED [ 59%]
tests/core/test_decorators.py::TestEdgeCases::test_decorator_with_async_like_behavior PASSED [ 60%]
tests/core/test_decorators.py::TestEdgeCases::test_cache_with_mutable_args PASSED [ 61%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAParseDirecte::test_parse_json_propre PASSED [ 62%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAParseDirecte::test_parse_json_avec_espaces PASSED [ 63%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAParseDirecte::test_parse_json_multilignes PASSED [ 64%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAExtractionJSON::test_extraction_json_dans_texte PASSED [ 65%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAExtractionJSON::test_extraction_json_avec_markdown PASSED [ 66%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAExtractionJSON::test_extraction_json_imbriquÚ PASSED [ 67%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAReparation::test_reparation_trailing_comma PASSED [ 68%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAReparation::test_reparation_python_booleans PASSED [ 69%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAReparation::test_reparation_simple_quotes PASSED [ 70%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAReparation::test_reparation_cles_sans_guillemets PASSED [ 71%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAFallback::test_fallback_avec_valeur_secours PASSED [ 72%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAFallback::test_strict_mode_leve_exception PASSED [ 73%]
tests/core/ai/test_ai_parser.py::TestAnalyseurIAFallback::test_sans_fallback_ni_strict_leve_exception PASSED [ 74%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_nettoyer_basique_bom PASSED [ 75%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_nettoyer_basique_caracteres_control PASSED [ 76%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_nettoyer_basique_markdown_json PASSED [ 77%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_extraire_objet_json_simple PASSED [ 78%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_extraire_objet_json_array PASSED [ 79%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_extraire_objet_json_imbrique PASSED [ 80%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_extraire_objet_json_pas_de_json PASSED [ 81%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_reparer_intelligemment_python_none PASSED [ 82%]
tests/core/ai/test_ai_parser.py::TestMethodesPrivees::test_reparer_intelligemment_python_true_false PASSED [ 83%]
tests/core/ai/test_ai_parser.py::TestAnalysePartielle::test_analyser_partiel_extrait_champs PASSED [ 84%]
tests/core/ai/test_ai_parser.py::TestAnalysePartielle::test_analyser_partiel_retourne_none_si_rien PASSED [ 85%]
tests/core/ai/test_ai_parser.py::TestAnalyserListeReponse::test_parse_liste_directe PASSED [ 86%]
tests/core/ai/test_ai_parser.py::TestAnalyserListeReponse::test_parse_liste_avec_cle PASSED [ 87%]
tests/core/ai/test_ai_parser.py::TestAnalyserListeReponse::test_parse_liste_dans_markdown PASSED [ 88%]
tests/core/ai/test_ai_parser.py::TestAnalyserListeReponse::test_fallback_items_secours PASSED [ 89%]
tests/core/ai/test_ai_parser.py::TestAnalyserListeReponse::test_retourne_liste_vide_si_echec_total PASSED [ 90%]
tests/core/ai/test_ai_parser.py::TestAnalyserListeReponse::test_parse_liste_objets_complexes PASSED [ 91%]
tests/core/ai/test_ai_parser.py::TestEdgeCases::test_json_vide PASSED    [ 92%]
tests/core/ai/test_ai_parser.py::TestEdgeCases::test_json_unicode PASSED [ 93%]
tests/core/ai/test_ai_parser.py::TestEdgeCases::test_json_emoji PASSED   [ 94%]
tests/core/ai/test_ai_parser.py::TestEdgeCases::test_json_tres_long PASSED [ 95%]
tests/core/ai/test_ai_parser.py::TestEdgeCases::test_liste_vide PASSED   [ 96%]
tests/core/ai/test_ai_parser.py::TestEdgeCases::test_json_avec_nulls PASSED [ 97%]
tests/core/ai/test_ai_parser.py::TestIntegration::test_workflow_complet_objet PASSED [ 98%]
tests/core/ai/test_ai_parser.py::TestIntegration::test_workflow_complet_liste PASSED [100%]

=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.11.8-final-0 _______________

Name                                  Stmts   Miss Branch BrPart   Cover
------------------------------------------------------------------------
src\core\__init__.py                     20      0      0      0 100.00%
src\core\ai\__init__.py                   6      0      0      0 100.00%
src\core\ai\cache.py                     67     21      6      0  65.75%
src\core\ai\client.py                   152     57     44      7  60.20%
src\core\ai\parser.py                   174     35     52      7  77.88%
src\core\ai\rate_limit.py                58      5     14      1  91.67%
src\core\ai_agent.py                     37      0      4      0 100.00%
src\core\cache.py                       208     34     64      8  83.09%
src\core\cache_multi.py                 343     62     92     15  78.62%
src\core\config.py                      193     97     50      6  46.91%
src\core\constants.py                   214      6      0      0  97.20%
src\core\database.py                    192     70     18      2  61.90%
src\core\decorators.py                  103     26     30      2  65.41%
src\core\errors.py                      131     62     60      9  46.07%
src\core\errors_base.py                  40      0      8      0 100.00%
src\core\lazy_loader.py                 120     31     24      3  72.22%
src\core\logging.py                      95      0     24      3  97.48%
src\core\models\__init__.py              15      0      0      0 100.00%
src\core\models\base.py                  28      1      0      0  96.43%
src\core\models\batch_cooking.py        141     14      4      0  87.59%
src\core\models\courses.py               61      1      2      1  96.83%
src\core\models\famille.py               82      0      0      0 100.00%
src\core\models\inventaire.py            49      3      2      1  92.16%
src\core\models\jeux.py                 177     13      4      0  90.61%
src\core\models\maison.py                72      0      0      0 100.00%
src\core\models\maison_extended.py      169      2      0      0  98.82%
src\core\models\nouveaux.py             171      1      0      0  99.42%
src\core\models\planning.py              43      1      2      1  95.56%
src\core\models\recettes.py             156     30     24      1  70.56%
src\core\models\sante.py                 54      0      0      0 100.00%
src\core\models\user_preferences.py      80      2      2      1  96.34%
src\core\models\users.py                188      8      2      0  94.74%
src\core\multi_tenant.py                174     70     42      1  54.17%
src\core\offline.py                     268    185     62      0  25.15%
src\core\performance.py                 299    209     54      0  25.50%
src\core\redis_cache.py                 262    141     68      8  44.55%
src\core\sql_optimizer.py               248    101     80     14  53.35%
src\core\state.py                       168     14     34     10  88.12%
src\core\validation.py                  391     61    134     23  80.95%
------------------------------------------------------------------------
TOTAL                                  5449   1363   1006    124  70.77%
============================= 98 passed in 7.91s ==============================
