============================= test session starts =============================
platform win32 -- Python 3.11.8, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\Nemo\AppData\Local\Programs\Python\Python311\python.exe
cachedir: .pytest_cache
rootdir: D:\Projet_streamlit\assistant_matanne
configfile: pytest.ini
plugins: anyio-4.12.1, asyncio-1.3.0, cov-7.0.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 203 items

tests/services/backup/test_service.py::TestServiceBackupInit::test_init_with_default_config PASSED [  0%]
tests/services/backup/test_service.py::TestServiceBackupInit::test_init_with_custom_config PASSED [  0%]
tests/services/backup/test_service.py::TestServiceBackupInit::test_ensure_backup_dir_creates_directory PASSED [  1%]
tests/services/backup/test_service.py::TestServiceBackupInit::test_ensure_backup_dir_existing_directory PASSED [  1%]
tests/services/backup/test_service.py::TestServiceBackupInit::test_models_to_backup_exists PASSED [  2%]
tests/services/backup/test_service.py::TestServiceBackupInit::test_models_to_backup_contains_expected_tables PASSED [  2%]
tests/services/backup/test_service.py::TestStaticMethods::test_generate_backup_id PASSED [  3%]
tests/services/backup/test_service.py::TestStaticMethods::test_calculate_checksum PASSED [  3%]
tests/services/backup/test_service.py::TestStaticMethods::test_model_to_dict_with_columns PASSED [  4%]
tests/services/backup/test_service.py::TestListBackups::test_list_empty_directory PASSED [  4%]
tests/services/backup/test_service.py::TestListBackups::test_list_with_backups PASSED [  5%]
tests/services/backup/test_service.py::TestListBackups::test_list_sorted_by_date PASSED [  5%]
tests/services/backup/test_service.py::TestListBackups::test_list_ignores_non_backup_files PASSED [  6%]
tests/services/backup/test_service.py::TestListBackups::test_list_detects_compression PASSED [  6%]
tests/services/backup/test_service.py::TestDeleteBackup::test_delete_existing_backup PASSED [  7%]
tests/services/backup/test_service.py::TestDeleteBackup::test_delete_nonexistent_backup PASSED [  7%]
tests/services/backup/test_service.py::TestDeleteBackup::test_delete_compressed_backup PASSED [  8%]
tests/services/backup/test_service.py::TestRotateOldBackups::test_rotate_under_limit PASSED [  8%]
tests/services/backup/test_service.py::TestRotateOldBackups::test_rotate_at_limit PASSED [  9%]
tests/services/backup/test_service.py::TestRotateOldBackups::test_rotate_over_limit PASSED [  9%]
tests/services/backup/test_service.py::TestGetBackupInfo::test_get_info_nonexistent_file PASSED [ 10%]
tests/services/backup/test_service.py::TestGetBackupInfo::test_get_info_json_file PASSED [ 10%]
tests/services/backup/test_service.py::TestGetBackupInfo::test_get_info_compressed_file PASSED [ 11%]
tests/services/backup/test_service.py::TestGetBackupInfo::test_get_info_file_exists_check PASSED [ 11%]
tests/services/backup/test_service.py::TestGetBackupInfo::test_get_info_returns_metadata_type PASSED [ 12%]
tests/services/backup/test_service.py::TestCreateBackupMocked::test_create_backup_structure PASSED [ 12%]
tests/services/backup/test_service.py::TestCreateBackupMocked::test_create_backup_compressed PASSED [ 13%]
tests/services/backup/test_service.py::TestCreateBackupMocked::test_create_backup_metadata PASSED [ 13%]
tests/services/backup/test_service.py::TestCreateBackupMocked::test_create_backup_unknown_table PASSED [ 14%]
tests/services/backup/test_service.py::TestRestoreBackupMocked::test_restore_file_not_found PASSED [ 14%]
tests/services/backup/test_service.py::TestRestoreBackupMocked::test_restore_invalid_format PASSED [ 15%]
tests/services/backup/test_service.py::TestRestoreBackupMocked::test_restore_json_file PASSED [ 15%]
tests/services/backup/test_service.py::TestRestoreBackupMocked::test_restore_compressed_file PASSED [ 16%]
tests/services/backup/test_service.py::TestRestoreBackupMocked::test_restore_with_clear_existing PASSED [ 16%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_upload_to_supabase_not_configured PASSED [ 17%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_upload_to_supabase_success PASSED [ 17%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_upload_to_supabase_error_handling PASSED [ 18%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_download_from_supabase_success PASSED [ 18%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_download_from_supabase_error PASSED [ 19%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_upload_method_exists PASSED [ 19%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_download_method_exists PASSED [ 20%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_upload_supabase_full_flow_mocked PASSED [ 20%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_download_supabase_full_flow_mocked PASSED [ 21%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_upload_supabase_exception PASSED [ 21%]
tests/services/backup/test_service.py::TestSupabaseIntegration::test_download_supabase_exception PASSED [ 22%]
tests/services/backup/test_service.py::TestHistoriqueDB::test_enregistrer_backup_historique PASSED [ 22%]
tests/services/backup/test_service.py::TestHistoriqueDB::test_enregistrer_backup_historique_without_user PASSED [ 23%]
tests/services/backup/test_service.py::TestHistoriqueDB::test_enregistrer_backup_historique_error PASSED [ 23%]
tests/services/backup/test_service.py::TestHistoriqueDB::test_lister_backups_historique PASSED [ 24%]
tests/services/backup/test_service.py::TestHistoriqueDB::test_lister_backups_historique_with_user PASSED [ 24%]
tests/services/backup/test_service.py::TestHistoriqueDB::test_supprimer_backup_historique_exists PASSED [ 25%]
tests/services/backup/test_service.py::TestHistoriqueDB::test_supprimer_backup_historique_not_exists PASSED [ 25%]
tests/services/backup/test_service.py::TestFactoryAndAliases::test_backup_service_alias PASSED [ 26%]
tests/services/backup/test_service.py::TestFactoryAndAliases::test_get_backup_service_alias PASSED [ 26%]
tests/services/backup/test_service.py::TestFactoryAndAliases::test_obtenir_service_backup_returns_instance PASSED [ 27%]
tests/services/backup/test_service.py::TestFactoryAndAliases::test_obtenir_service_backup_singleton PASSED [ 27%]
tests/services/backup/test_service.py::TestEdgeCases::test_create_backup_empty_tables PASSED [ 28%]
tests/services/backup/test_service.py::TestEdgeCases::test_create_backup_with_db_records PASSED [ 28%]
tests/services/backup/test_service.py::TestEdgeCases::test_restore_empty_backup PASSED [ 29%]
tests/services/backup/test_service.py::TestEdgeCases::test_corrupted_json_file PASSED [ 29%]
tests/services/backup/test_service.py::TestEdgeCases::test_corrupted_gzip_file PASSED [ 30%]
tests/services/backup/test_service.py::TestEdgeCases::test_get_backup_info_partial_metadata PASSED [ 30%]
tests/services/backup/test_service.py::TestEdgeCases::test_create_backup_db_error PASSED [ 31%]
tests/services/backup/test_service.py::TestEdgeCases::test_restore_with_datetime_conversion PASSED [ 31%]
tests/services/backup/test_service.py::TestEdgeCases::test_list_backups_with_error_handling PASSED [ 32%]
tests/services/backup/test_service.py::TestEdgeCases::test_create_backup_all_tables PASSED [ 32%]
tests/services/backup/test_service.py::TestRenderBackupUI::test_render_backup_ui_exists PASSED [ 33%]
tests/services/backup/test_service.py::TestRenderBackupUI::test_render_backup_ui_function_signature PASSED [ 33%]
tests/services/backup/test_types.py::TestBackupConfig::test_default_values PASSED [ 33%]
tests/services/backup/test_types.py::TestBackupConfig::test_custom_values PASSED [ 34%]
tests/services/backup/test_types.py::TestBackupConfig::test_partial_values PASSED [ 34%]
tests/services/backup/test_types.py::TestBackupConfig::test_model_dump PASSED [ 35%]
tests/services/backup/test_types.py::TestBackupConfig::test_type_coercion PASSED [ 35%]
tests/services/backup/test_types.py::TestBackupMetadata::test_default_values PASSED [ 36%]
tests/services/backup/test_types.py::TestBackupMetadata::test_custom_values PASSED [ 36%]
tests/services/backup/test_types.py::TestBackupMetadata::test_created_at_default_factory PASSED [ 37%]
tests/services/backup/test_types.py::TestBackupMetadata::test_model_dump_serialization PASSED [ 37%]
tests/services/backup/test_types.py::TestBackupMetadata::test_copy_with_update PASSED [ 38%]
tests/services/backup/test_types.py::TestBackupResult::test_default_values PASSED [ 38%]
tests/services/backup/test_types.py::TestBackupResult::test_success_result PASSED [ 39%]
tests/services/backup/test_types.py::TestBackupResult::test_failure_result PASSED [ 39%]
tests/services/backup/test_types.py::TestBackupResult::test_nested_metadata_serialization PASSED [ 40%]
tests/services/backup/test_types.py::TestBackupResult::test_optional_file_path PASSED [ 40%]
tests/services/backup/test_types.py::TestRestoreResult::test_default_values PASSED [ 41%]
tests/services/backup/test_types.py::TestRestoreResult::test_success_restore PASSED [ 41%]
tests/services/backup/test_types.py::TestRestoreResult::test_partial_restore_with_errors PASSED [ 42%]
tests/services/backup/test_types.py::TestRestoreResult::test_lists_are_independent PASSED [ 42%]
tests/services/backup/test_types.py::TestRestoreResult::test_model_dump_with_lists PASSED [ 43%]
tests/services/backup/test_types.py::TestRestoreResult::test_records_restored_type PASSED [ 43%]
tests/services/backup/test_types.py::TestModelsIntegration::test_backup_result_with_full_metadata PASSED [ 44%]
tests/services/backup/test_types.py::TestModelsIntegration::test_config_for_different_environments PASSED [ 44%]
tests/services/backup/test_types.py::TestModelsIntegration::test_restore_result_summary PASSED [ 45%]
tests/services/backup/test_types.py::TestEdgeCases::test_empty_strings PASSED [ 45%]
tests/services/backup/test_types.py::TestEdgeCases::test_zero_values PASSED [ 46%]
tests/services/backup/test_types.py::TestEdgeCases::test_large_values PASSED [ 46%]
tests/services/backup/test_types.py::TestEdgeCases::test_negative_duration PASSED [ 47%]
tests/services/backup/test_types.py::TestEdgeCases::test_very_long_message PASSED [ 47%]
tests/services/backup/test_types.py::TestEdgeCases::test_special_characters_in_path PASSED [ 48%]
tests/services/backup/test_types.py::TestEdgeCases::test_many_tables_restored PASSED [ 48%]
tests/services/backup/test_types.py::TestEdgeCases::test_many_errors PASSED [ 49%]
tests/services/backup/test_types.py::TestModelValidation::test_config_type_validation PASSED [ 49%]
tests/services/backup/test_types.py::TestModelValidation::test_metadata_datetime_validation PASSED [ 50%]
tests/services/backup/test_types.py::TestModelValidation::test_result_boolean_type PASSED [ 50%]
tests/services/backup/test_types.py::TestModelValidation::test_metadata_from_dict PASSED [ 51%]
tests/services/backup/test_utils.py::TestGenerateBackupId::test_specific_datetime PASSED [ 51%]
tests/services/backup/test_utils.py::TestGenerateBackupId::test_midnight PASSED [ 52%]
tests/services/backup/test_utils.py::TestGenerateBackupId::test_end_of_day PASSED [ 52%]
tests/services/backup/test_utils.py::TestGenerateBackupId::test_default_is_now PASSED [ 53%]
tests/services/backup/test_utils.py::TestGenerateBackupId::test_format_is_correct PASSED [ 53%]
tests/services/backup/test_utils.py::TestParseBackupId::test_valid_id PASSED [ 54%]
tests/services/backup/test_utils.py::TestParseBackupId::test_invalid_format PASSED [ 54%]
tests/services/backup/test_utils.py::TestParseBackupId::test_none_input PASSED [ 55%]
tests/services/backup/test_utils.py::TestParseBackupId::test_empty_string PASSED [ 55%]
tests/services/backup/test_utils.py::TestParseBackupId::test_partial_date PASSED [ 56%]
tests/services/backup/test_utils.py::TestParseBackupId::test_invalid_date_values PASSED [ 56%]
tests/services/backup/test_utils.py::TestParseBackupId::test_roundtrip PASSED [ 57%]
tests/services/backup/test_utils.py::TestIsValidBackupId::test_valid_ids PASSED [ 57%]
tests/services/backup/test_utils.py::TestIsValidBackupId::test_invalid_ids PASSED [ 58%]
tests/services/backup/test_utils.py::TestCalculateChecksum::test_basic_string PASSED [ 58%]
tests/services/backup/test_utils.py::TestCalculateChecksum::test_json_string PASSED [ 59%]
tests/services/backup/test_utils.py::TestCalculateChecksum::test_empty_string PASSED [ 59%]
tests/services/backup/test_utils.py::TestCalculateChecksum::test_deterministic PASSED [ 60%]
tests/services/backup/test_utils.py::TestCalculateChecksum::test_different_inputs_different_outputs PASSED [ 60%]
tests/services/backup/test_utils.py::TestCalculateChecksum::test_unicode_support PASSED [ 61%]
tests/services/backup/test_utils.py::TestVerifyChecksum::test_valid_checksum PASSED [ 61%]
tests/services/backup/test_utils.py::TestVerifyChecksum::test_invalid_checksum PASSED [ 62%]
tests/services/backup/test_utils.py::TestVerifyChecksum::test_modified_data PASSED [ 62%]
tests/services/backup/test_utils.py::TestVerifyChecksum::test_empty_data PASSED [ 63%]
tests/services/backup/test_utils.py::TestSerializeValue::test_none PASSED [ 63%]
tests/services/backup/test_utils.py::TestSerializeValue::test_primitives PASSED [ 64%]
tests/services/backup/test_utils.py::TestSerializeValue::test_datetime PASSED [ 64%]
tests/services/backup/test_utils.py::TestSerializeValue::test_datetime_with_microseconds PASSED [ 65%]
tests/services/backup/test_utils.py::TestSerializeValue::test_date PASSED [ 65%]
tests/services/backup/test_utils.py::TestSerializeValue::test_lists PASSED [ 66%]
tests/services/backup/test_utils.py::TestSerializeValue::test_dicts PASSED [ 66%]
tests/services/backup/test_utils.py::TestDeserializeValue::test_non_string_passthrough PASSED [ 66%]
tests/services/backup/test_utils.py::TestDeserializeValue::test_iso_datetime PASSED [ 67%]
tests/services/backup/test_utils.py::TestDeserializeValue::test_iso_datetime_with_z PASSED [ 67%]
tests/services/backup/test_utils.py::TestDeserializeValue::test_regular_string PASSED [ 68%]
tests/services/backup/test_utils.py::TestDeserializeValue::test_short_string_with_t PASSED [ 68%]
tests/services/backup/test_utils.py::TestModelToDict::test_simple_object_with_dict PASSED [ 69%]
tests/services/backup/test_utils.py::TestModelToDict::test_object_with_datetime PASSED [ 69%]
tests/services/backup/test_utils.py::TestModelToDict::test_empty_object PASSED [ 70%]
tests/services/backup/test_utils.py::TestValidateBackupStructure::test_valid_structure PASSED [ 70%]
tests/services/backup/test_utils.py::TestValidateBackupStructure::test_missing_metadata PASSED [ 71%]
tests/services/backup/test_utils.py::TestValidateBackupStructure::test_missing_data PASSED [ 71%]
tests/services/backup/test_utils.py::TestValidateBackupStructure::test_not_a_dict PASSED [ 72%]
tests/services/backup/test_utils.py::TestValidateBackupStructure::test_metadata_not_dict PASSED [ 72%]
tests/services/backup/test_utils.py::TestValidateBackupStructure::test_data_not_dict PASSED [ 73%]
tests/services/backup/test_utils.py::TestValidateBackupStructure::test_empty_dicts_valid PASSED [ 73%]
tests/services/backup/test_utils.py::TestValidateBackupMetadata::test_valid_metadata PASSED [ 74%]
tests/services/backup/test_utils.py::TestValidateBackupMetadata::test_missing_id PASSED [ 74%]
tests/services/backup/test_utils.py::TestValidateBackupMetadata::test_missing_created_at PASSED [ 75%]
tests/services/backup/test_utils.py::TestValidateBackupMetadata::test_empty_id PASSED [ 75%]
tests/services/backup/test_utils.py::TestIsCompressedFile::test_gz_extension PASSED [ 76%]
tests/services/backup/test_utils.py::TestIsCompressedFile::test_json_extension PASSED [ 76%]
tests/services/backup/test_utils.py::TestIsCompressedFile::test_path_object PASSED [ 77%]
tests/services/backup/test_utils.py::TestIsCompressedFile::test_no_extension PASSED [ 77%]
tests/services/backup/test_utils.py::TestGetBackupFilename::test_compressed PASSED [ 78%]
tests/services/backup/test_utils.py::TestGetBackupFilename::test_not_compressed PASSED [ 78%]
tests/services/backup/test_utils.py::TestGetBackupFilename::test_default_is_compressed PASSED [ 79%]
tests/services/backup/test_utils.py::TestParseBackupFilename::test_compressed_file PASSED [ 79%]
tests/services/backup/test_utils.py::TestParseBackupFilename::test_uncompressed_file PASSED [ 80%]
tests/services/backup/test_utils.py::TestParseBackupFilename::test_invalid_prefix PASSED [ 80%]
tests/services/backup/test_utils.py::TestParseBackupFilename::test_invalid_id_format PASSED [ 81%]
tests/services/backup/test_utils.py::TestParseBackupFilename::test_unknown_extension PASSED [ 81%]
tests/services/backup/test_utils.py::TestFormatFileSize::test_bytes PASSED [ 82%]
tests/services/backup/test_utils.py::TestFormatFileSize::test_kilobytes PASSED [ 82%]
tests/services/backup/test_utils.py::TestFormatFileSize::test_megabytes PASSED [ 83%]
tests/services/backup/test_utils.py::TestFormatFileSize::test_gigabytes PASSED [ 83%]
tests/services/backup/test_utils.py::TestGetRestoreOrder::test_returns_list PASSED [ 84%]
tests/services/backup/test_utils.py::TestGetRestoreOrder::test_ingredients_first PASSED [ 84%]
tests/services/backup/test_utils.py::TestGetRestoreOrder::test_contains_main_tables PASSED [ 85%]
tests/services/backup/test_utils.py::TestGetRestoreOrder::test_fk_order PASSED [ 85%]
tests/services/backup/test_utils.py::TestFilterAndOrderTables::test_reorders_tables PASSED [ 86%]
tests/services/backup/test_utils.py::TestFilterAndOrderTables::test_filters_unknown_tables PASSED [ 86%]
tests/services/backup/test_utils.py::TestFilterAndOrderTables::test_empty_list PASSED [ 87%]
tests/services/backup/test_utils.py::TestFilterAndOrderTables::test_all_unknown PASSED [ 87%]
tests/services/backup/test_utils.py::TestCalculateBackupStats::test_basic_stats PASSED [ 88%]
tests/services/backup/test_utils.py::TestCalculateBackupStats::test_empty_data PASSED [ 88%]
tests/services/backup/test_utils.py::TestCalculateBackupStats::test_missing_data_key PASSED [ 89%]
tests/services/backup/test_utils.py::TestCalculateBackupStats::test_empty_tables PASSED [ 89%]
tests/services/backup/test_utils.py::TestCompareBackupStats::test_identical_stats PASSED [ 90%]
tests/services/backup/test_utils.py::TestCompareBackupStats::test_missing_tables PASSED [ 90%]
tests/services/backup/test_utils.py::TestCompareBackupStats::test_extra_tables PASSED [ 91%]
tests/services/backup/test_utils.py::TestGetBackupsToRotate::test_under_limit PASSED [ 91%]
tests/services/backup/test_utils.py::TestGetBackupsToRotate::test_at_limit PASSED [ 92%]
tests/services/backup/test_utils.py::TestGetBackupsToRotate::test_over_limit PASSED [ 92%]
tests/services/backup/test_utils.py::TestGetBackupsToRotate::test_multiple_to_rotate PASSED [ 93%]
tests/services/backup/test_utils.py::TestGetBackupsToRotate::test_empty_list PASSED [ 93%]
tests/services/backup/test_utils.py::TestShouldRunBackup::test_no_previous_backup PASSED [ 94%]
tests/services/backup/test_utils.py::TestShouldRunBackup::test_backup_overdue PASSED [ 94%]
tests/services/backup/test_utils.py::TestShouldRunBackup::test_backup_recent PASSED [ 95%]
tests/services/backup/test_utils.py::TestShouldRunBackup::test_exactly_at_interval PASSED [ 95%]
tests/services/backup/test_utils.py::TestShouldRunBackup::test_just_before_interval PASSED [ 96%]
tests/services/backup/test_utils.py::TestShouldRunBackup::test_short_interval PASSED [ 96%]
tests/services/backup/test_utils.py::TestShouldRunBackup::test_zero_interval PASSED [ 97%]
tests/services/backup/test_utils.py::TestEdgeCases::test_generate_backup_id_leap_year PASSED [ 97%]
tests/services/backup/test_utils.py::TestEdgeCases::test_checksum_large_data PASSED [ 98%]
tests/services/backup/test_utils.py::TestEdgeCases::test_format_file_size_zero PASSED [ 98%]
tests/services/backup/test_utils.py::TestEdgeCases::test_format_file_size_exact_boundaries PASSED [ 99%]
tests/services/backup/test_utils.py::TestEdgeCases::test_filter_and_order_duplicates PASSED [ 99%]
pytest : C:\Users\Nemo\AppData\Local\Programs\Python\Python311\Lib\site-package
s\coverage\inorout.py:495: CoverageWarning: Module src/services/backup/service 
was never imported. (module-not-imported); see https://coverage.readthedocs.io/
en/7.13.2/messages.html#warning-module-not-imported
Au caractère Ligne:1 : 1
+ pytest tests/services/backup/ --cov=src/services/backup/service --cov ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (C:\Users\Nemo\A...le-not-imported 
   :String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  self.warn(f"Module {pkg} was never imported.", slug="module-not-imported")
C:\Users\Nemo\AppData\Local\Programs\Python\Python311\Lib\site-packages\coverag
e\control.py:958: CoverageWarning: No data was collected. (no-data-collected); 
see https://coverage.readthedocs.io/en/7.13.2/messages.html#warning-no-data-col
lected
  self._warn("No data was collected.", slug="no-data-collected")
C:\Users\Nemo\AppData\Local\Programs\Python\Python311\Lib\site-packages\pytest_
cov\plugin.py:363: CovReportWarning: Failed to generate report: No data to 
report.

  warnings.warn(CovReportWarning(message), stacklevel=1)
tests/services/backup/test_utils.py::TestEdgeCases::test_compare_backup_stats_empty PASSED [100%]
WARNING: Failed to generate report: No data to report.



=============================== tests coverage ================================
_______________ coverage: platform win32, python 3.11.8-final-0 _______________

============================= 203 passed in 3.79s =============================
