[pytest]
# Pytest Configuration
# ════════════════════════════════════════════════════════════════════

# Minimum version
minversion = 7.0

# Test paths
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
pythonpath = src

# Async configuration
asyncio_mode = strict
asyncio_default_fixture_loop_scope = function

# Markers (Must register all custom markers here)
markers =
    unit: Unit tests (fast, no external deps)
    integration: Integration tests (may use external deps)
    slow: Slow tests (require optimization)
    requires_db: Tests that require database
    requires_redis: Tests that require Redis
    requires_internet: Tests that require internet connection
    parametrize: Parametrized tests
    asyncio: Async tests (run with pytest-asyncio)
    endpoint: Tests for API endpoints
    auth: Tests for authentication
    rate_limit: Tests for rate limiting
    cache: Tests for caching
    api: Tests for API module
    benchmark: Benchmark tests for performance measurement
    memory: Memory usage tests
    concurrency: Concurrency and threading tests
    e2e: End-to-end tests
    ui: UI tests via st.testing.AppTest (Streamlit headless)

# Output options
addopts =
    -v
    --tb=short
    --strict-markers
    --strict-config
    -r fEsxXw

# Warning filters - suppress Streamlit context warnings during tests
filterwarnings =
    ignore::DeprecationWarning
    ignore:.*ScriptRunContext.*:UserWarning
    ignore:.*Session state does not function.*:UserWarning
    ignore:.*No runtime found.*:UserWarning

# Coverage options (when used with pytest-cov)
# --cov=src/core
# --cov-report=term-missing
# --cov-report=html
# --cov-fail-under=85

# Console output capture
console_output_style = progress

# Timeout for tests (optional, requires pytest-timeout)
# timeout = 300

# Log configuration
log_cli = false
log_cli_level = INFO
log_file = tests.log
log_file_level = DEBUG

# Doctest configuration
doctest_optionflags = NORMALIZE_WHITESPACE ELLIPSIS

# Timeout for hanging tests (requires pytest-timeout)
# timeout = 60
