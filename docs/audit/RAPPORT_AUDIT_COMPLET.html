<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audit Complet v2 â€” Assistant Matanne</title>
<style>
/* ===== RESET & BASE ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #ffffff; --bg-alt: #f8f9fa; --bg-card: #ffffff; --bg-sidebar: #1e293b;
  --text: #1e293b; --text-muted: #64748b; --text-sidebar: #e2e8f0;
  --border: #e2e8f0; --accent: #3b82f6; --accent-light: #eff6ff;
  --green: #10b981; --green-bg: #ecfdf5; --yellow: #f59e0b; --yellow-bg: #fffbeb;
  --red: #ef4444; --red-bg: #fef2f2; --orange: #f97316; --orange-bg: #fff7ed;
  --purple: #8b5cf6; --purple-bg: #f5f3ff; --cyan: #06b6d4;
  --shadow: 0 1px 3px rgba(0,0,0,.1); --shadow-lg: 0 4px 15px rgba(0,0,0,.1);
  --radius: 8px; --radius-lg: 12px;
  --font: 'Segoe UI', system-ui, -apple-system, sans-serif;
  --mono: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
  --sidebar-w: 290px;
}
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0f172a; --bg-alt: #1e293b; --bg-card: #1e293b; --bg-sidebar: #0f172a;
    --text: #e2e8f0; --text-muted: #94a3b8; --border: #334155;
    --accent-light: #1e3a5f; --green-bg: #064e3b; --yellow-bg: #78350f;
    --red-bg: #7f1d1d; --orange-bg: #7c2d12; --purple-bg: #4c1d95;
    --shadow: 0 1px 3px rgba(0,0,0,.3); --shadow-lg: 0 4px 15px rgba(0,0,0,.3);
  }
}
html { scroll-behavior: smooth; font-size: 15px; }
body { font-family: var(--font); color: var(--text); background: var(--bg); line-height: 1.6; }
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }
code { font-family: var(--mono); font-size: .88em; background: var(--bg-alt); padding: 2px 6px; border-radius: 4px; }
pre { background: var(--bg-alt); padding: 16px; border-radius: var(--radius); overflow-x: auto; font-size: .85rem; border: 1px solid var(--border); }
pre code { background: none; padding: 0; }
h1,h2,h3,h4 { font-weight: 700; line-height: 1.3; }
hr { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }

/* ===== SIDEBAR ===== */
.sidebar {
  position: fixed; top: 0; left: 0; width: var(--sidebar-w); height: 100vh;
  background: var(--bg-sidebar); color: var(--text-sidebar);
  overflow-y: auto; z-index: 100; padding: 1.5rem 0;
  border-right: 1px solid rgba(255,255,255,.1);
}
.sidebar h2 { font-size: 1rem; padding: 0 1.2rem; margin-bottom: 1rem; color: #fff; letter-spacing: .02em; }
.sidebar .logo { text-align: center; padding: 0 1.2rem .8rem; border-bottom: 1px solid rgba(255,255,255,.1); margin-bottom: 1rem; }
.sidebar .logo span { font-size: 1.4rem; font-weight: 800; color: var(--accent); }
.sidebar .logo small { display: block; color: var(--text-muted); font-size: .75rem; margin-top: 2px; }
.sidebar nav a {
  display: flex; align-items: center; padding: .42rem 1.2rem; color: var(--text-sidebar);
  font-size: .8rem; transition: all .15s; gap: .5rem; border-left: 3px solid transparent;
}
.sidebar nav a:hover { background: rgba(255,255,255,.08); text-decoration: none; border-left-color: var(--accent); }
.sidebar nav a.section-title { font-weight: 700; font-size: .75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: .06em; padding-top: .8rem; cursor: default; }
.sidebar nav a.section-title:hover { background: none; border-left-color: transparent; }
.sidebar nav a .nav-badge { margin-left: auto; font-size: .7rem; padding: 1px 7px; border-radius: 10px; font-weight: 600; }

/* ===== MAIN CONTENT ===== */
.main { margin-left: var(--sidebar-w); padding: 2rem 3rem 4rem; max-width: 1100px; }
.main > section { margin-bottom: 3rem; }
.main h1 { font-size: 2rem; margin-bottom: .3rem; }
.main h2 { font-size: 1.5rem; margin: 2.5rem 0 1rem; padding-bottom: .4rem; border-bottom: 2px solid var(--accent); }
.main h3 { font-size: 1.15rem; margin: 1.5rem 0 .6rem; }
.main h4 { font-size: 1rem; margin: 1rem 0 .4rem; color: var(--text-muted); }
p, li { margin-bottom: .4rem; }
ul, ol { padding-left: 1.5rem; }
table { width: 100%; border-collapse: collapse; margin: .8rem 0; font-size: .85rem; }
th, td { text-align: left; padding: .55rem .8rem; border-bottom: 1px solid var(--border); }
th { font-weight: 700; background: var(--bg-alt); position: sticky; top: 0; white-space: nowrap; }
tr:hover { background: var(--accent-light); }
.align-center { text-align: center; }
.align-right { text-align: right; }
.nowrap { white-space: nowrap; }

/* ===== CARDS ===== */
.card {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  padding: 1.2rem 1.5rem; margin: 1rem 0; box-shadow: var(--shadow);
}
.card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: .5rem; }
.card-header h3 { margin: 0; }

/* ===== BADGES ===== */
.badge { display: inline-block; padding: 2px 10px; border-radius: 12px; font-size: .78rem; font-weight: 600; }
.badge-green { background: var(--green-bg); color: var(--green); }
.badge-yellow { background: var(--yellow-bg); color: var(--yellow); }
.badge-red { background: var(--red-bg); color: var(--red); }
.badge-accent { background: var(--accent-light); color: var(--accent); }
.badge-purple { background: var(--purple-bg); color: var(--purple); }
.badge-orange { background: var(--orange-bg); color: var(--orange); }
.score { font-size: 1.3rem; font-weight: 800; }
.score-green { color: var(--green); }
.score-yellow { color: var(--yellow); }
.score-red { color: var(--red); }

/* ===== PROGRESS BARS ===== */
.progress-bar { background: var(--bg-alt); border-radius: 10px; height: 10px; overflow: hidden; margin: 4px 0; }
.progress-fill { height: 100%; border-radius: 10px; transition: width .4s; }
.progress-green { background: var(--green); }
.progress-yellow { background: var(--yellow); }
.progress-red { background: var(--red); }
.progress-accent { background: var(--accent); }

/* ===== STATS GRID ===== */
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem; margin: 1rem 0; }
.stat-card {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius);
  padding: 1rem 1.2rem; text-align: center; box-shadow: var(--shadow);
}
.stat-card .stat-value { font-size: 2rem; font-weight: 800; line-height: 1.2; }
.stat-card .stat-label { font-size: .78rem; color: var(--text-muted); margin-top: .3rem; }

/* ===== RADAR CHART (CSS) ===== */
.radar-container { display: flex; flex-wrap: wrap; gap: 1.5rem; margin: 1.5rem 0; }
.radar-item { flex: 1; min-width: 200px; }
.radar-item .label { display: flex; justify-content: space-between; font-size: .85rem; margin-bottom: 3px; }
.radar-item .label strong { font-weight: 600; }

/* ===== COLLAPSIBLE ===== */
details { border: 1px solid var(--border); border-radius: var(--radius); margin: .8rem 0; overflow: hidden; }
details[open] { box-shadow: var(--shadow); }
summary {
  padding: .7rem 1rem; cursor: pointer; font-weight: 600; font-size: .95rem;
  background: var(--bg-alt); display: flex; align-items: center; gap: .5rem;
  list-style: none;
}
summary::-webkit-details-marker { display: none; }
summary::before { content: 'â–¶'; font-size: .7rem; transition: transform .2s; display: inline-block; width: 1rem; }
details[open] summary::before { transform: rotate(90deg); }
details > :not(summary) { padding: .8rem 1rem; }

/* ===== SEVERITY TAGS ===== */
.tag { display: inline-block; padding: 1px 8px; border-radius: 4px; font-size: .75rem; font-weight: 600; margin-right: 4px; vertical-align: middle; }
.tag-critical { background: var(--red-bg); color: var(--red); }
.tag-high { background: var(--orange-bg); color: var(--orange); }
.tag-medium { background: var(--yellow-bg); color: var(--yellow); }
.tag-low { background: var(--green-bg); color: var(--green); }
.tag-info { background: var(--accent-light); color: var(--accent); }
.tag-fixed { background: #d1fae5; color: #047857; }
.check { color: var(--green); font-weight: 700; }
.cross { color: var(--red); font-weight: 700; }
.warn { color: var(--yellow); font-weight: 700; }

/* ===== TIMELINE / ROADMAP ===== */
.timeline { position: relative; padding-left: 2rem; margin: 1.5rem 0; }
.timeline::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 3px; background: var(--border); border-radius: 3px; }
.timeline-item { position: relative; margin-bottom: 1.5rem; }
.timeline-item::before {
  content: ''; position: absolute; left: -2rem; top: 6px; width: 14px; height: 14px;
  border-radius: 50%; border: 3px solid var(--accent); background: var(--bg);
}
.timeline-item.phase1::before { border-color: var(--green); background: var(--green); }
.timeline-item.phase2::before { border-color: var(--red); }
.timeline-item.phase3::before { border-color: var(--orange); }
.timeline-item.phase4::before { border-color: var(--yellow); }
.timeline-item.phase5::before { border-color: var(--accent); }
.timeline-item.phase6::before { border-color: var(--green); }
.timeline-item h4 { margin: 0 0 .3rem; }
.timeline-item p { margin: 0; font-size: .9rem; color: var(--text-muted); }
.timeline-item ul { margin-top: .3rem; }

/* ===== INNOVATION CARDS ===== */
.innovation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin: 1rem 0; }
.innovation-card {
  border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.2rem;
  background: var(--bg-card); border-left: 4px solid var(--accent); box-shadow: var(--shadow);
}
.innovation-card h4 { margin: 0 0 .4rem; font-size: 1rem; }
.innovation-card .impact { font-size: .78rem; margin-top: .5rem; }
.innovation-card .impact span { font-weight: 700; }

/* ===== ADOPTION MATRIX ===== */
.adoption-row { display: flex; align-items: center; gap: .8rem; padding: .4rem 0; border-bottom: 1px solid var(--border); }
.adoption-row .concept { flex: 0 0 200px; font-weight: 600; font-size: .85rem; }
.adoption-row .ratio { flex: 0 0 100px; text-align: right; font-size: .85rem; }

/* ===== DIFF DELTA ===== */
.delta { font-size: .75rem; font-weight: 700; margin-left: 6px; }
.delta-up { color: var(--green); }
.delta-down { color: var(--red); }
.delta-same { color: var(--text-muted); }

/* ===== V2 COMPARISON TABLE ===== */
.compare-table td:nth-child(2), .compare-table td:nth-child(3) { text-align: center; }
.compare-table th:nth-child(2), .compare-table th:nth-child(3) { text-align: center; }

/* ===== PRINT ===== */
@media print {
  .sidebar { display: none; }
  .main { margin-left: 0; padding: 1rem; max-width: 100%; }
  details { break-inside: avoid; }
  details[open] summary ~ * { display: block !important; }
  .card, details { box-shadow: none; border: 1px solid #ccc; }
  table { font-size: .8rem; }
}
@media (max-width: 900px) {
  .sidebar { display: none; }
  .main { margin-left: 0; padding: 1.5rem; }
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>

<!-- ==================== SIDEBAR ==================== -->
<aside class="sidebar">
  <div class="logo">
    <span>ğŸ  Assistant Matanne</span>
    <small>Audit complet v2 â€” 23 fÃ©v. 2026</small>
  </div>
  <nav>
    <a href="#executive" style="font-weight:700;color:#fff;">ğŸ“Š Tableau de bord</a>
    <a href="#changelog">ğŸ”„ AmÃ©liorations v1â†’v2</a>
    <a class="section-title">ANALYSE PAR DOSSIER</a>
    <a href="#core">ğŸ§± src/core/ <span class="nav-badge" style="background:#10b981;color:#fff;">8.3</span></a>
    <a href="#core-ai">&nbsp;&nbsp;â†³ ai/</a>
    <a href="#core-caching">&nbsp;&nbsp;â†³ caching/</a>
    <a href="#core-config">&nbsp;&nbsp;â†³ config/</a>
    <a href="#core-db">&nbsp;&nbsp;â†³ db/</a>
    <a href="#core-decorators">&nbsp;&nbsp;â†³ decorators/</a>
    <a href="#core-models">&nbsp;&nbsp;â†³ models/</a>
    <a href="#core-state">&nbsp;&nbsp;â†³ state/</a>
    <a href="#core-validation">&nbsp;&nbsp;â†³ validation/</a>
    <a href="#core-monitoring">&nbsp;&nbsp;â†³ monitoring/</a>
    <a href="#core-resilience">&nbsp;&nbsp;â†³ resilience/</a>
    <a href="#core-observability">&nbsp;&nbsp;â†³ observability/</a>
    <a href="#core-dateutils">&nbsp;&nbsp;â†³ date_utils/</a>
    <a href="#core-root">&nbsp;&nbsp;â†³ fichiers racine</a>
    <a href="#services">âš™ï¸ src/services/ <span class="nav-badge" style="background:#10b981;color:#fff;">8.0</span></a>
    <a href="#svc-core">&nbsp;&nbsp;â†³ core/</a>
    <a href="#svc-cuisine">&nbsp;&nbsp;â†³ cuisine/</a>
    <a href="#svc-famille">&nbsp;&nbsp;â†³ famille/</a>
    <a href="#svc-inventaire">&nbsp;&nbsp;â†³ inventaire/</a>
    <a href="#svc-integrations">&nbsp;&nbsp;â†³ integrations/</a>
    <a href="#svc-maison">&nbsp;&nbsp;â†³ maison/</a>
    <a href="#svc-jeux">&nbsp;&nbsp;â†³ jeux/</a>
    <a href="#svc-rapports">&nbsp;&nbsp;â†³ rapports/</a>
    <a href="#modules">ğŸ“¦ src/modules/ <span class="nav-badge" style="background:#10b981;color:#fff;">8.0</span></a>
    <a href="#mod-accueil">&nbsp;&nbsp;â†³ accueil/</a>
    <a href="#mod-cuisine">&nbsp;&nbsp;â†³ cuisine/</a>
    <a href="#mod-famille">&nbsp;&nbsp;â†³ famille/</a>
    <a href="#mod-maison">&nbsp;&nbsp;â†³ maison/</a>
    <a href="#mod-jeux">&nbsp;&nbsp;â†³ jeux/</a>
    <a href="#mod-planning">&nbsp;&nbsp;â†³ planning/</a>
    <a href="#mod-parametres">&nbsp;&nbsp;â†³ parametres/</a>
    <a href="#mod-utilitaires">&nbsp;&nbsp;â†³ utilitaires/</a>
    <a href="#mod-framework">&nbsp;&nbsp;â†³ _framework/</a>
    <a href="#ui">ğŸ¨ src/ui/ <span class="nav-badge" style="background:#f59e0b;color:#fff;">7.0</span></a>
    <a href="#api">ğŸŒ src/api/ <span class="nav-badge" style="background:#10b981;color:#fff;">8.2</span></a>
    <a href="#app">ğŸš€ app.py <span class="nav-badge" style="background:#10b981;color:#fff;">8.5</span></a>
    <a class="section-title">SYNTHÃˆSE</a>
    <a href="#adoption">ğŸ” Adoption des concepts</a>
    <a href="#issues">ğŸ› ProblÃ¨mes rÃ©siduels</a>
    <a href="#innovations">ğŸ’¡ Innovations proposÃ©es</a>
    <a href="#roadmap">ğŸ—ºï¸ Roadmap v2</a>
  </nav>
</aside>

<!-- ==================== MAIN CONTENT ==================== -->
<div class="main">

<!-- ==================== EXECUTIVE DASHBOARD ==================== -->
<section id="executive">
<h1>ğŸ  Rapport d'Audit Complet â€” v2</h1>
<p style="color:var(--text-muted);margin-bottom:1.5rem;">Assistant Matanne â€” Application Streamlit de gestion familiale &bull; AnalysÃ© le 23 fÃ©vrier 2026 &bull; <strong>ComparÃ© Ã  l'audit v1</strong></p>

<div class="stats-grid">
  <div class="stat-card"><div class="stat-value" style="color:var(--accent);">570</div><div class="stat-label">Fichiers Python</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--accent);">94 104</div><div class="stat-label">Lignes de code</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--accent);">100+</div><div class="stat-label">ModÃ¨les ORM</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--accent);">56</div><div class="stat-label">@service_factory<span class="delta delta-up">+9</span></div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--accent);">34</div><div class="stat-label">Modules app()<span class="delta delta-up">+1</span></div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--accent);">26</div><div class="stat-label">Endpoints API<span class="delta delta-up">+4</span></div></div>
</div>

<h3>Scores de maturitÃ© â€” comparaison v1 â†’ v2</h3>
<div class="radar-container">
  <div class="radar-item">
    <div class="label"><strong>ğŸ—ï¸ Architecture</strong> <span class="score score-green">9/10</span><span class="delta delta-same">â†’</span></div>
    <div class="progress-bar"><div class="progress-fill progress-green" style="width:90%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>ğŸ“ QualitÃ© du code</strong> <span class="score score-green">8.5/10</span><span class="delta delta-up">+0.5</span></div>
    <div class="progress-bar"><div class="progress-fill progress-green" style="width:85%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>ğŸ§ª Tests</strong> <span class="score score-yellow">6/10</span><span class="delta delta-same">â†’</span></div>
    <div class="progress-bar"><div class="progress-fill progress-yellow" style="width:60%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>ğŸ”’ SÃ©curitÃ©</strong> <span class="score score-yellow">7.5/10</span><span class="delta delta-up">+0.5</span></div>
    <div class="progress-bar"><div class="progress-fill progress-yellow" style="width:75%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>âš¡ Performance</strong> <span class="score score-green">8.5/10</span><span class="delta delta-up">+0.5</span></div>
    <div class="progress-bar"><div class="progress-fill progress-green" style="width:85%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>ğŸ“¡ ObservabilitÃ©</strong> <span class="score score-green">8/10</span><span class="delta delta-same">â†’</span></div>
    <div class="progress-bar"><div class="progress-fill progress-green" style="width:80%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>ğŸ¨ UX / Design System</strong> <span class="score score-green">8/10</span><span class="delta delta-down">-1</span></div>
    <div class="progress-bar"><div class="progress-fill progress-green" style="width:80%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>ğŸ“– Documentation</strong> <span class="score score-yellow">7/10</span><span class="delta delta-same">â†’</span></div>
    <div class="progress-bar"><div class="progress-fill progress-yellow" style="width:70%"></div></div>
  </div>
  <div class="radar-item">
    <div class="label"><strong>ğŸ”„ Adoption concepts</strong> <span class="score score-green">8/10</span><span class="delta delta-up">+2</span></div>
    <div class="progress-bar"><div class="progress-fill progress-green" style="width:80%"></div></div>
  </div>
</div>

<div class="card" style="border-left:4px solid var(--green);">
  <h3>Verdict v2</h3>
  <p>Le projet a <strong>considÃ©rablement progressÃ©</strong> depuis l'audit v1. Les 6 corrections critiques de la Phase 1 ont Ã©tÃ© appliquÃ©es (cache, circuit breaker, PolicyComposee, health checks). L'adoption des dÃ©corateurs (<code>@avec_cache</code>, <code>@avec_gestion_erreurs</code>, <code>error_boundary</code>) a explosÃ©. Le score global passe de <strong>7.9 âœ 8.3/10</strong>. Les axes restants sont l'adoption des tokens sÃ©mantiques dans l'UI, le bus d'Ã©vÃ©nements hors famille, et les innovations Streamlit modernes.</p>
</div>
</section>

<!-- ==================== CHANGELOG v1 â†’ v2 ==================== -->
<section id="changelog">
<h2>ğŸ”„ AmÃ©liorations v1 â†’ v2 â€” Rapport de progression</h2>

<h3>Corrections critiques appliquÃ©es (Phase 1 : âœ… 6/6)</h3>
<table class="compare-table">
<tr><th>Issue v1</th><th>Statut v1</th><th>Statut v2</th><th>DÃ©tail</th></tr>
<tr>
<td><code>@avec_cache</code> crÃ©e <code>CacheMultiNiveau()</code> orphelin</td>
<td><span class="tag tag-critical">CRITICAL</span></td>
<td><span class="tag tag-fixed">âœ… CORRIGÃ‰</span></td>
<td>Utilise dÃ©sormais <code>obtenir_cache()</code> singleton via import lazy â€” cache hit fonctionnel</td>
</tr>
<tr>
<td><code>@avec_circuit_breaker</code> ne supporte pas async</td>
<td><span class="tag tag-high">HIGH</span></td>
<td><span class="tag tag-fixed">âœ… CORRIGÃ‰</span></td>
<td>DÃ©tection <code>asyncio.iscoroutinefunction</code> ajoutÃ©e (âš ï¸ bug rÃ©siduel : coroutine non awaitÃ©e â€” voir issues)</td>
</tr>
<tr>
<td><code>PolicyComposee.__add__</code> dead code (indentation)</td>
<td><span class="tag tag-high">HIGH</span></td>
<td><span class="tag tag-fixed">âœ… CORRIGÃ‰</span></td>
<td>RÃ©-indentÃ© dans le corps de classe, <code>__add__</code> + <code>__repr__</code> opÃ©rationnels</td>
</tr>
<tr>
<td><code>_verifier_cache()</code> crÃ©e un cache vide</td>
<td><span class="tag tag-medium">MEDIUM</span></td>
<td><span class="tag tag-fixed">âœ… CORRIGÃ‰</span></td>
<td>Utilise <code>obtenir_cache()</code> â€” health checks voient les vraies stats</td>
</tr>
<tr>
<td>Double <code>injecter_css()</code> dans app.py</td>
<td><span class="tag tag-low">LOW</span></td>
<td><span class="tag tag-fixed">âœ… CORRIGÃ‰</span></td>
<td>CSS injectÃ© uniquement via <code>initialiser_app()</code> (pipeline unifiÃ©)</td>
</tr>
<tr>
<td>Fichiers deprecated (<code>planning/utils.py</code>, <code>__init__old.py</code>)</td>
<td><span class="tag tag-low">LOW</span></td>
<td><span class="tag tag-fixed">âœ… NETTOYÃ‰</span></td>
<td>Fichiers legacy supprimÃ©s, <code>importer.py</code> rÃ©duit Ã  134 lignes (wrapper)</td>
</tr>
</table>

<h3>Adoption des concepts dans les services (Phase 2 : amÃ©liorations majeures)</h3>
<table class="compare-table">
<tr><th>AmÃ©lioration</th><th>v1</th><th>v2</th><th>Impact</th></tr>
<tr>
<td><code>JulesAIService</code> + <code>WeekendAIService</code></td>
<td>Pas de <code>@service_factory</code>, <code>ClientIA()</code> direct</td>
<td><span class="tag tag-fixed">âœ…</span> <code>@service_factory</code> + <code>obtenir_client_ia()</code></td>
<td>Singleton, rate limit, circuit breaker activÃ©s</td>
</tr>
<tr>
<td><code>@avec_cache</code> dans les services</td>
<td>CassÃ© (cache orphelin) â€” Cuisine seul</td>
<td><span class="tag tag-fixed">âœ…</span> <strong>50+ usages</strong> (cuisine, famille, inventaire, jeux, integrations)</td>
<td>Performances DB amÃ©liorÃ©es, API calls rÃ©duits</td>
</tr>
<tr>
<td><code>@avec_gestion_erreurs</code></td>
<td>Cuisine seul (~35%)</td>
<td><span class="tag tag-fixed">âœ…</span> cuisine, famille, inventaire, jeux, maison, rapports</td>
<td>Erreurs gÃ©rÃ©es proprement avec fallback</td>
</tr>
<tr>
<td><code>@avec_resilience</code></td>
<td><strong>1/10</strong> APIs externes (produit.py seul)</td>
<td><span class="tag tag-fixed">âœ…</span> <strong>11 usages</strong> sur 7 fichiers (Garmin, mÃ©tÃ©o, Football, loto, import URL)</td>
<td>Retry + timeout + circuit breaker sur les appels HTTP</td>
</tr>
<tr>
<td><code>ClientIA()</code> direct</td>
<td>2 services crÃ©aient directement</td>
<td><span class="tag tag-fixed">âœ…</span> <strong>0 instanciation directe</strong> â€” tous via <code>obtenir_client_ia()</code></td>
<td>Singleton partagÃ©, rate limiting unifiÃ©</td>
</tr>
</table>

<h3>Adoption du framework dans les modules (Phase 3 : progrÃ¨s significatif)</h3>
<table class="compare-table">
<tr><th>Concept</th><th>v1</th><th>v2</th><th>Progression</th></tr>
<tr>
<td><code>error_boundary</code></td>
<td><strong>1/33</strong> modules (3%)</td>
<td><strong>~18/34</strong> modules (53%)</td>
<td><span class="delta delta-up">+50 pts</span> â€” DÃ©ployÃ© dans famille, maison, parametres, utilitaires, cuisine</td>
</tr>
<tr>
<td><code>@profiler_rerun</code></td>
<td><strong>4/33</strong> modules (12%)</td>
<td><strong>28/34</strong> modules (82%)</td>
<td><span class="delta delta-up">+70 pts</span> â€” Quasi-universel</td>
</tr>
<tr>
<td>Lazy loading correct</td>
<td><strong>28/33</strong> (85%)</td>
<td><strong>34/34</strong> (100%)</td>
<td><span class="delta delta-up">+15 pts</span> â€” <code>parametres/__init__.py</code> corrigÃ©</td>
</tr>
<tr>
<td><code>naviguer()</code></td>
<td><strong>10/33</strong> (30%)</td>
<td><strong>~15/34</strong> (44%)</td>
<td><span class="delta delta-up">+14 pts</span></td>
</tr>
<tr>
<td><code>KeyNamespace</code></td>
<td><strong>10/33</strong> (30%)</td>
<td><strong>~12/34</strong> (35%)</td>
<td><span class="delta delta-up">+5 pts</span></td>
</tr>
<tr>
<td><code>BaseModule</code></td>
<td><strong>0/33</strong></td>
<td><strong>0/34</strong></td>
<td><span class="delta delta-same">â†’</span> Pas adoptÃ© (app() reste le pattern)</td>
</tr>
</table>

<h3>Score global â€” Ã©volution</h3>
<div class="stats-grid" style="margin-top:1rem;">
  <div class="stat-card" style="border-left:4px solid var(--text-muted);">
    <div class="stat-value" style="color:var(--text-muted);">7.9</div>
    <div class="stat-label">Score v1 (audit initial)</div>
  </div>
  <div class="stat-card" style="border-left:4px solid var(--green);">
    <div class="stat-value" style="color:var(--green);">8.3</div>
    <div class="stat-label">Score v2 (cet audit)<span class="delta delta-up">+0.4</span></div>
  </div>
  <div class="stat-card" style="border-left:4px solid var(--accent);">
    <div class="stat-value" style="color:var(--accent);">6</div>
    <div class="stat-label">Bugs critiques corrigÃ©s</div>
  </div>
  <div class="stat-card" style="border-left:4px solid var(--accent);">
    <div class="stat-value" style="color:var(--accent);">+50%</div>
    <div class="stat-label">error_boundary adoption</div>
  </div>
  <div class="stat-card" style="border-left:4px solid var(--accent);">
    <div class="stat-value" style="color:var(--accent);">+70%</div>
    <div class="stat-label">profiler_rerun adoption</div>
  </div>
  <div class="stat-card" style="border-left:4px solid var(--accent);">
    <div class="stat-value" style="color:var(--accent);">50+</div>
    <div class="stat-label">@avec_cache usages (vs 0)</div>
  </div>
</div>

<div class="card" style="border-left:4px solid var(--green);margin-top:1rem;">
<h4>ğŸ† RÃ©sumÃ© de la progression</h4>
<p>En synthÃ¨se, les Phases 1 et 2 de la roadmap v1 sont <strong>pratiquement terminÃ©es</strong>. La Phase 3 (adoption framework modules) est avancÃ©e Ã  ~60%. Les Phases 4 (innovations Streamlit) et 5 (production hardening) restent largement ouvertes â€” c'est l'objet de la roadmap v2 ci-dessous.</p>
</div>

</section>

<!-- ==================== SECTION: src/core/ ==================== -->
<section id="core">
<h2>ğŸ§± src/core/ â€” Noyau applicatif</h2>
<div class="stats-grid">
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">86</div><div class="stat-label">Fichiers</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">13 288</div><div class="stat-label">Lignes</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">12</div><div class="stat-label">Sous-packages</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">8.3</div><div class="stat-label">Score /10<span class="delta delta-up">+0.2</span></div></div>
</div>

<div id="core-ai">
<details open>
<summary>ğŸ¤– core/ai/ â€” Client IA, Parser, Cache, Rate Limiting, Circuit Breaker <span class="badge badge-green">9/10</span></summary>
<div>
<table>
<tr><th>Fichier</th><th>Lignes</th><th>Exports clÃ©s</th><th>QualitÃ©</th></tr>
<tr><td><code>client.py</code></td><td class="align-right">543</td><td><code>ClientIA</code>, <code>obtenir_client_ia</code></td><td><span class="badge badge-green">9/10</span></td></tr>
<tr><td><code>parser.py</code></td><td class="align-right">300</td><td><code>AnalyseurIA</code> â€” 5 stratÃ©gies cascading</td><td><span class="badge badge-green">9/10</span></td></tr>
<tr><td><code>cache.py</code></td><td class="align-right">259</td><td><code>CacheIA</code> â€” cache sÃ©mantique SHA-256</td><td><span class="badge badge-green">8/10</span></td></tr>
<tr><td><code>rate_limit.py</code></td><td class="align-right">180</td><td><code>RateLimitIA</code> â€” quotas journalier/horaire</td><td><span class="badge badge-yellow">7/10</span></td></tr>
<tr><td><code>circuit_breaker.py</code></td><td class="align-right">280</td><td><code>CircuitBreaker</code> â€” FERME/OUVERT/SEMI_OUVERT, <code>@avec_circuit_breaker</code></td><td><span class="badge badge-green">8/10</span><span class="delta delta-up"> â†‘</span></td></tr>
</table>
<p><strong>~1 583 lignes</strong> &bull; Changement v2 : <code>@avec_circuit_breaker</code> supporte dÃ©sormais les fonctions async.</p>
<h4>Bug rÃ©siduel</h4>
<ul><li><span class="tag tag-medium">MEDIUM</span> <code>async_wrapper</code> : la lambda retourne une coroutine non awaitÃ©e â€” <code>cb.appeler(fn=lambda: func(...))</code> produit un objet coroutine au lieu du rÃ©sultat. Fix : <code>await</code> dans <code>appeler()</code> ou <code>asyncio.run_coroutine_threadsafe</code>.</li></ul>
</div>
</details>
</div>

<div id="core-caching">
<details>
<summary>ğŸ’¾ core/caching/ â€” Cache multi-niveaux (L1/L2/L3) <span class="badge badge-green">8.5/10</span><span class="delta delta-up"> +1.5</span></summary>
<div>
<table>
<tr><th>Fichier</th><th>Lignes</th><th>Exports clÃ©s</th></tr>
<tr><td><code>orchestrator.py</code></td><td class="align-right">265</td><td><code>CacheMultiNiveau</code>, <code>obtenir_cache</code> (singleton)</td></tr>
<tr><td><code>memory.py</code></td><td class="align-right">120</td><td><code>CacheMemoireN1</code> (LRU OrderedDict, O(1))</td></tr>
<tr><td><code>session.py</code></td><td class="align-right">110</td><td><code>CacheSessionN2</code> (Streamlit session)</td></tr>
<tr><td><code>file.py</code></td><td class="align-right">190</td><td><code>CacheFichierN3</code> (JSON atomique)</td></tr>
<tr><td><code>cache.py</code></td><td class="align-right">190</td><td><code>Cache</code> (faÃ§ade backward-compat)</td></tr>
<tr><td><code>base.py</code></td><td class="align-right">63</td><td><code>EntreeCache</code>, <code>StatistiquesCache</code></td></tr>
</table>
<p><strong>Score v1: 7/10 â†’ v2: 8.5/10</strong> â€” Le bug critique du cache cassÃ© est corrigÃ©. <code>@avec_cache</code> utilise maintenant <code>obtenir_cache()</code> singleton. Les 50+ usages montrent que le systÃ¨me fonctionne en production.</p>
</div>
</details>
</div>

<div id="core-config">
<details>
<summary>âš™ï¸ core/config/ â€” Configuration Pydantic BaseSettings <span class="badge badge-green">8/10</span></summary>
<div><p>4 fichiers, ~901 lignes. Pydantic v2 <code>BaseSettings</code>, cascade 3 niveaux (st.secrets â†’ env â†’ .env), <code>ValidateurConfiguration</code> fluent builder. Aucun changement depuis v1.</p></div>
</details>
</div>

<div id="core-db">
<details>
<summary>ğŸ—„ï¸ core/db/ â€” Moteur, Sessions, Migrations <span class="badge badge-green">8.5/10</span></summary>
<div><p>5 fichiers, ~860 lignes. <code>QueuePool</code> avec <code>pool_pre_ping</code>, context manager <code>obtenir_contexte_db()</code>, migrations SQL-file avec SHA-256 checksums. Architecture solide.</p></div>
</details>
</div>

<div id="core-decorators">
<details>
<summary>ğŸ¯ core/decorators/ â€” DÃ©corateurs unifiÃ©s <span class="badge badge-green">8.5/10</span><span class="delta delta-up"> +1.5</span></summary>
<div>
<p>5 fichiers, ~611 lignes. <strong>Score v1: 7/10 â†’ v2: 8.5/10</strong></p>
<ul>
<li><span class="tag tag-fixed">âœ…</span> <code>@avec_cache</code> corrigÃ© â€” utilise <code>obtenir_cache()</code></li>
<li><span class="tag tag-fixed">âœ…</span> BLAKE2b keys, sentinel pattern, <code>functools.wraps</code></li>
<li><span class="tag tag-fixed">âœ…</span> <code>@avec_resilience</code> compose RetryPolicy + TimeoutPolicy + CircuitBreaker</li>
</ul>
<h4>ProblÃ¨me rÃ©siduel</h4>
<ul><li><span class="tag tag-low">LOW</span> <code>@avec_session_db</code> ne gÃ¨re pas le paramÃ¨tre <code>db</code> positionnel (uniquement kwargs)</li></ul>
</div>
</details>
</div>

<div id="core-models">
<details>
<summary>ğŸ“Š core/models/ â€” ModÃ¨les SQLAlchemy (20 fichiers, ~100+ modÃ¨les) <span class="badge badge-green">9/10</span></summary>
<div><p>~5 200+ lignes. SQLAlchemy 2.0 modern (<code>Mapped[T]</code>, <code>mapped_column()</code>), PEP 562 lazy loading pour ~100 symboles, <code>StrEnum</code> Python 3.11+. QualitÃ© Ã©levÃ©e, pas de changement.</p></div>
</details>
</div>

<div id="core-state">
<details>
<summary>ğŸ”€ core/state/ â€” Gestion d'Ã©tat <span class="badge badge-green">8/10</span></summary>
<div><p>4 fichiers, ~747 lignes. State slices par domaine, decoupled via Protocol <code>SessionStorage</code>, navigation breadcrumbs.</p></div>
</details>
</div>

<div id="core-validation">
<details>
<summary>âœ… core/validation/ â€” Validation et sanitisation <span class="badge badge-yellow">7/10</span></summary>
<div><p>11 fichiers, ~1 042 lignes. Double approche (dict schemas + Pydantic) encore en place. Recommandation v2 : migration progressive vers Pydantic uniquement.</p></div>
</details>
</div>

<div id="core-monitoring">
<details>
<summary>ğŸ“¡ core/monitoring/ â€” MÃ©triques et santÃ© <span class="badge badge-green">8.5/10</span><span class="delta delta-up"> +0.5</span></summary>
<div><p>5 fichiers, ~1 090 lignes. <strong>v2 : <code>_verifier_cache()</code> corrigÃ©</strong> â€” health checks voient le vrai singleton cache. Kubernetes-style probes, <code>RerunProfiler</code> spÃ©cifique Streamlit.</p></div>
</details>
</div>

<div id="core-resilience">
<details>
<summary>ğŸ›¡ï¸ core/resilience/ â€” Politiques composables <span class="badge badge-green">9/10</span><span class="delta delta-up"> +1</span></summary>
<div><p>2 fichiers, ~367 lignes. <strong>v2 : <code>PolicyComposee.__add__</code> corrigÃ©</strong> â€” indentation correcte. Composition via opÃ©rateur <code>+</code> pleinement fonctionnelle. Factories prÃ©-configurÃ©es : <code>politique_ia()</code>, <code>politique_api_externe()</code>.</p></div>
</details>
</div>

<div id="core-observability">
<details>
<summary>ğŸ”­ core/observability/ â€” Contexte d'exÃ©cution <span class="badge badge-green">9/10</span></summary>
<div><p>2 fichiers, ~281 lignes. <code>contextvars.ContextVar</code>, tracing hiÃ©rarchique, <code>FiltreCorrelation</code>. Module le plus propre â€” aucun problÃ¨me.</p></div>
</details>
</div>

<div id="core-dateutils">
<details>
<summary>ğŸ“… core/date_utils/ â€” Utilitaires de dates <span class="badge badge-green">10/10</span></summary>
<div><p>5 fichiers, ~440 lignes. Fonctions pures, zÃ©ro import Streamlit, docstrings exemplaires. Module de rÃ©fÃ©rence qualitÃ©.</p></div>
</details>
</div>

<div id="core-root">
<details>
<summary>ğŸ“ core/ fichiers racine (11 fichiers) <span class="badge badge-green">8.5/10</span></summary>
<div><p>~2 371 lignes. PEP 562 lazy loading, <code>FiltreSecrets</code> (regex masking), <code>SessionStorage</code> Protocol, <code>RouteurOptimise</code> avec 34+ modules.</p></div>
</details>
</div>
</section>

<!-- ==================== SECTION: src/services/ ==================== -->
<section id="services">
<h2>âš™ï¸ src/services/ â€” Couche de services</h2>
<div class="stats-grid">
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">203</div><div class="stat-label">Fichiers</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">41 085</div><div class="stat-label">Lignes</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">56</div><div class="stat-label">@service_factory</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">8.0</div><div class="stat-label">Score /10<span class="delta delta-up">+0.6</span></div></div>
</div>

<div id="svc-core">
<details open>
<summary>ğŸ—ï¸ services/core/ â€” Infrastructure (56 fichiers, 10 106 LOC) <span class="badge badge-green">9/10</span></summary>
<div>
<p>Backbone complet : <code>BaseService[T]</code> gÃ©nÃ©rique CRUD, <code>BaseAIService</code> avec rate limiting/cache/circuit breaker intÃ©grÃ©s, <code>BusEvenements</code> pub/sub, <code>ServiceRegistry</code>, <code>ServicePipeline</code> middleware.</p>
<p><strong>NouveautÃ©s identifiÃ©es :</strong></p>
<ul>
<li><code>core/backup/</code> â€” 8 fichiers, 1 187 LOC : export/restore, sÃ©rialisation, identity mapping</li>
<li><code>core/notifications/</code> â€” 9 fichiers, 1 838 LOC : Ntfy, WebPush, inventory alerts, templates, persistence</li>
<li><code>core/observability/</code> â€” Health registry, metrics collector, span store (989 LOC)</li>
<li><code>core/specifications/</code> â€” Specification pattern composable pour inventaire & recettes (795 LOC)</li>
<li><code>core/utilisateur/</code> â€” Auth complÃ¨te (token, session, permissions, profil, historique, prÃ©fÃ©rences) â€” 1 664 LOC</li>
</ul>
<h4>Infrastructure non cÃ¢blÃ©e</h4>
<ul>
<li><span class="tag tag-medium">MEDIUM</span> <code>middleware/pipeline.py</code> (517 LOC) â€” aucun service ne l'utilise</li>
<li><span class="tag tag-medium">MEDIUM</span> <code>base/reactive.py</code> (272 LOC) â€” <code>ReactiveServiceMixin</code> non adoptÃ©</li>
<li><span class="tag tag-medium">MEDIUM</span> <code>specifications/</code> (795 LOC) â€” pattern non utilisÃ© en production</li>
</ul>
<p>Total infrastructure non cÃ¢blÃ©e : <strong>~1 584 LOC</strong>. DÃ©cision nÃ©cessaire : adopter ou deprecater.</p>
</div>
</details>
</div>

<div id="svc-cuisine">
<details>
<summary>ğŸ½ï¸ services/cuisine/ â€” 51 fichiers, 9 534 LOC <span class="badge badge-green">8.5/10</span><span class="delta delta-up"> +1</span></summary>
<div>
<p>5 domaines (recettes, planning, courses, suggestions, batch_cooking). 10 <code>@service_factory</code>. Utilisation exemplaire des dÃ©corateurs (<code>@avec_session_db</code> + <code>@avec_cache</code> + <code>@avec_gestion_erreurs</code>).</p>
<h4>Changements v2</h4>
<ul>
<li><span class="tag tag-fixed">âœ…</span> <code>@avec_cache</code> dÃ©ployÃ© dans recettes/service, courses/service, batch_cooking (via <code>obtenir_cache()</code>)</li>
<li><span class="tag tag-fixed">âœ…</span> <code>importer.py</code> rÃ©duit Ã  134 LOC (wrapper), <code>import_url.py</code> est le service principal</li>
</ul>
<h4>ProblÃ¨me rÃ©siduel</h4>
<ul><li><span class="tag tag-medium">MEDIUM</span> <code>ServiceSuggestions</code> bypass <code>BaseAIService</code> â€” instancie <code>ClientIA</code> + <code>RateLimitIA</code> directement, perd circuit breaker et cache sÃ©mantique</li></ul>
</div>
</details>
</div>

<div id="svc-famille">
<details>
<summary>ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ services/famille/ â€” 22 fichiers, 4 775 LOC <span class="badge badge-green">8.5/10</span><span class="delta delta-up"> +1.5</span></summary>
<div>
<p><strong>Meilleure adoption event bus</strong> de la codebase (15 emissions, 5 fichiers). 12 <code>@service_factory</code>.</p>
<h4>Changements v2 majeurs</h4>
<ul>
<li><span class="tag tag-fixed">âœ…</span> <code>JulesAIService</code> + <code>WeekendAIService</code> : <code>@service_factory</code> + <code>obtenir_client_ia()</code> + <code>BaseAIService</code></li>
<li><span class="tag tag-fixed">âœ…</span> <code>@avec_cache</code> dÃ©ployÃ© : achats (5), calendrier_planning (2), budget/service (3), sante (7), routines (6), weekend (4), suivi_perso (2), activites (1)</li>
<li><span class="tag tag-fixed">âœ…</span> <code>@avec_gestion_erreurs</code> dÃ©ployÃ© dans tous les services famille</li>
</ul>
</div>
</details>
</div>

<div id="svc-inventaire">
<details>
<summary>ğŸ“¦ services/inventaire/ â€” 7 fichiers, 1 111 LOC <span class="badge badge-green">9/10</span></summary>
<div><p>Architecture exemplaire : mixins (operations, IO, stats, stock), <code>BaseService[ArticleInventaire]</code> + <code>BaseAIService</code>, tous les dÃ©corateurs utilisÃ©s. Module de rÃ©fÃ©rence.</p></div>
</details>
</div>

<div id="svc-integrations">
<details>
<summary>ğŸ”Œ services/integrations/ â€” 30 fichiers, 5 860 LOC <span class="badge badge-green">8/10</span><span class="delta delta-up"> +0.5</span></summary>
<div>
<h4>Changement v2</h4>
<ul>
<li><span class="tag tag-fixed">âœ…</span> <code>@avec_resilience</code> ajoutÃ© : Garmin (3 mÃ©thodes), mÃ©tÃ©o (2), produit.py (1), import URL (1)</li>
</ul>
<h4>ProblÃ¨mes rÃ©siduels</h4>
<ul>
<li><span class="tag tag-medium">MEDIUM</span> <code>images/generator.py</code> (496 LOC) â€” pas de <code>@service_factory</code></li>
<li><span class="tag tag-medium">MEDIUM</span> PWA services (4 fichiers, 624 LOC) â€” pas de <code>@service_factory</code></li>
</ul>
</div>
</details>
</div>

<div id="svc-maison">
<details>
<summary>ğŸ  services/maison/ â€” 13 fichiers, 2 828 LOC <span class="badge badge-green">8/10</span><span class="delta delta-up"> +1</span></summary>
<div>
<p>3 services <code>BaseAIService</code>, chaÃ®ne de mixins (Catalogueâ†’Tachesâ†’Gamificationâ†’Service).</p>
<h4>ProblÃ¨me rÃ©siduel</h4>
<ul><li><span class="tag tag-low">LOW</span> Pas de <code>@avec_cache</code> â€” requÃªtes DB rÃ©pÃ©tÃ©es pour le contexte IA</li></ul>
</div>
</details>
</div>

<div id="svc-jeux">
<details>
<summary>ğŸ® services/jeux/ â€” 15 fichiers, 5 118 LOC <span class="badge badge-green">8/10</span></summary>
<div>
<p>12 <code>@service_factory</code>. <code>JeuxAIService</code> avec prompt Ã©thique exemplaire. <code>@avec_resilience</code> sur football_data et loto_data.</p>
<h4>ProblÃ¨me</h4>
<ul><li><span class="tag tag-low">LOW</span> CRUD services (paris 601 LOC, loto 350 LOC) ne dÃ©rivent pas de <code>BaseService[T]</code></li></ul>
</div>
</details>
</div>

<div id="svc-rapports">
<details>
<summary>ğŸ“„ services/rapports/ â€” 7 fichiers, 1 681 LOC <span class="badge badge-yellow">7/10</span></summary>
<div><p>PDF multi-domaines avec <code>@service_factory</code>. Pas de <code>BaseService</code>, pas de cache, pas d'events.</p></div>
</details>
</div>
</section>

<!-- ==================== SECTION: src/modules/ ==================== -->
<section id="modules">
<h2>ğŸ“¦ src/modules/ â€” Modules mÃ©tier (UI)</h2>
<div class="stats-grid">
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">186</div><div class="stat-label">Fichiers</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">27 942</div><div class="stat-label">Lignes</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">34</div><div class="stat-label">Points d'entrÃ©e app()</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">8.0</div><div class="stat-label">Score /10<span class="delta delta-up">+0.8</span></div></div>
</div>

<div id="mod-accueil">
<details>
<summary>ğŸ  modules/accueil/ â€” Dashboard central <span class="badge badge-green">8/10</span></summary>
<div><p>6 fichiers, 633 LOC. <code>@profiler_rerun</code>, <code>@ui_fragment</code>, <code>@auto_refresh(30s)</code> â€” le seul module utilisant les fragments Streamlit. 100% service delegation.</p></div>
</details>
</div>

<div id="mod-cuisine">
<details>
<summary>ğŸ½ï¸ modules/cuisine/ â€” Hub cuisine (51 fichiers, 8 014 LOC) <span class="badge badge-green">9/10</span></summary>
<div>
<p>5 sous-modules (recettes, courses, inventaire, planificateur_repas, batch_cooking). <code>error_boundary</code> sur tous les tabs, <code>@profiler_rerun</code> universel, <code>ModuleState</code> dans inventaire.</p>
<p><strong>Module le plus complet et le mieux structurÃ©</strong> â€” gold standard Ã  reproduire.</p>
</div>
</details>
</div>

<div id="mod-famille">
<details>
<summary>ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ modules/famille/ â€” Hub familial (26 fichiers, 3 719 LOC) <span class="badge badge-green">8/10</span><span class="delta delta-up"> +1</span></summary>
<div>
<h4>Changements v2</h4>
<ul>
<li><span class="tag tag-fixed">âœ…</span> <code>error_boundary</code> dÃ©ployÃ© dans hub_famille, activites, routines, jules, weekend, achats</li>
<li><span class="tag tag-fixed">âœ…</span> <code>@profiler_rerun</code> sur tous les sous-modules</li>
<li>100% service delegation, logique pure dans <code>*_utils.py</code></li>
</ul>
</div>
</details>
</div>

<div id="mod-maison">
<details>
<summary>ğŸ¡ modules/maison/ â€” Gestion habitat (34 fichiers, 4 477 LOC) <span class="badge badge-green">8/10</span><span class="delta delta-up"> +1</span></summary>
<div>
<p><code>error_boundary</code> sur tous les onglets (entretien 7x, jardin 7x, charges 5x, depenses 3x). Architecture layered : styles â†’ data â†’ logic â†’ onglets â†’ ui. Gamification unique (scores, badges, streaks).</p>
</div>
</details>
</div>

<div id="mod-jeux">
<details>
<summary>ğŸ® modules/jeux/ â€” Loto et paris (28 fichiers, 3 911 LOC) <span class="badge badge-yellow">7.5/10</span></summary>
<div>
<p>Paris : <code>error_boundary</code> âœ…. <strong>Loto : importÃ© mais NON utilisÃ©</strong> â€” 7 tabs sans protection.</p>
<p>Seul module utilisant <code>@avec_cache</code> au niveau module (6 usages dans utils.py).</p>
</div>
</details>
</div>

<div id="mod-planning">
<details>
<summary>ğŸ“… modules/planning/ â€” Calendrier unifiÃ© (12 fichiers, 2 176 LOC) <span class="badge badge-green">8/10</span></summary>
<div><p>Architecture excellente dans calendrier/ (types â†’ converters â†’ aggregation â†’ analytics â†’ components). <code>error_boundary</code> dans calendrier tabs. Manque dans timeline_ui et templates_ui.</p></div>
</details>
</div>

<div id="mod-parametres">
<details>
<summary>âš™ï¸ modules/parametres/ â€” ParamÃ¨tres (9 fichiers, 966 LOC) <span class="badge badge-green">8/10</span><span class="delta delta-up"> +1</span></summary>
<div>
<h4>Changements v2</h4>
<ul>
<li><span class="tag tag-fixed">âœ…</span> Imports lazy dans <code>app()</code> (corrigÃ©s du module-level)</li>
<li><span class="tag tag-fixed">âœ…</span> <code>error_boundary</code> sur les 8 tabs â€” usage le plus consistant</li>
</ul>
</div>
</details>
</div>

<div id="mod-utilitaires">
<details>
<summary>ğŸ”§ modules/utilitaires/ â€” Outils (13 fichiers, 2 799 LOC) <span class="badge badge-yellow">7.5/10</span></summary>
<div>
<p><code>chat_ia.py</code> : seul module subclassant <code>BaseAIService</code> avec <code>@service_factory</code> â€” pattern exemplaire. Utilise <code>st.write_stream()</code> natif.</p>
<p><code>notifications_push.py</code> : 5 <code>error_boundary</code>, <code>@profiler_rerun</code> â€” bien structurÃ©.</p>
</div>
</details>
</div>

<div id="mod-framework">
<details>
<summary>ğŸ§© modules/_framework/ â€” Framework de modules (6 fichiers, 1 044 LOC) <span class="badge badge-purple">Design: 9 â€” Adoption: 55%</span></summary>
<div>
<h3>Taux d'adoption v1 â†’ v2</h3>
<div class="adoption-row">
  <div class="concept"><code>error_boundary</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-yellow" style="width:53%"></div></div></div>
  <div class="ratio"><strong>18/34</strong><span class="delta delta-up">+50pts</span></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>ModuleState</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-red" style="width:3%"></div></div></div>
  <div class="ratio"><strong>1/34</strong><span class="delta delta-same">â†’</span></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>BaseModule</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-red" style="width:0%"></div></div></div>
  <div class="ratio"><strong>0/34</strong><span class="delta delta-same">â†’</span></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>@ui_fragment</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-red" style="width:3%"></div></div></div>
  <div class="ratio"><strong>1/34</strong><span class="delta delta-same">â†’</span></div>
</div>

<div class="card" style="border-left:4px solid var(--purple);">
<p><strong>Recommandation v2 :</strong> <code>BaseModule</code> reste non adoptÃ© â€” considÃ©rer le retrait et standardiser sur <code>def app()</code> + <code>@profiler_rerun</code> + <code>error_boundary</code> comme pattern officiel. Cela fonctionne bien dÃ©jÃ .</p>
</div>
</div>
</details>
</div>
</section>

<!-- ==================== SECTION: src/ui/ ==================== -->
<section id="ui">
<h2>ğŸ¨ src/ui/ â€” Couche UI et Design System</h2>
<div class="stats-grid">
  <div class="stat-card"><div class="stat-value" style="color:var(--yellow);">61</div><div class="stat-label">Fichiers</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--yellow);">8 990</div><div class="stat-label">Lignes</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--yellow);">12</div><div class="stat-label">Sous-packages</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--yellow);">7.0</div><div class="stat-label">Score /10<span class="delta delta-down">-1.7</span></div></div>
</div>

<div class="card" style="border-left:4px solid var(--orange);">
<h4>âš ï¸ Score revu Ã  la baisse</h4>
<p>Le score v1 (8.7) Ã©tait basÃ© sur l'infrastructure. L'analyse v2 approfondie rÃ©vÃ¨le un <strong>Ã©cart significatif entre l'architecture (excellente) et l'adoption rÃ©elle</strong>. Les tokens sÃ©mantiques <code>Sem</code> ne sont utilisÃ©s que dans <strong>1 fichier sur 61</strong>. Les views/ contournent tout le design system.</p>
</div>

<details open>
<summary>ğŸ¨ Infrastructure â€” Tokens, Theme, CSS Engine <span class="badge badge-green">9/10</span></summary>
<div>
<table>
<tr><th>Composant</th><th>Lignes</th><th>QualitÃ©</th><th>Adoption</th></tr>
<tr><td><code>tokens.py</code> â€” 8 StrEnum (Couleur, Espacement, Rayon, etc.)</td><td class="align-right">239</td><td><span class="badge badge-green">9/10</span></td><td>20% des fichiers</td></tr>
<tr><td><code>tokens_semantic.py</code> â€” <code>Sem</code> StrEnum + CSS vars light/dark</td><td class="align-right">214</td><td><span class="badge badge-green">9/10</span></td><td><span class="tag tag-critical">1.6%</span> (1/61)</td></tr>
<tr><td><code>engine/css.py</code> â€” MD5 dedup, batch injection, atomic classes</td><td class="align-right">432</td><td><span class="badge badge-green">9/10</span></td><td>UtilisÃ© via pipeline</td></tr>
<tr><td><code>theme.py</code> â€” Mode light/dark/auto, densitÃ©</td><td class="align-right">315</td><td><span class="badge badge-green">9/10</span></td><td>Infrastructure seule</td></tr>
</table>
</div>
</details>

<details>
<summary>ğŸ§© Components, Feedback, State, Tablet <span class="badge badge-green">8/10</span></summary>
<div>
<ul>
<li><strong>components/</strong> (13 fichiers, 1 950 LOC) â€” atoms, filters, forms, charts, metrics, streaming, layouts. <code>metrics_row.py</code> = gold standard (utilise <code>Sem</code>)</li>
<li><strong>feedback/</strong> (5 fichiers, 870 LOC) â€” <code>SuiviProgression</code> avec ETA, Result pattern bridge, toasts avec dÃ©dup</li>
<li><strong>state/url.py</strong> (533 LOC) â€” Deep linking via <code>st.query_params</code>, widgets URL-synced. Excellent.</li>
<li><strong>tablet/</strong> (6 fichiers, 1 230 LOC) â€” Mode cuisine tactile avec timer, step-by-step. Production-ready.</li>
<li><strong>fragments.py</strong> (453 LOC) â€” 6 dÃ©corateurs wrapping <code>@st.fragment</code>, <code>FragmentGroup</code></li>
</ul>
</div>
</details>

<details>
<summary>âš ï¸ Points faibles â€” views/, adoption tokens, a11y <span class="badge badge-red">5/10</span></summary>
<div>
<h4>P0 â€” Tokens sÃ©mantiques non adoptÃ©s</h4>
<p>Seul <code>metrics_row.py</code> utilise <code>Sem</code>. Tout le dark mode infrastructure est <strong>fonctionnellement inerte</strong>.</p>

<h4>P1 â€” SystÃ¨me de tokens dual</h4>
<p><code>layout/styles.py</code> dÃ©finit ses propres <code>:root</code> CSS vars (<code>--primary-color</code>, <code>--bg-color</code>) qui <strong>dupliquent et concurrencent</strong> les enums <code>Couleur</code> et <code>Sem</code>.</p>

<h4>P2 â€” views/ bypass le design system</h4>
<p>11 fichiers, 1 575 LOC avec inline HTML/CSS, couleurs hardcodÃ©es, zÃ©ro annotations de type. Risque XSS.</p>

<h4>P3 â€” AccessibilitÃ© partielle</h4>
<p><code>a11y.py</code> (288 LOC) fournit les utilitaires mais ils ne sont quasiment pas appelÃ©s. Contraste calculable mais jamais vÃ©rifiÃ© sur les tokens.</p>

<h4>P4 â€” <code>@composant_ui</code> sous-adoptÃ©</h4>
<p>Seul <code>atoms.py</code> s'enregistre. Le catalogue auto-gÃ©nÃ©rÃ© est incomplet.</p>
</div>
</details>
</section>

<!-- ==================== SECTION: src/api/ ==================== -->
<section id="api">
<h2>ğŸŒ src/api/ â€” API REST FastAPI</h2>
<div class="stats-grid">
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">33</div><div class="stat-label">Fichiers</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">3 307</div><div class="stat-label">Lignes</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">26</div><div class="stat-label">Endpoints</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">8.2</div><div class="stat-label">Score /10</div></div>
</div>

<details open>
<summary>ğŸ“¡ Architecture et endpoints</summary>
<div>
<p>API standalone (non utilisÃ©e par l'app Streamlit) partageant les modÃ¨les et services de <code>src/core/</code>. JWT dual-mode (API + Supabase). Rate limiting multi-fenÃªtres avec backend Redis production. ETag middleware. 6 domaines mÃ©tier.</p>

<h4>NouveautÃ©s v2 identifiÃ©es</h4>
<ul>
<li><code>RecettePatch</code> est maintenant dÃ©fini dans <code>schemas/recettes.py</code> (PATCH partiel)</li>
<li><code>redis_storage.py</code> implÃ©mente le backend Redis pour rate limiting en production</li>
<li>Brute-force protection sur <code>/login</code> (5 tentatives/min, block 5min)</li>
<li>Production safety : <code>RuntimeError</code> si secret JWT = default en prod</li>
</ul>

<h4>ProblÃ¨mes rÃ©siduels</h4>
<ul>
<li><span class="tag tag-high">HIGH</span> <code>push.py</code> utilise <code>current_user["user_id"]</code> mais <code>get_current_user()</code> retourne <code>{"id": ...}</code> â†’ <code>KeyError</code></li>
<li><span class="tag tag-medium">MEDIUM</span> <code>executer_async()</code> expose <code>str(e)</code> brut dans <code>HTTPException(500)</code> â€” fuite d'infos internes possible</li>
<li><span class="tag tag-medium">MEDIUM</span> <code>ETagMiddleware</code> incomplet (ne gÃ©nÃ¨re pas les ETags)</li>
<li><span class="tag tag-low">LOW</span> Pas de <code>securitySchemes</code> OpenAPI â€” Swagger n'affiche pas le bouton Authorize</li>
</ul>
</div>
</details>
</section>

<!-- ==================== SECTION: app.py ==================== -->
<section id="app">
<h2>ğŸš€ app.py â€” Point d'entrÃ©e principal</h2>
<div class="stats-grid">
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">113</div><div class="stat-label">Lignes</div></div>
  <div class="stat-card"><div class="stat-value" style="color:var(--green);">8.5</div><div class="stat-label">Score /10<span class="delta delta-up">+0.5</span></div></div>
</div>

<details open>
<summary>Changements v2</summary>
<div>
<ul>
<li><span class="tag tag-fixed">âœ…</span> CSS injectÃ© une seule fois via <code>initialiser_app()</code> (pipeline unifiÃ©)</li>
<li><span class="tag tag-fixed">âœ…</span> Bootstrap propre : env â†’ paths â†’ logging â†’ IoC â†’ layout â†’ router</li>
<li>Recovery : try/except global + bouton reset + debug mode</li>
<li><code>valider_config=False</code> â€” intentionnel pour performance (lazy mode)</li>
</ul>
</div>
</details>
</section>

<!-- ==================== ADOPTION MATRIX ==================== -->
<section id="adoption">
<h2>ğŸ” Matrice d'adoption des concepts â€” v2</h2>

<h3>Concepts dans les Services</h3>
<div class="adoption-row">
  <div class="concept"><code>@service_factory</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:100%"></div></div></div>
  <div class="ratio"><strong>56/56</strong><span class="delta delta-up">+9</span></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>BaseAIService</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:100%"></div></div></div>
  <div class="ratio"><strong>14/14 IA</strong><span class="delta delta-up">+2</span></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>@avec_session_db</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:95%"></div></div></div>
  <div class="ratio">~80+ mÃ©thodes</div>
</div>
<div class="adoption-row">
  <div class="concept"><code>@avec_cache</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:80%"></div></div></div>
  <div class="ratio"><strong>50+</strong><span class="delta delta-up">â˜…â˜…â˜…</span></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>@avec_gestion_erreurs</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:75%"></div></div></div>
  <div class="ratio">cuisine + famille + jeux + maison</div>
</div>
<div class="adoption-row">
  <div class="concept"><code>@avec_resilience</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-yellow" style="width:50%"></div></div></div>
  <div class="ratio"><strong>11 usages</strong><span class="delta delta-up">+10</span></div>
</div>
<div class="adoption-row">
  <div class="concept">Event Bus</div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-yellow" style="width:30%"></div></div></div>
  <div class="ratio">Famille seul (15 emissions)</div>
</div>
<div class="adoption-row">
  <div class="concept"><code>obtenir_client_ia()</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:100%"></div></div></div>
  <div class="ratio"><strong>17 fichiers, 0 direct</strong><span class="delta delta-up">â˜…â˜…â˜…</span></div>
</div>

<h3>Concepts dans les Modules</h3>
<div class="adoption-row">
  <div class="concept"><code>app()</code> entry point</div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:100%"></div></div></div>
  <div class="ratio"><strong>34/34</strong></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>@profiler_rerun</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:82%"></div></div></div>
  <div class="ratio"><strong>28/34</strong><span class="delta delta-up">+24</span></div>
</div>
<div class="adoption-row">
  <div class="concept"><code>error_boundary</code></div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-yellow" style="width:53%"></div></div></div>
  <div class="ratio"><strong>18/34</strong><span class="delta delta-up">+17</span></div>
</div>
<div class="adoption-row">
  <div class="concept">100% service delegation</div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:100%"></div></div></div>
  <div class="ratio"><strong>34/34</strong> (0 accÃ¨s DB direct)</div>
</div>
<div class="adoption-row">
  <div class="concept">Lazy loading</div>
  <div style="flex:1"><div class="progress-bar"><div class="progress-fill progress-green" style="width:100%"></div></div></div>
  <div class="ratio"><strong>34/34</strong><span class="delta delta-up">+6</span></div>
</div>
</section>

<!-- ==================== ISSUES RÃ‰SIDUELS ==================== -->
<section id="issues">
<h2>ğŸ› ProblÃ¨mes rÃ©siduels â€” Top 10</h2>

<table>
<tr><th>#</th><th>SÃ©vÃ©ritÃ©</th><th>Localisation</th><th>Description</th></tr>
<tr>
<td>1</td><td><span class="tag tag-high">HIGH</span></td>
<td><code>api/routes/push.py</code></td>
<td><code>current_user["user_id"]</code> â†’ devrait Ãªtre <code>current_user["id"]</code>. Bug runtime non testÃ©.</td>
</tr>
<tr>
<td>2</td><td><span class="tag tag-high">HIGH</span></td>
<td><code>core/ai/circuit_breaker.py</code></td>
<td><code>async_wrapper</code> : la coroutine retournÃ©e par la lambda n'est jamais awaitÃ©e dans <code>appeler()</code>.</td>
</tr>
<tr>
<td>3</td><td><span class="tag tag-medium">MEDIUM</span></td>
<td><code>services/core/events/</code></td>
<td>Event bus adoptÃ© uniquement par famille/. Les events pour recettes, inventaire, cuisine ne sont jamais Ã©mis malgrÃ© des subscribers dÃ©finis.</td>
</tr>
<tr>
<td>4</td><td><span class="tag tag-medium">MEDIUM</span></td>
<td><code>ui/tokens_semantic.py</code></td>
<td>Tokens <code>Sem</code> utilisÃ©s dans 1/61 fichiers. Dark mode infrastructure inerte.</td>
</tr>
<tr>
<td>5</td><td><span class="tag tag-medium">MEDIUM</span></td>
<td><code>ui/layout/styles.py</code></td>
<td>Variables CSS <code>:root</code> dupliquent et concurrencent les tokens <code>Couleur</code>/<code>Sem</code>.</td>
</tr>
<tr>
<td>6</td><td><span class="tag tag-medium">MEDIUM</span></td>
<td><code>services/core/</code></td>
<td>~1 584 LOC d'infrastructure (middleware pipeline, reactive, specifications) non utilisÃ©s.</td>
</tr>
<tr>
<td>7</td><td><span class="tag tag-medium">MEDIUM</span></td>
<td><code>cuisine/suggestions/service.py</code></td>
<td>Bypass <code>BaseAIService</code> â€” instancie <code>ClientIA</code> + <code>RateLimitIA</code> directement.</td>
</tr>
<tr>
<td>8</td><td><span class="tag tag-medium">MEDIUM</span></td>
<td><code>modules/jeux/loto/__init__.py</code></td>
<td><code>error_boundary</code> importÃ© mais non utilisÃ© â€” 7 tabs sans protection.</td>
</tr>
<tr>
<td>9</td><td><span class="tag tag-low">LOW</span></td>
<td><code>services/integrations/</code></td>
<td><code>images/generator.py</code> (496 LOC) et PWA (624 LOC) sans <code>@service_factory</code>.</td>
</tr>
<tr>
<td>10</td><td><span class="tag tag-low">LOW</span></td>
<td><code>ui/views/</code></td>
<td>11 fichiers avec inline HTML/CSS, hardcoded colors, zÃ©ro type annotations. Risque XSS.</td>
</tr>
</table>
</section>

<!-- ==================== INNOVATIONS ==================== -->
<section id="innovations">
<h2>ğŸ’¡ AmÃ©liorations innovantes â€” Streamlit 2026</h2>

<div class="innovation-grid">

<div class="innovation-card" style="border-left-color:var(--green);">
<h4>1. ğŸ§© <code>@st.fragment</code> universel</h4>
<p>Votre <code>ui/fragments.py</code> wraps <code>@st.fragment</code> avec 6 variantes. Un seul module l'utilise (accueil). DÃ©ployer <code>@ui_fragment</code> sur tous les tabs interactifs (formulaires, graphiques) pour du refresh partiel sans recharger la page entiÃ¨re.</p>
<div class="impact"><span>Impact :</span> Performance +++, UX +++. <strong>Quick win â€” existe dÃ©jÃ .</strong></div>
</div>

<div class="innovation-card" style="border-left-color:var(--green);">
<h4>2. â±ï¸ Dashboard auto-refresh</h4>
<p><code>@auto_refresh(interval=30)</code> existe dÃ©jÃ  dans <code>fragments.py</code> et est utilisÃ© 1 fois (alertes accueil). Ã‰tendre aux mÃ©triques, timeline, status system.</p>
<div class="impact"><span>Impact :</span> UX +++ â€” donnÃ©es toujours fraÃ®ches sans interaction.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--accent);">
<h4>3. ğŸ’¬ <code>@st.dialog</code> natif</h4>
<p><code>Modale</code> est marquÃ© DEPRECATED dans <code>components/dynamic.py</code>. Streamlit 1.35+ fournit <code>@st.dialog</code> pour les formulaires modaux. Migration 1:1.</p>
<div class="impact"><span>Impact :</span> UX ++, maintenance --. Supprime du CSS custom.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--accent);">
<h4>4. ğŸŒŠ <code>st.write_stream()</code> partout</h4>
<p><code>chat_ia.py</code> utilise dÃ©jÃ  <code>st.write_stream()</code>. Ã‰tendre Ã  toutes les rÃ©ponses IA (suggestions recettes, planning, analyses) pour du streaming progressif natif.</p>
<div class="impact"><span>Impact :</span> UX +++. Remplace <code>StreamingContainer</code> qui bufferise.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--purple);">
<h4>5. ğŸŒ™ Dark mode effectif</h4>
<p>Toute l'infrastructure dark mode existe (<code>Sem</code>, <code>_LIGHT_MAPPING</code>/<code>_DARK_MAPPING</code>, <code>theme.py</code>). Une migration systÃ©matique des couleurs hardcodÃ©es vers <code>Sem.*</code> activerait le dark mode instantanÃ©ment.</p>
<div class="impact"><span>Impact :</span> UX ++++. <strong>ROI exceptionnel â€” infrastructure dÃ©jÃ  en place.</strong></div>
</div>

<div class="innovation-card" style="border-left-color:var(--purple);">
<h4>6. ğŸ“Š Event bus â†’ invalidation cache rÃ©active</h4>
<p>Les subscribers pour cache invalidation existent dans <code>events/subscribers.py</code>. Les Ã©vÃ©nements typÃ©s (<code>recette.planifiee</code>, <code>stock.modifie</code>) sont dÃ©finis. Il manque juste les <code>emettre()</code> dans cuisine/, inventaire/, maison/.</p>
<div class="impact"><span>Impact :</span> Performance +++. Cache automatiquement invalidÃ© sur mutations.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--orange);">
<h4>7. ğŸ”Œ <code>st.connection()</code> natif</h4>
<p>Streamlit fournit <code>st.connection("sql")</code> avec health check et reconnexion intÃ©grÃ©s. Pourrait complÃ©ter le <code>QueuePool</code> existant pour une meilleure intÃ©gration Streamlit.</p>
<div class="impact"><span>Impact :</span> FiabilitÃ© +, code -.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--orange);">
<h4>8. ğŸ“± PWA offline rÃ©el</h4>
<p>Les meta PWA sont injectÃ©s, la config existe dans <code>integrations/web/pwa/</code> (624 LOC). Ajouter un Service Worker fonctionnel pour consultation offline recettes/courses/planning.</p>
<div class="impact"><span>Impact :</span> UX ++++ â€” app utilisable sans rÃ©seau.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--cyan);">
<h4>9. ğŸ§  Chat IA contextuel par module</h4>
<p><code>chat_ia.py</code> prouve le pattern. Ajouter un <code>st.chat_input()</code> contextuel dans cuisine (recettes) et famille (Jules) avec context-aware prompts.</p>
<div class="impact"><span>Impact :</span> Innovation ++++.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--cyan);">
<h4>10. ğŸ“Š Specification pattern pour queries</h4>
<p><code>core/specifications/</code> (795 LOC) implÃ©mente un pattern de composition de requÃªtes. L'adopter dans inventaire et recettes permettrait des filtres dynamiques composables cÃ´tÃ© utilisateur.</p>
<div class="impact"><span>Impact :</span> Architecture +++, DX ++.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--cyan);">
<h4>11. ğŸ¨ Storybook vivant</h4>
<p><code>views/design_system.py</code> auto-gÃ©nÃ¨re un catalogue depuis <code>@composant_ui</code>. Enregistrer TOUS les composants et ajouter des live previews pour un vrai Storybook interactif.</p>
<div class="impact"><span>Impact :</span> DX +++, documentation live.</div>
</div>

<div class="innovation-card" style="border-left-color:var(--cyan);">
<h4>12. ğŸ§ª Visual regression tests</h4>
<p><code>testing/visual_regression.py</code> (292 LOC) existe avec <code>SnapshotTester</code> et hash comparison. Ã‰crire les tests rÃ©els pour protÃ©ger les composants critiques.</p>
<div class="impact"><span>Impact :</span> QualitÃ© ++, rÃ©gression prevention.</div>
</div>

</div>
</section>

<!-- ==================== ROADMAP v2 ==================== -->
<section id="roadmap">
<h2>ğŸ—ºï¸ Roadmap v2 â€” 6 phases, 24 semaines</h2>

<div class="timeline">

<div class="timeline-item phase1">
<h4><span class="tag tag-fixed">Phase 1 âœ…</span> Corrections critiques â€” <strong>TERMINÃ‰E</strong></h4>
<p>Les 6 corrections critiques de la roadmap v1 ont Ã©tÃ© appliquÃ©es.</p>
<ul>
<li>âœ… <code>@avec_cache</code> â†’ <code>obtenir_cache()</code></li>
<li>âœ… <code>@avec_circuit_breaker</code> async</li>
<li>âœ… <code>PolicyComposee.__add__</code> indentation</li>
<li>âœ… <code>_verifier_cache()</code> singleton</li>
<li>âœ… Double CSS app.py</li>
<li>âœ… Fichiers deprecated nettoyÃ©s</li>
</ul>
</div>

<div class="timeline-item phase2">
<h4><span class="tag tag-critical">Phase 2</span> Bugs rÃ©siduels & finitions â€” Semaines 1-2</h4>
<p>Corriger les 3 bugs identifiÃ©s et finaliser l'adoption Phase 2/3 de la roadmap v1.</p>
<ul>
<li>ğŸ”´ <strong>Fix <code>push.py</code></strong> : <code>current_user["user_id"]</code> â†’ <code>current_user["id"]</code></li>
<li>ğŸ”´ <strong>Fix circuit breaker async</strong> : await la coroutine dans <code>appeler()</code></li>
<li>ğŸŸ¡ <strong>event bus cuisine</strong> : ajouter <code>emettre()</code> dans recettes, planning, courses, batch_cooking</li>
<li>ğŸŸ¡ <strong>event bus inventaire/maison</strong> : ajouter Ã©missions pour stock.modifie, entretien.complete</li>
<li>ğŸŸ¡ <strong><code>error_boundary</code> manquants</strong> : loto/ (7 tabs), timeline_ui, templates_ui, chat_ia, scan_factures</li>
<li>ğŸŸ¡ <strong><code>ServiceSuggestions</code></strong> : migrer vers <code>BaseAIService</code></li>
<li>ğŸŸ¢ <strong>Enregistrer</strong> <code>images/generator.py</code> et PWA services avec <code>@service_factory</code></li>
</ul>
</div>

<div class="timeline-item phase3">
<h4><span class="tag tag-high">Phase 3</span> Design System â€” unification tokens â€” Semaines 3-6</h4>
<p>Activer le dark mode et unifier le systÃ¨me de tokens.</p>
<ul>
<li>ğŸŸ¡ <strong>Unifier <code>:root</code> CSS vars avec <code>Sem</code></strong> : remplacer <code>styles.py</code> hardcoded par <code>injecter_tokens_semantiques()</code></li>
<li>ğŸŸ¡ <strong>Migrer components/</strong> vers <code>Couleur.*</code> et <code>Sem.*</code> (12 fichiers)</li>
<li>ğŸŸ¡ <strong>Migrer views/</strong> vers tokens (11 fichiers, ~15 couleurs hardcodÃ©es)</li>
<li>ğŸŸ¢ <strong>Enregistrer composants</strong> avec <code>@composant_ui</code> (filters, forms, data, metrics_row, streaming)</li>
<li>ğŸŸ¢ <strong>Tests contraste</strong> : appeler <code>verifier_contraste()</code> sur tous les couples <code>Sem</code></li>
<li>ğŸŸ¢ <strong>Renommer</strong> <code>layouts/</code> â†’ <code>grid/</code> pour Ã©liminer la collision avec <code>layout/</code></li>
</ul>
</div>

<div class="timeline-item phase4">
<h4><span class="tag tag-medium">Phase 4</span> Innovations Streamlit â€” Semaines 7-12</h4>
<p>Adopter les fonctionnalitÃ©s Streamlit modernes.</p>
<ul>
<li>ğŸŸ¡ <strong>DÃ©ployer <code>@ui_fragment</code></strong> sur les 33 modules manquants (tabs interactifs)</li>
<li>ğŸŸ¡ <strong><code>@auto_refresh</code></strong> sur dashboard mÃ©triques, timeline, status system</li>
<li>ğŸŸ¡ <strong>Migrer <code>Modale</code></strong> â†’ <code>@st.dialog</code></li>
<li>ğŸŸ¡ <strong><code>st.write_stream()</code></strong> pour toutes les rÃ©ponses IA (suggestions, planning, analyses)</li>
<li>ğŸŸ¢ <strong>Adopter Specification pattern</strong> pour filtres dynamiques inventaire/recettes</li>
<li>ğŸŸ¢ <strong>Chat IA contextuel</strong> dans cuisine (recettes) et famille (Jules)</li>
</ul>
</div>

<div class="timeline-item phase5">
<h4><span class="tag tag-info">Phase 5</span> Infrastructure avancÃ©e â€” Semaines 13-18</h4>
<p>Valoriser ou dÃ©prÃ©cier l'infrastructure non cÃ¢blÃ©e.</p>
<ul>
<li>ğŸŸ¡ <strong>DÃ©cider middleware pipeline</strong> : piloter sur 1 service (recettes) ou deprecater (517 LOC)</li>
<li>ğŸŸ¡ <strong>DÃ©cider ReactiveServiceMixin</strong> : adopter pour invalidation cache ou deprecater (272 LOC)</li>
<li>ğŸŸ¡ <strong>PWA offline</strong> : Service Worker fonctionnel pour recettes/courses/planning</li>
<li>ğŸŸ¢ <strong>Visual regression tests</strong> : Ã©crire les tests pour SnapshotTester</li>
<li>ğŸŸ¢ <strong>Dark mode toggle</strong> actif dans parametres/affichage</li>
<li>ğŸŸ¢ <strong>Storybook vivant</strong> : live previews dans design_system.py</li>
</ul>
</div>

<div class="timeline-item phase6">
<h4><span class="tag tag-low">Phase 6</span> Production hardening â€” Semaines 19-24</h4>
<p>SÃ©curiser et fiabiliser pour un usage production full.</p>
<ul>
<li>ğŸŸ¢ <strong>Sanitize API errors</strong> : messages gÃ©nÃ©riques en prod, <code>str(e)</code> en log-only</li>
<li>ğŸŸ¢ <strong>ComplÃ©ter ETag middleware</strong> ou le supprimer</li>
<li>ğŸŸ¢ <strong>OpenAPI security scheme</strong> : Swagger Authorize button</li>
<li>ğŸŸ¢ <strong>AccessibilitÃ©</strong> : ARIA labels sur HTML custom, skip-link fonctionnel</li>
<li>ğŸŸ¢ <strong>Tests</strong> : couverture 80%+ sur core/ et services/</li>
<li>ğŸŸ¢ <strong>Jeux CRUD</strong> : migrer paris/loto vers <code>BaseService[T]</code></li>
<li>ğŸŸ¢ <strong>Audit sÃ©curitÃ©</strong> : scan dÃ©pendances, headers CSP, rate limiting Redis vÃ©rifiÃ©</li>
</ul>
</div>

</div>

<h3>RÃ©capitulatif par phase</h3>
<table>
<tr><th>Phase</th><th>Focus</th><th>DurÃ©e</th><th>Items</th><th>Impact estimÃ©</th></tr>
<tr>
<td><span class="tag tag-fixed">1 âœ…</span></td>
<td>Corrections critiques</td><td>Done</td><td>6</td>
<td>Cache fonctionne, bugs corrigÃ©s, code propre</td>
</tr>
<tr>
<td><span class="tag tag-critical">2</span></td>
<td>Bugs rÃ©siduels & finitions</td><td>2 sem.</td><td>7</td>
<td>Event bus actif, error_boundary universel, bugs API fixÃ©s</td>
</tr>
<tr>
<td><span class="tag tag-high">3</span></td>
<td>Design System tokens</td><td>4 sem.</td><td>6</td>
<td><strong>Dark mode activÃ©</strong>, tokens unifiÃ©s, accessibilitÃ© vÃ©rifiÃ©e</td>
</tr>
<tr>
<td><span class="tag tag-medium">4</span></td>
<td>Innovations Streamlit</td><td>6 sem.</td><td>6</td>
<td>Fragments, streaming natif, dialogs, chat IA contextuel</td>
</tr>
<tr>
<td><span class="tag tag-info">5</span></td>
<td>Infrastructure avancÃ©e</td><td>6 sem.</td><td>6</td>
<td>PWA offline, visual testing, Storybook, dead code rÃ©solu</td>
</tr>
<tr>
<td><span class="tag tag-low">6</span></td>
<td>Production hardening</td><td>6 sem.</td><td>7</td>
<td>SÃ©curitÃ© renforcÃ©e, tests 80%+, accessibilitÃ© complÃ¨te</td>
</tr>
</table>
</section>

<!-- ==================== FOOTER ==================== -->
<hr>
<p style="text-align:center;color:var(--text-muted);font-size:.85rem;padding:2rem 0;">
  Rapport d'audit v2 gÃ©nÃ©rÃ© le 23 fÃ©vrier 2026 &bull; Assistant Matanne &bull; 570 fichiers analysÃ©s, 94 104 lignes de code<br>
  <em>Score global : <strong>8.3/10</strong> (v1: 7.9) â€” projet remarquablement mature avec progression significative sur l'adoption des concepts.
  <br>Axes prioritaires restants : tokens sÃ©mantiques UI, bus d'Ã©vÃ©nements, innovations Streamlit modernes.</em>
</p>

</div><!-- end main -->

<script>
document.addEventListener('DOMContentLoaded', () => {
  const sections = document.querySelectorAll('section[id], div[id]');
  const navLinks = document.querySelectorAll('.sidebar nav a[href^="#"]');
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        navLinks.forEach(l => l.style.background = '');
        const active = document.querySelector(`.sidebar nav a[href="#${entry.target.id}"]`);
        if (active) active.style.background = 'rgba(59,130,246,.15)';
      }
    });
  }, { rootMargin: '-20% 0px -70% 0px' });
  sections.forEach(s => observer.observe(s));
});
</script>
</body>
</html>
