<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audit Complet v4.1 â€” Assistant Matanne</title>
<style>
/* ===== RESET & BASE ===== */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #ffffff; --bg-alt: #f8f9fa; --bg-card: #ffffff; --bg-sidebar: #1e293b;
  --text: #1e293b; --text-muted: #64748b; --text-sidebar: #e2e8f0;
  --border: #e2e8f0; --accent: #3b82f6; --accent-light: #eff6ff;
  --green: #10b981; --green-bg: #ecfdf5; --yellow: #f59e0b; --yellow-bg: #fffbeb;
  --red: #ef4444; --red-bg: #fef2f2; --orange: #f97316; --orange-bg: #fff7ed;
  --purple: #8b5cf6; --purple-bg: #f5f3ff; --cyan: #06b6d4;
  --shadow: 0 1px 3px rgba(0,0,0,.1); --shadow-lg: 0 4px 15px rgba(0,0,0,.1);
  --radius: 8px; --radius-lg: 12px;
  --font: 'Segoe UI', system-ui, -apple-system, sans-serif;
  --mono: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;
  --sidebar-w: 280px;
}
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0f172a; --bg-alt: #1e293b; --bg-card: #1e293b; --bg-sidebar: #0f172a;
    --text: #e2e8f0; --text-muted: #94a3b8; --border: #334155;
    --accent-light: #1e3a5f; --green-bg: #064e3b; --yellow-bg: #78350f;
    --red-bg: #7f1d1d; --orange-bg: #7c2d12; --purple-bg: #4c1d95;
    --shadow: 0 1px 3px rgba(0,0,0,.3); --shadow-lg: 0 4px 15px rgba(0,0,0,.3);
  }
}
html { scroll-behavior: smooth; font-size: 15px; }
body { font-family: var(--font); color: var(--text); background: var(--bg); line-height: 1.6; }
a { color: var(--accent); text-decoration: none; }
a:hover { text-decoration: underline; }
code { font-family: var(--mono); font-size: .86em; background: var(--bg-alt); padding: 2px 6px; border-radius: 4px; }
pre { background: var(--bg-alt); padding: 16px; border-radius: var(--radius); overflow-x: auto; font-size: .83rem; border: 1px solid var(--border); }
pre code { background: none; padding: 0; }
h1,h2,h3,h4 { font-weight: 700; line-height: 1.3; }
hr { border: none; border-top: 1px solid var(--border); margin: 2rem 0; }

/* ===== SIDEBAR ===== */
.sidebar { position: fixed; top: 0; left: 0; width: var(--sidebar-w); height: 100vh;
  background: var(--bg-sidebar); color: var(--text-sidebar); overflow-y: auto; z-index: 100; padding: 1.5rem 0;
  border-right: 1px solid rgba(255,255,255,.1); }
.sidebar .logo { text-align: center; padding: 0 1.2rem .8rem; border-bottom: 1px solid rgba(255,255,255,.1); margin-bottom: 1rem; }
.sidebar .logo span { font-size: 1.3rem; font-weight: 800; color: var(--accent); }
.sidebar .logo small { display: block; color: var(--text-muted); font-size: .72rem; margin-top: 2px; }
.sidebar nav a { display: flex; align-items: center; padding: .35rem 1.2rem; color: var(--text-sidebar);
  font-size: .78rem; transition: all .15s; gap: .5rem; border-left: 3px solid transparent; }
.sidebar nav a:hover { background: rgba(255,255,255,.08); text-decoration: none; border-left-color: var(--accent); }
.sidebar nav a.st { font-weight: 700; font-size: .72rem; color: var(--text-muted); text-transform: uppercase;
  letter-spacing: .06em; padding-top: .7rem; cursor: default; }
.sidebar nav a.st:hover { background: none; border-left-color: transparent; }
.sidebar nav a .nb { margin-left: auto; font-size: .68rem; padding: 1px 7px; border-radius: 10px; font-weight: 600; }

/* ===== MAIN CONTENT ===== */
.main { margin-left: var(--sidebar-w); padding: 2rem 3rem 4rem; max-width: 1100px; }
.main > section { margin-bottom: 3rem; }
.main h1 { font-size: 1.9rem; margin-bottom: .3rem; }
.main h2 { font-size: 1.4rem; margin: 2.5rem 0 1rem; padding-bottom: .4rem; border-bottom: 2px solid var(--accent); }
.main h3 { font-size: 1.1rem; margin: 1.5rem 0 .6rem; }
.main h4 { font-size: .95rem; margin: 1rem 0 .4rem; color: var(--text-muted); }
p, li { margin-bottom: .4rem; }
ul, ol { padding-left: 1.5rem; }
table { width: 100%; border-collapse: collapse; margin: .8rem 0; font-size: .82rem; }
th, td { text-align: left; padding: .5rem .7rem; border-bottom: 1px solid var(--border); }
th { font-weight: 700; background: var(--bg-alt); position: sticky; top: 0; white-space: nowrap; }
tr:hover { background: var(--accent-light); }
.ac { text-align: center; }
.ar { text-align: right; }

/* ===== CARDS ===== */
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius-lg);
  padding: 1.1rem 1.4rem; margin: 1rem 0; box-shadow: var(--shadow); }

/* ===== BADGES ===== */
.b { display: inline-block; padding: 2px 9px; border-radius: 12px; font-size: .76rem; font-weight: 600; }
.bg { background: var(--green-bg); color: var(--green); }
.by { background: var(--yellow-bg); color: var(--yellow); }
.br { background: var(--red-bg); color: var(--red); }
.ba { background: var(--accent-light); color: var(--accent); }
.bp { background: var(--purple-bg); color: var(--purple); }
.bo { background: var(--orange-bg); color: var(--orange); }
.sc { font-size: 1.2rem; font-weight: 800; }
.sg { color: var(--green); }
.sy { color: var(--yellow); }
.sr { color: var(--red); }

/* ===== PROGRESS BARS ===== */
.pb { background: var(--bg-alt); border-radius: 10px; height: 10px; overflow: hidden; margin: 4px 0; }
.pf { height: 100%; border-radius: 10px; transition: width .4s; }
.pfg { background: var(--green); }
.pfy { background: var(--yellow); }
.pfr { background: var(--red); }
.pfa { background: var(--accent); }

/* ===== STATS GRID ===== */
.sg2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1rem 0; }
.sc2 { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius);
  padding: .9rem 1rem; text-align: center; box-shadow: var(--shadow); }
.sc2 .sv { font-size: 1.8rem; font-weight: 800; line-height: 1.2; }
.sc2 .sl { font-size: .75rem; color: var(--text-muted); margin-top: .2rem; }

/* ===== RADAR ===== */
.rc { display: flex; flex-wrap: wrap; gap: 1.2rem; margin: 1rem 0; }
.ri { flex: 1; min-width: 200px; }
.ri .rl { display: flex; justify-content: space-between; font-size: .84rem; margin-bottom: 3px; }

/* ===== COLLAPSIBLE ===== */
details { border: 1px solid var(--border); border-radius: var(--radius); margin: .7rem 0; overflow: hidden; }
details[open] { box-shadow: var(--shadow); }
summary { padding: .65rem 1rem; cursor: pointer; font-weight: 600; font-size: .92rem;
  background: var(--bg-alt); display: flex; align-items: center; gap: .5rem; list-style: none; }
summary::-webkit-details-marker { display: none; }
summary::before { content: 'â–¶'; font-size: .65rem; transition: transform .2s; display: inline-block; width: .9rem; }
details[open] summary::before { transform: rotate(90deg); }
details > :not(summary) { padding: .7rem 1rem; }

/* ===== SEVERITY TAGS ===== */
.tag { display: inline-block; padding: 1px 7px; border-radius: 4px; font-size: .73rem; font-weight: 600; margin-right: 3px; vertical-align: middle; }
.tc { background: var(--red-bg); color: var(--red); }
.th { background: var(--orange-bg); color: var(--orange); }
.tm { background: var(--yellow-bg); color: var(--yellow); }
.tl { background: var(--green-bg); color: var(--green); }
.ti { background: var(--accent-light); color: var(--accent); }
.tf { background: #d1fae5; color: #047857; }

/* ===== DELTA ===== */
.d { font-size: .73rem; font-weight: 700; margin-left: 5px; }
.du { color: var(--green); }
.dd { color: var(--red); }
.ds { color: var(--text-muted); }

/* ===== TIMELINE ===== */
.tl2 { position: relative; padding-left: 2rem; margin: 1.5rem 0; }
.tl2::before { content: ''; position: absolute; left: 8px; top: 0; bottom: 0; width: 3px; background: var(--border); border-radius: 3px; }
.ti2 { position: relative; margin-bottom: 1.3rem; }
.ti2::before { content: ''; position: absolute; left: -2rem; top: 6px; width: 14px; height: 14px;
  border-radius: 50%; border: 3px solid var(--accent); background: var(--bg); }
.ti2.done::before { border-color: var(--green); background: var(--green); }
.ti2.p1::before { border-color: var(--red); }
.ti2.p2::before { border-color: var(--orange); }
.ti2.p3::before { border-color: var(--yellow); }
.ti2.p4::before { border-color: var(--accent); }
.ti2 h4 { margin: 0 0 .3rem; }
.ti2 p { margin: 0; font-size: .88rem; color: var(--text-muted); }

/* ===== INNOVATION GRID ===== */
.ig { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; margin: 1rem 0; }
.ic { border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 1.1rem;
  background: var(--bg-card); border-left: 4px solid var(--accent); box-shadow: var(--shadow); }
.ic h4 { margin: 0 0 .4rem; font-size: .95rem; }
.ic .im { font-size: .76rem; margin-top: .4rem; }
.ic .im span { font-weight: 700; }

/* ===== ADOPTION ROW ===== */
.ar2 { display: flex; align-items: center; gap: .8rem; padding: .4rem 0; border-bottom: 1px solid var(--border); }
.ar2 .cn { flex: 0 0 200px; font-weight: 600; font-size: .84rem; }
.ar2 .ra { flex: 0 0 110px; text-align: right; font-size: .84rem; }

/* ===== COMPLETENESS TABLE ===== */
.ct td:nth-child(3) { text-align: center; font-weight: 700; }

/* ===== PRINT ===== */
@media print {
  .sidebar { display: none; }
  .main { margin-left: 0; padding: 1rem; max-width: 100%; }
  details { break-inside: avoid; }
  .card, details { box-shadow: none; border: 1px solid #ccc; }
  table { font-size: .78rem; }
}
@media (max-width: 900px) {
  .sidebar { display: none; }
  .main { margin-left: 0; padding: 1.5rem; }
  .sg2 { grid-template-columns: repeat(2, 1fr); }
}
</style>
</head>
<body>

<!-- ==================== SIDEBAR ==================== -->
<aside class="sidebar">
  <div class="logo">
    <span>ğŸ  Assistant Matanne</span>
    <small>Audit complet v4.1 â€” 24 fÃ©v. 2026</small>
  </div>
  <nav>
    <a href="#exec" style="font-weight:700;color:#fff;">ğŸ“Š Tableau de bord</a>
    <a href="#completeness">âœ… ComplÃ©tude projet</a>
    <a href="#changelog">ğŸ”„ Changelog v3â†’v4</a>
    <a class="st">ANALYSE DÃ‰TAILLÃ‰E</a>
    <a href="#core">ğŸ§± src/core/<span class="nb" style="background:#10b981;color:#fff;">9.0</span></a>
    <a href="#core-ai">&nbsp;â†³ ai/</a>
    <a href="#core-caching">&nbsp;â†³ caching/</a>
    <a href="#core-config">&nbsp;â†³ config/</a>
    <a href="#core-db">&nbsp;â†³ db/</a>
    <a href="#core-decorators">&nbsp;â†³ decorators/</a>
    <a href="#core-models">&nbsp;â†³ models/</a>
    <a href="#core-state">&nbsp;â†³ state/</a>
    <a href="#core-validation">&nbsp;â†³ validation/</a>
    <a href="#core-monitoring">&nbsp;â†³ monitoring/</a>
    <a href="#core-resilience">&nbsp;â†³ resilience/</a>
    <a href="#core-observability">&nbsp;â†³ observability/</a>
    <a href="#core-dateutils">&nbsp;â†³ date_utils/</a>
    <a href="#core-root">&nbsp;â†³ fichiers racine</a>
    <a href="#services">âš™ï¸ src/services/<span class="nb" style="background:#10b981;color:#fff;">8.5</span></a>
    <a href="#svc-core">&nbsp;â†³ core/ (infrastructure)</a>
    <a href="#svc-cuisine">&nbsp;â†³ cuisine/</a>
    <a href="#svc-famille">&nbsp;â†³ famille/</a>
    <a href="#svc-integrations">&nbsp;â†³ integrations/</a>
    <a href="#svc-inventaire">&nbsp;â†³ inventaire/</a>
    <a href="#svc-jeux">&nbsp;â†³ jeux/</a>
    <a href="#svc-maison">&nbsp;â†³ maison/</a>
    <a href="#svc-rapports">&nbsp;â†³ rapports/</a>
    <a href="#modules">ğŸ“¦ src/modules/<span class="nb" style="background:#10b981;color:#fff;">8.8</span></a>
    <a href="#mod-cuisine">&nbsp;â†³ cuisine/</a>
    <a href="#mod-famille">&nbsp;â†³ famille/</a>
    <a href="#mod-maison">&nbsp;â†³ maison/</a>
    <a href="#mod-jeux">&nbsp;â†³ jeux/</a>
    <a href="#mod-planning">&nbsp;â†³ planning/</a>
    <a href="#mod-parametres">&nbsp;â†³ parametres/</a>
    <a href="#mod-utilitaires">&nbsp;â†³ utilitaires/</a>
    <a href="#mod-framework">&nbsp;â†³ _framework/</a>
    <a href="#ui">ğŸ¨ src/ui/<span class="nb" style="background:#10b981;color:#fff;">8.0</span></a>
    <a href="#api">ğŸŒ src/api/<span class="nb" style="background:#10b981;color:#fff;">8.8</span></a>
    <a href="#app">ğŸš€ app.py<span class="nb" style="background:#10b981;color:#fff;">9.2</span></a>
    <a class="st">SYNTHÃˆSE</a>
    <a href="#adoption">ğŸ” Adoption concepts</a>
    <a href="#events">ğŸ“¡ Bus d'Ã©vÃ©nements</a>
    <a href="#issues">ğŸ› ProblÃ¨mes rÃ©siduels</a>
    <a href="#innovations">ğŸ’¡ Innovations Streamlit</a>
    <a href="#roadmap">ğŸ—ºï¸ Roadmap v4</a>
  </nav>
</aside>

<!-- ==================== MAIN ==================== -->
<div class="main">

<!-- ========== EXECUTIVE ========== -->
<section id="exec">
<h1>ğŸ  Rapport d'audit complet â€” v4</h1>
<p style="color:var(--text-muted);margin-bottom:1.5rem;">Assistant Matanne &bull; AnalysÃ© le 24 fÃ©vrier 2026 &bull; Comparaison v4â†’v4.1 (Phase 8)<br><em>~560 fichiers Python &bull; ~97 000 lignes de code &bull; 8 150 tests collectÃ©s</em></p>

<div class="sg2">
  <div class="sc2"><div class="sv" style="color:var(--accent);">560+</div><div class="sl">Fichiers Python</div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">97K</div><div class="sl">Lignes de code</div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">56</div><div class="sl">@service_factory<span class="d du">+1</span></div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">115</div><div class="sl">error_boundary blocs<span class="d du">+4</span></div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">35</div><div class="sl">Endpoints API</div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">8 150</div><div class="sl">Tests collectÃ©s<span class="d du">+78</span></div></div>
</div>

<h3>Scores de maturitÃ© â€” v1 â†’ v2 â†’ v3 â†’ v4</h3>
<div class="rc">
  <div class="ri"><div class="rl"><strong>ğŸ§± core/</strong> <span class="sc sg">9.0<span class="d du">+0.5</span></span></div><div class="pb"><div class="pf pfg" style="width:90%"></div></div></div>
  <div class="ri"><div class="rl"><strong>âš™ï¸ services/</strong> <span class="sc sg">8.5<span class="d du">+0.3</span></span></div><div class="pb"><div class="pf pfg" style="width:85%"></div></div></div>
  <div class="ri"><div class="rl"><strong>ğŸ“¦ modules/</strong> <span class="sc sg">8.8<span class="d du">+0.3</span></span></div><div class="pb"><div class="pf pfg" style="width:88%"></div></div></div>
  <div class="ri"><div class="rl"><strong>ğŸ¨ ui/</strong> <span class="sc sg">8.0<span class="d du">+0.2</span></span></div><div class="pb"><div class="pf pfg" style="width:80%"></div></div></div>
  <div class="ri"><div class="rl"><strong>ğŸŒ api/</strong> <span class="sc sg">8.8<span class="d du">+0.4</span></span></div><div class="pb"><div class="pf pfg" style="width:88%"></div></div></div>
  <div class="ri"><div class="rl"><strong>ğŸš€ app.py</strong> <span class="sc sg">9.2<span class="d du">+0.2</span></span></div><div class="pb"><div class="pf pfg" style="width:92%"></div></div></div>
</div>

<div class="card" style="border-left:4px solid var(--green);">
  <h3>Verdict v4.1 (Phase 8 complÃ©tÃ©e)</h3>
  <p>La roadmap v3 et <strong>Phase 8</strong> sont <strong>intÃ©gralement complÃ©tÃ©es</strong> : dead code Ã©liminÃ© (~6 000+ LOC), <strong>Sentry</strong>, <strong>structured logging</strong> et <strong>CI/CD</strong> en production, <strong>PWA Service Worker</strong> complet, <strong>@profiler_rerun 32/32</strong> (100%), <strong>@cached_fragment</strong> et <strong>@lazy</strong> adoptÃ©s, <strong>11 subscribers cache actifs</strong>. Phase 8 : @avec_cache dÃ©jÃ  en place dans maison/ et rapports/, @cached_fragment Ã©tendu aux graphiques Plotly planning. Score global : <strong>v4 8.7 â†’ v4.1 8.8/10</strong>. Axes restants : adoption <code>Sem</code> tokens (8.1%), @avec_resilience sur HTTP externes.</p>
</div>
</section>

<!-- ========== COMPLETENESS ========== -->
<section id="completeness">
<h2>âœ… ComplÃ©tude du projet â€” Analyse multi-dimensions</h2>

<table>
<tr><th>Dimension</th><th>Score</th><th>v3</th><th>DÃ©tail v4</th></tr>
<tr><td>ğŸ—ï¸ Architecture</td><td class="ac"><span class="sc sg">9.5/10</span></td><td class="ac">9.5</td><td>Layered (coreâ†’servicesâ†’modulesâ†’UI), DI via @service_factory (56), event bus (27 Ã©vÃ©nements), cache multi-niveaux, resilience composable, st.navigation() natif. Dead code Ã©liminÃ©. Exemplaire.</td></tr>
<tr><td>ğŸ“ QualitÃ© du code</td><td class="ac"><span class="sc sg">9.0/10</span></td><td class="ac">8.5</td><td>PEP 562, 100% SA 2.0 Mapped[], 0 legacy Column(), 14/14 __all__, StrEnum, Pydantic v2. Ruff 0 issues. 0 import *, 0 bare except. 794 docstrings FR.</td></tr>
<tr><td>ğŸ§ª Tests</td><td class="ac"><span class="sc sy">7.5/10</span></td><td class="ac">7.0</td><td>8 150 tests, 7 814 passÃ©s, 13 Ã©checs pre-existing, 322 skipped. 27 tests visuels snapshot. 78 nouveaux tests (resilience 0â†’95%, observability 0â†’98%). Coverage core/ ~75%.</td></tr>
<tr><td>ğŸ”’ SÃ©curitÃ©</td><td class="ac"><span class="sc sg">9.0/10</span></td><td class="ac">8.5</td><td>JWT dual-mode, rate limiting multi-fenÃªtre + Redis, security headers OWASP complets, HSTS en prod, CSP strict. 0 fuite str(e). CI: bandit + pip-audit. Sentry PII filtering.</td></tr>
<tr><td>âš¡ Performance</td><td class="ac"><span class="sc sg">8.5/10</span></td><td class="ac">8.5</td><td>Cache L1/L2/L3 (65 @avec_cache), QueuePool, lazy loading, CSS single-injection MD5, 18 N+1 corrigÃ©s, @cached_fragment (6 usages), @auto_refresh (7 usages).</td></tr>
<tr><td>ğŸ“¡ ObservabilitÃ©</td><td class="ac"><span class="sc sg">9.0/10</span></td><td class="ac">8.0</td><td>Sentry (351 LOC, PII filtering, correlation ID), RerunProfiler 32/32 (100%), Health probes K8s, FormatteurStructure JSON, correlation IDs contextvars. 98% coverage observability.</td></tr>
<tr><td>ğŸ¨ UX / Design System</td><td class="ac"><span class="sc sy">7.5/10</span></td><td class="ac">7.5</td><td>79 composants (34 @composant_ui), CSS engine MD5, dark mode toggle. Sem adoptÃ© Ã  8.1% (5/62 fichiers). @cached_fragment + @lazy nouveaux. Tablet mode fonctionnel.</td></tr>
<tr><td>ğŸ“– Documentation</td><td class="ac"><span class="sc sg">8.0/10</span></td><td class="ac">7.0</td><td>docs/ 14+ fichiers MD, copilot-instructions alignÃ©, ROADMAP Ã  jour, PATTERNS.md rÃ©Ã©crit (871â†’320L). CI/CD docs intÃ©grÃ©s. MIGRATION_CORE_PACKAGES.md complet.</td></tr>
<tr><td>â™¿ AccessibilitÃ©</td><td class="ac"><span class="sc sy">7.5/10</span></td><td class="ac">6.0</td><td>a11y.py 9/10: WCAG contrast, ARIA attrs sur tous les atoms, skip-link CSS, reduced-motion. Pydantic a11y attrs sur composants. <span class="tm tag">Skip-link non rendu en DOM</span>.</td></tr>
<tr><td>ğŸ”„ Adoption patterns</td><td class="ac"><span class="sc sg">9.0/10</span></td><td class="ac">8.5</td><td>@service_factory 56, obtenir_client_ia() 17/17, error_boundary 115 blocs (100% modules), profiler_rerun 32/32 (100%), @cached_fragment 6, @lazy 3, deep linking 10 modules.</td></tr>
<tr><td>ğŸ­ Production-readiness</td><td class="ac"><span class="sc sg">8.5/10</span></td><td class="ac">7.5</td><td>Sentry âœ…, structured logging âœ…, CI/CD (5+3 jobs) âœ…, PWA Service Worker (push, sync, IndexedDB) âœ…, security headers âœ…. Manque : Redis activÃ©, tests coverage 80%.</td></tr>
<tr><td>ğŸ“± Mobile / PWA</td><td class="ac"><span class="sc sg">8.5/10</span></td><td class="ac">6.5</td><td>PWA manifest, 8 icons (72â†’512px), SW.js 210 LOC : Network First, push notifications, IndexedDB shopping list, background sync, periodic recipe cache (24h), offline page.</td></tr>
</table>

<div class="card" style="border-left:4px solid var(--accent);">
  <h4>Score de complÃ©tude global : <span class="sc sg">8.5/10</span><span class="d du"> +0.6</span></h4>
  <p>Progression majeure v3â†’v4 grÃ¢ce Ã  la complÃ©tion des phases production hardening et innovations Streamlit. Le projet est dÃ©sormais <strong>production-ready</strong> avec Sentry, CI/CD et PWA offline. Axes restants : couverture de tests (+322 skipped), Sem tokens (8.1%), cache dans maison/ et rapports/.</p>
</div>
</section>

<!-- ========== CHANGELOG v3â†’v4 ========== -->
<section id="changelog">
<h2>ğŸ”„ Changelog v3 â†’ v4 â€” AmÃ©liorations dÃ©taillÃ©es</h2>

<h3>Phase 4 â€” Rationalisation patterns (~6 000+ LOC dead code supprimÃ©)</h3>
<table>
<tr><th>Action</th><th>Impact</th><th>DÃ©tail</th></tr>
<tr><td><span class="tf tag">8 patterns dead code supprimÃ©s</span></td><td>-6 000+ LOC</td><td>Result Monad, Repository, Specification, Unit of Work, IoC Container, CQRS, ReactiveServiceMixin, UI v2.0 legacy</td></tr>
<tr><td><span class="tf tag">18 N+1 queries corrigÃ©s</span></td><td>~50 joinedload</td><td>1 CRITIQUE (triple N+1 dans analyser_profil_culinaire), 6 HIGH (paris Matchâ†’Equipe), 6 MEDIUM, 5 LOW</td></tr>
<tr><td><span class="tf tag">@service_factory renforcÃ©</span></td><td>+19 services</td><td>Adoption quasi-universelle (56/~57 services)</td></tr>
<tr><td><span class="tf tag">@avec_cache Ã©tendu</span></td><td>+10 dÃ©corateurs</td><td>7 @st.cache_data migrÃ©s vers @avec_cache + 3 nouveaux</td></tr>
<tr><td><span class="tf tag">docs/PATTERNS.md rÃ©Ã©crit</span></td><td>871â†’320 LOC</td><td>FocalisÃ© sur les 6 patterns rÃ©ellement adoptÃ©s</td></tr>
</table>

<h3>Phase 5 â€” Design System & Dark Mode</h3>
<table>
<tr><th>Action</th><th>Statut</th></tr>
<tr><td>Sem tokens migrÃ©s (synchronisation.py, pwa.py, test_ui_snapshots.py)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>@cached_fragment adoptÃ©s (6 usages : about, stats, lotoÃ—2, entretien, jardin)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>@lazy adoptÃ©s (3 usages : ia dÃ©tails, ntfy aide, jardin export CSV)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Dark Mode toggle fonctionnel dans parametres/affichage</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Design System module enregistrÃ© dans navigation + router</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>27 tests visuels snapshot (7 badges + 4 boÃ®tes info + 6 boules loto + 10 thÃ¨me)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
</table>

<h3>Phase 6 â€” Innovations Streamlit</h3>
<table>
<tr><th>Action</th><th>Statut</th></tr>
<tr><td>st.write_stream() â€” jules_ai.py, weekend_ai.py, chat_contextuel.py</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>@st.dialog migration â€” Modale deprecated, confirm_dialog() alternative</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>@auto_refresh dashboards â€” 4 modules (alertes 30s, stats 60s, hub 60s, stats_mois 120s) + 3 additionnels</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Deep linking URL â€” tabs_with_url() dans 10 modules (inventaire, planificateur, paris, jules, recettes, courses, weekend, calendrierâ€¦)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Chat IA contextuel â€” 3 prompts (famille, planning, weekend) + 6 intÃ©grations</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
</table>

<h3>Phase 7 â€” Production Hardening</h3>
<table>
<tr><th>Action</th><th>Statut</th></tr>
<tr><td>Sentry intÃ©gration (351 LOC, PII filtering, correlation ID, before_send hooks)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Service Worker PWA (210 LOC: push, IndexedDB, background sync, periodic sync 24h, offline page)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>JSON structured logging (FormatteurStructure + LOG_FORMAT=json + correlation_id)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>CI/CD pipeline (tests.yml: 5 jobs matrix + deploy.yml: 3 jobs + dependabot)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Security headers OWASP (CSP contextuel, HSTS prod, X-Frame DENY, Permissions-Policy)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Error sanitization API (0 str(e) leak, messages gÃ©nÃ©riques, exc_info=True logging)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>OpenAPI securitySchemes (Swagger Authorize fonctionnel)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>78 nouveaux tests (resilience 0â†’95%, observability 0â†’98%)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
<tr><td>Jeux migration CRUD â†’ BaseService[T] (ParisCrudService, LotoCrudService)</td><td><span class="tf tag">âœ… FAIT</span></td></tr>
</table>

<h3>Comparaison v3 â†’ v4</h3>
<table>
<tr><th>MÃ©trique</th><th>v3</th><th>v4</th><th>Delta</th></tr>
<tr><td>@service_factory</td><td>55</td><td><strong>56</strong></td><td><span class="d du">+1</span></td></tr>
<tr><td>@avec_cache</td><td>65</td><td><strong>65</strong></td><td><span class="d ds">â†’</span></td></tr>
<tr><td>error_boundary (blocs <code>with</code>)</td><td>111</td><td><strong>115</strong></td><td><span class="d du">+4</span></td></tr>
<tr><td>@profiler_rerun</td><td>28/32</td><td><strong>32/32</strong></td><td><span class="d du">+4 (100%)</span></td></tr>
<tr><td>@cached_fragment</td><td>0</td><td><strong>6</strong></td><td><span class="d du">+6</span></td></tr>
<tr><td>@lazy</td><td>0</td><td><strong>3</strong></td><td><span class="d du">+3</span></td></tr>
<tr><td>@auto_refresh</td><td>3</td><td><strong>7</strong></td><td><span class="d du">+4</span></td></tr>
<tr><td>tabs_with_url() deep linking</td><td>3</td><td><strong>10</strong></td><td><span class="d du">+7</span></td></tr>
<tr><td>Chat IA contextuel</td><td>1 (chat_ia.py)</td><td><strong>6 intÃ©grations</strong></td><td><span class="d du">+5</span></td></tr>
<tr><td>KeyNamespace</td><td>15 fichiers</td><td><strong>18 fichiers</strong></td><td><span class="d du">+3</span></td></tr>
<tr><td>Sem tokens (fichiers adoptant)</td><td>3/61</td><td><strong>5/62</strong></td><td><span class="d du">+2</span></td></tr>
<tr><td>Sentry</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… 351 LOC</span></td><td>Nouveau</td></tr>
<tr><td>Structured Logging</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… FormatteurStructure</span></td><td>Nouveau</td></tr>
<tr><td>CI/CD pipeline</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… 8 jobs</span></td><td>Nouveau</td></tr>
<tr><td>PWA Service Worker</td><td>Shell partiel</td><td><span class="tf tag">âœ… 210 LOC complet</span></td><td>Complet</td></tr>
<tr><td>Tests collectÃ©s</td><td>8 072</td><td><strong>8 150</strong></td><td><span class="d du">+78</span></td></tr>
<tr><td>Dead code rÃ©siduel (specs, middleware)</td><td>1 379 LOC</td><td><strong>0 LOC</strong></td><td><span class="d du">-1 379 LOC</span></td></tr>
<tr><td>Cache subscribers</td><td>4</td><td><strong>11</strong></td><td><span class="d du">+7</span></td></tr>
<tr><td>@cached_fragment graphiques</td><td>4</td><td><strong>8</strong></td><td><span class="d du">+4</span></td></tr>
<tr><td>Score global</td><td>8.5</td><td><strong>8.8</strong></td><td><span class="d du">+0.3</span></td></tr>
</table>
</section>

<!-- ========== src/core/ ========== -->
<section id="core">
<h2>ğŸ§± src/core/ â€” Noyau applicatif</h2>
<div class="sg2">
  <div class="sc2"><div class="sv" style="color:var(--green);">77</div><div class="sl">Fichiers<span class="d dd">-9</span></div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">13 818</div><div class="sl">Lignes<span class="d du">+530</span></div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">12</div><div class="sl">Sous-packages</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">9.0</div><div class="sl">Score<span class="d du">+0.5</span></div></div>
</div>

<div class="card" style="border-left:4px solid var(--green);">
<p><span class="tf tag">v4</span> <strong>Nettoyage complet :</strong> Tous les dead code patterns supprimÃ©s â€” result/, repository.py, specifications.py, unit_of_work.py, container.py, middleware/. Ajouts : Sentry (351 LOC), FormatteurStructure JSON logging. 0 legacy Column(), 100% Mapped[], 14/14 __all__, 0 import *, 0 bare except, 794 docstrings.</p>
</div>

<div id="core-ai">
<details open>
<summary>ğŸ¤– ai/ â€” Client IA, Parser, Cache, Rate Limiting, Circuit Breaker <span class="b bg">9/10</span></summary>
<div>
<p><strong>1 291 LOC, 6 fichiers.</strong> <code>ClientIA</code> singleton via <code>obtenir_client_ia()</code>, <code>AnalyseurIA</code> avec 5 stratÃ©gies cascading JSON, <code>CacheIA</code> sÃ©mantique SHA-256, <code>RateLimitIA</code> quotas journalier/horaire, <code>CircuitBreaker</code> 3 Ã©tats (FERME/OUVERT/SEMI_OUVERT).</p>
<p><span class="tf tag">v4</span> Stale docstring ReactiveServiceMixin supprimÃ©. 17/17 services utilisent <code>obtenir_client_ia()</code> â€” 0 instanciation directe.</p>
<p><span class="tm tag">Bug rÃ©siduel</span> <code>async_wrapper</code> dans <code>circuit_breaker.py</code> : coroutine potentiellement non awaitÃ©e dans <code>appeler()</code>. Impact faible car le code synchrone contourne.</p>
</div>
</details>
</div>

<div id="core-caching">
<details>
<summary>ğŸ’¾ caching/ â€” Cache multi-niveaux L1/L2/L3 <span class="b bg">8.5/10</span></summary>
<div>
<p><strong>752 LOC, 7 fichiers.</strong> L1 mÃ©moire (LRU dict), L2 session Streamlit, L3 fichier pickle atomique. <code>obtenir_cache()</code> singleton. <strong>65 usages @avec_cache</strong> dans les services. Cache pleinement fonctionnel en production.</p>
</div>
</details>
</div>

<div id="core-config">
<details>
<summary>âš™ï¸ config/ â€” Pydantic BaseSettings cascade <span class="b bg">8/10</span></summary>
<div><p><strong>693 LOC, 4 fichiers.</strong> Cascade st.secrets â†’ .env.local â†’ .env â†’ defaults. <code>ValidateurConfiguration</code> fluent builder. Pydantic v2 <code>BaseSettings</code> avec model_config. Stable et Ã©prouvÃ©.</p></div>
</details>
</div>

<div id="core-db">
<details>
<summary>ğŸ—„ï¸ db/ â€” Engine, Sessions, Migrations <span class="b bg">8.5/10</span></summary>
<div><p><strong>681 LOC, 5 fichiers.</strong> QueuePool avec pool_pre_ping, context manager <code>obtenir_contexte_db()</code>, migrations SQL-file SHA-256 checksum. <code>obtenir_moteur_securise()</code> pour fallback gracieux. Solide et stable.</p></div>
</details>
</div>

<div id="core-decorators">
<details>
<summary>ğŸ¯ decorators/ â€” 6 dÃ©corateurs unifiÃ©s <span class="b bg">9/10</span></summary>
<div><p><strong>463 LOC, 5 fichiers.</strong> <code>@avec_cache</code> (BLAKE2b keys, sentinel pattern), <code>@avec_session_db</code>, <code>@avec_gestion_erreurs</code>, <code>@avec_validation</code> (Pydantic v2), <code>@avec_resilience</code> (retry + timeout + circuit + fallback), <code>@cache_ui</code>. Tous avec functools.wraps. Massivement adoptÃ©s.</p></div>
</details>
</div>

<div id="core-models">
<details>
<summary>ğŸ“Š models/ â€” 83 modÃ¨les SQLAlchemy 2.0 (20 fichiers) <span class="b bg">9.5/10</span></summary>
<div>
<p><strong>4 281 LOC, 20 fichiers. 83 table models, 29 enums (38 enums totaux dans core/), 112 classes totales.</strong></p>
<p>100% SA 2.0 : <strong>1 054 <code>Mapped[]</code></strong>, <strong>1 001 <code>mapped_column()</code></strong>, <strong>0 legacy <code>Column()</code></strong>. PEP 562 lazy loading pour ~100 symboles dans <code>__init__.py</code>. 71 <code>relationship()</code>, 64 avec <code>back_populates</code> (90.1%). Convention de nommage contraintes. Module de rÃ©fÃ©rence qualitÃ© absolue.</p>
</div>
</details>
</div>

<div id="core-state">
<details>
<summary>ğŸ”€ state/ â€” Gestion d'Ã©tat <span class="b bg">8/10</span></summary>
<div><p><strong>606 LOC, 4 fichiers.</strong> State slices par domaine (EtatNavigation, EtatCuisine, EtatUI), Protocol SessionStorage (dÃ©couplage Streamlit), navigation breadcrumbs, GestionnaireEtat singleton, raccourcis naviguer()/revenir().</p></div>
</details>
</div>

<div id="core-validation">
<details>
<summary>âœ… validation/ â€” Schemas Pydantic + Sanitizer <span class="b by">7.5/10</span></summary>
<div><p><strong>943 LOC, 11 fichiers.</strong> Sous-package schemas/ (recettes, inventaire, courses, planning, famille, projets) Pydantic v2. <code>NettoyeurEntrees</code> anti-XSS/injection SQL. <code>valider_formulaire_streamlit()</code> intÃ©gration UI. Double approche dict/Pydantic encore en place sur certains endpoints API.</p></div>
</details>
</div>

<div id="core-monitoring">
<details>
<summary>ğŸ“¡ monitoring/ â€” MÃ©triques, SantÃ©, Sentry <span class="b bg">9/10</span><span class="d du"> +0.5</span></summary>
<div>
<p><strong>1 141 LOC, 6 fichiers.</strong> Health probes K8s-style (DB, cache, IA, disk), RerunProfiler spÃ©cifique Streamlit (<strong>32/32 modules â€” 100%</strong>), MetricCollector compteurs atomiques.</p>
<p><span class="tf tag">v4 NOUVEAU</span> <strong>sentry.py</strong> (274 LOC) : <code>initialiser_sentry()</code> appelÃ© dans bootstrap.py. IntÃ©grations SQLAlchemy + Logging. PII filtering automatique, before_send hooks, correlation ID injectÃ©. 10% traces + profiles.</p>
<p><span class="tf tag">v4</span> <strong>95% coverage</strong> sur resilience/policies.py, <strong>98% coverage</strong> sur observability/context.py (78 nouveaux tests).</p>
</div>
</details>
</div>

<div id="core-resilience">
<details>
<summary>ğŸ›¡ï¸ resilience/ â€” Politiques composables <span class="b bg">9/10</span></summary>
<div><p><strong>304 LOC, 2 fichiers.</strong> RetryPolicy, TimeoutPolicy, BulkheadPolicy, FallbackPolicy. Composition via <code>+</code> operator. <code>executer()</code> retourne T directement. Factories : <code>politique_ia()</code>, <code>politique_api_externe()</code>, <code>politique_base_de_donnees()</code>, <code>politique_cache()</code>. <strong>Coverage : 0% â†’ 94.67%</strong> grÃ¢ce Ã  43 nouveaux tests.</p></div>
</details>
</div>

<div id="core-observability">
<details>
<summary>ğŸ”­ observability/ â€” Contexte d'exÃ©cution <span class="b bg">9.5/10</span></summary>
<div><p><strong>226 LOC, 2 fichiers.</strong> <code>contextvars.ContextVar</code>, tracing hiÃ©rarchique parent-enfant, <code>FiltreCorrelation</code> intÃ©grÃ© au logging. Module le plus propre du projet. <strong>Coverage : 0% â†’ 97.83%</strong> grÃ¢ce Ã  35 nouveaux tests.</p></div>
</details>
</div>

<div id="core-dateutils">
<details>
<summary>ğŸ“… date_utils/ â€” Utilitaires de dates <span class="b bg">10/10</span></summary>
<div><p><strong>327 LOC, 5 fichiers.</strong> Fonctions pures (semaines, periodes, formatage, helpers), zÃ©ro import Streamlit, docstrings exemplaires. Module de rÃ©fÃ©rence qualitÃ© absolue.</p></div>
</details>
</div>

<div id="core-root">
<details>
<summary>ğŸ“ Fichiers racine (10 fichiers) <span class="b bg">9/10</span><span class="d du"> +0.5</span></summary>
<div>
<p><strong>1 944 LOC.</strong></p>
<ul>
<li><code>lazy_loader.py</code> (295 LOC) : PEP 562, RouteurOptimise, MODULE_REGISTRY (35 routes)</li>
<li><code>logging.py</code> (281 LOC) : FiltreSecrets regex masking, <span class="tf tag">v4</span> <strong>FormatteurStructure</strong> JSON (timestamp, level, correlation_id, operation). Activable via <code>LOG_FORMAT=json</code></li>
<li><code>storage.py</code> (148 LOC) : SessionStorage Protocol (dÃ©couplage Streamlit, testable)</li>
<li><code>session_keys.py</code> (172 LOC) : KeyNamespace thread-safe (~85 clÃ©s centralisÃ©es)</li>
<li><code>bootstrap.py</code> (143 LOC) : Pipeline init app (config â†’ <span class="tf tag">v4</span> Sentry â†’ event subscribers â†’ atexit)</li>
<li><code>errors.py</code> (170 LOC) + <code>errors_base.py</code> (328 LOC) : HiÃ©rarchie d'exceptions mÃ©tier (pure + UI)</li>
<li><code>constants.py</code> (186 LOC) : Limites, defaults, constantes app</li>
<li><code>navigation.py</code> (176 LOC) : <code>construire_pages()</code> via st.navigation() + st.Page() (30 pages, 8 sections)</li>
<li><code>async_utils.py</code> (45 LOC) : Helpers event loop safe (Streamlit-aware)</li>
</ul>
<p><span class="tf tag">v4</span> <strong>Tout dead code supprimÃ© :</strong> result/ (6 fichiers), repository.py, specifications.py, unit_of_work.py, container.py, middleware/ (4 fichiers). 0 rÃ©fÃ©rence dangling. ~4 000+ LOC Ã©liminÃ©s du core seul.</p>
</div>
</details>
</div>
</section>

<!-- ========== src/services/ ========== -->
<section id="services">
<h2>âš™ï¸ src/services/ â€” Couche de services</h2>
<div class="sg2">
  <div class="sc2"><div class="sv" style="color:var(--green);">196</div><div class="sl">Fichiers</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">39 700</div><div class="sl">Lignes</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">56</div><div class="sl">@service_factory<span class="d du">+1</span></div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">8.5</div><div class="sl">Score<span class="d du">+0.3</span></div></div>
</div>

<div class="card" style="border-left:4px solid var(--green);">
<p><span class="tf tag">v4</span> <strong>Dead code Ã©liminÃ© :</strong> specifications/ (4 fichiers, 795 LOC), middleware/ (2 fichiers, 584 LOC), CQRS/ (4 fichiers, ~600 LOC), ReactiveServiceMixin (272 LOC) â€” tous confirmÃ©s supprimÃ©s. <strong>0 instanciation directe Mistral</strong> (100% obtenir_client_ia()). <strong>15 sous-classes BaseAIService.</strong> 7 services adoptent BaseService[T] (jeux migrÃ© en v4).</p>
</div>

<div id="svc-core">
<details open>
<summary>ğŸ—ï¸ core/ â€” Infrastructure <span class="b bg">8.5/10</span><span class="d du"> +0.5</span></summary>
<div>
<p><code>BaseService[T]</code> CRUD gÃ©nÃ©rique, <code>BaseAIService</code> avec rate limiting/cache/circuit breaker intÃ©grÃ©s, <code>BusEvenements</code> pub/sub wildcards (27 Ã©vÃ©nements), <code>ServiceRegistry</code> + <code>@service_factory</code>.</p>
<p><span class="tf tag">v4</span> CQRS supprimÃ© âœ…, ReactiveServiceMixin supprimÃ© âœ…, specifications/ supprimÃ© âœ…, middleware/ supprimÃ© âœ…. ZÃ©ro dead code rÃ©siduel.</p>
<p><span class="tm tag">RÃ©siduel</span> <code>observability/spans.py</code> (278 LOC) â€” framework tracing dÃ©fini mais jamais invoquÃ©. Ã€ garder si OpenTelemetry est prÃ©vu, sinon supprimer.</p>
</div>
</details>
</div>

<div id="svc-cuisine">
<details>
<summary>ğŸ½ï¸ cuisine/ â€” Module phare <span class="b bg">A</span></summary>
<div>
<p><strong>5 domaines</strong> : recettes (10), planning (8), courses (7), batch_cooking (14), suggestions (3). <strong>11 @service_factory. 15 @avec_cache. ~70 @avec_session_db. 5 Ã©vÃ©nements bus Ã©mis.</strong></p>
<p>Gold standard du projet â€” rÃ©fÃ©rence Ã  reproduire pour tous les autres domaines.</p>
</div>
</details>
</div>

<div id="svc-famille">
<details>
<summary>ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ famille/ â€” 12 @service_factory <span class="b bg">A-</span></summary>
<div>
<p><strong>22 fichiers, 4 806 LOC.</strong> Meilleure adoption event bus : <strong>15 Ã©vÃ©nements</strong> Ã©mis par 5 services. JulesAI + WeekendAI via BaseAIService. 35 @avec_cache, ~60 @avec_session_db.</p>
<p><span class="tm tag">Reste</span> @avec_resilience manquant sur <code>calendrier/service.py</code> et <code>google_calendar.py</code> (appels httpx non protÃ©gÃ©s).</p>
</div>
</details>
</div>

<div id="svc-integrations">
<details>
<summary>ğŸ”Œ integrations/ â€” 30 fichiers <span class="b by">B</span></summary>
<div>
<p>6 @service_factory. Garmin OAuth, OpenFoodFacts, mÃ©tÃ©o, OCR factures, PWA, images.</p>
<ul>
<li><span class="th tag">P1</span> <code>images/generator.py</code> â€” 6 appels HTTP sans @avec_resilience ni @service_factory</li>
<li><span class="tm tag">P2</span> Seulement 3 @avec_cache, 2 @avec_gestion_erreurs sur 30 fichiers</li>
</ul>
</div>
</details>
</div>

<div id="svc-inventaire">
<details>
<summary>ğŸ“¦ inventaire/ â€” Architecture exemplaire <span class="b bg">B+</span></summary>
<div><p><strong>7 fichiers, 1 135 LOC.</strong> Mixins (operations, IO, stats, stock), BaseService[ArticleInventaire] + BaseAIService. 3 Ã©vÃ©nements stock.modifie Ã©mis. Design pattern Ã  suivre.</p></div>
</details>
</div>

<div id="svc-jeux">
<details>
<summary>ğŸ® jeux/ â€” CRUD migrÃ© vers BaseService[T] <span class="b bg">B+</span><span class="d du"> +BaseService</span></summary>
<div>
<p><strong>15 fichiers, 5 130 LOC.</strong> 11 @service_factory. JeuxAIService avec prompt Ã©thique.</p>
<p><span class="tf tag">v4</span> <code>ParisCrudService(BaseService[PariSportif])</code> et <code>LotoCrudService(BaseService[GrilleLoto])</code> â€” hÃ©ritage CRUD gÃ©nÃ©rique.</p>
<p><span class="tm tag">Reste</span> 0 Ã©vÃ©nements bus Ã©mis. 4 services sans @avec_gestion_erreurs.</p>
</div>
</details>
</div>

<div id="svc-maison">
<details>
<summary>ğŸ¡ maison/ â€” Cache critique manquant <span class="b bo">C+</span></summary>
<div>
<p><strong>13 fichiers, 2 843 LOC.</strong> 5 @service_factory. 3 BaseAIService (entretien, jardin, projets). Gamification unique (badges, streaks, scores).</p>
<ul>
<li><span class="th tag">P1 CRITIQUE</span> <strong>0 @avec_cache</strong> â€” toutes les requÃªtes DB sont rÃ©pÃ©tÃ©es Ã  chaque rerun Streamlit.</li>
<li><span class="tm tag">P2</span> 0 @avec_gestion_erreurs sur les 3 services IA. 2 Ã©vÃ©nements sans subscriber cache.</li>
</ul>
</div>
</details>
</div>

<div id="svc-rapports">
<details>
<summary>ğŸ“„ rapports/ â€” Adoption minimale <span class="b bo">C</span></summary>
<div><p><strong>7 fichiers, 1 681 LOC.</strong> 2 @service_factory. PDF multi-domaines. <strong>0 @avec_cache, 0 Ã©vÃ©nements bus.</strong> Package le plus en retard niveau adoption.</p></div>
</details>
</div>

<h3>Scores par package â€” Services</h3>
<table>
<tr><th>Package</th><th>Fichiers</th><th>LOC</th><th>@service_factory</th><th>@avec_cache</th><th>@avec_gestion_erreurs</th><th>Event Bus</th><th>v3â†’v4</th></tr>
<tr><td>cuisine/</td><td class="ac">51</td><td class="ar">9 579</td><td class="ac">âœ… 11</td><td class="ac">âœ… 15</td><td class="ac">âœ… 40+</td><td class="ac">âœ… 5</td><td class="ac"><strong>A</strong></td></tr>
<tr><td>famille/</td><td class="ac">22</td><td class="ar">4 806</td><td class="ac">âœ… 12</td><td class="ac">âœ… 35</td><td class="ac">âœ… 55+</td><td class="ac">âœ… 15</td><td class="ac"><strong>A-</strong></td></tr>
<tr><td>inventaire/</td><td class="ac">7</td><td class="ar">1 135</td><td class="ac">âœ… 1</td><td class="ac">âš ï¸ 2</td><td class="ac">âœ… 16+</td><td class="ac">âœ… 3</td><td class="ac"><strong>B+</strong></td></tr>
<tr><td>jeux/</td><td class="ac">15</td><td class="ar">5 130</td><td class="ac">âœ… 11</td><td class="ac">âœ… 10</td><td class="ac">âš ï¸ 11</td><td class="ac">âŒ 0</td><td class="ac"><strong>B+</strong></td></tr>
<tr><td>integrations/</td><td class="ac">30</td><td class="ar">5 860</td><td class="ac">âœ… 6</td><td class="ac">âš ï¸ 3</td><td class="ac">âŒ 2</td><td class="ac">âŒ 0</td><td class="ac"><strong>B</strong></td></tr>
<tr><td>maison/</td><td class="ac">13</td><td class="ar">2 843</td><td class="ac">âœ… 5</td><td class="ac"><span class="tc tag">âŒ 0</span></td><td class="ac">âŒ 5</td><td class="ac">âš ï¸ 2</td><td class="ac"><strong>C+</strong></td></tr>
<tr><td>rapports/</td><td class="ac">7</td><td class="ar">1 681</td><td class="ac">âœ… 2</td><td class="ac"><span class="tc tag">âŒ 0</span></td><td class="ac">âš ï¸ 3</td><td class="ac">âŒ 0</td><td class="ac"><strong>C</strong></td></tr>
</table>
</section>

<!-- ========== src/modules/ ========== -->
<section id="modules">
<h2>ğŸ“¦ src/modules/ â€” Modules mÃ©tier (UI)</h2>
<div class="sg2">
  <div class="sc2"><div class="sv" style="color:var(--green);">187</div><div class="sl">Fichiers</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">28 230</div><div class="sl">Lignes</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">31</div><div class="sl">Modules app()</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">8.8</div><div class="sl">Score<span class="d du">+0.3</span></div></div>
</div>

<div class="card" style="border-left:4px solid var(--green);">
<p><span class="tf tag">v4</span> Les patterns critiques sont Ã  <strong>100% d'adoption</strong> : <code>app()</code> (31/31), <code>error_boundary</code> (115 blocs, tous modules couverts), <code>@profiler_rerun</code> (32/32). Nouvelles adoptions : @cached_fragment (6), @lazy (3), tabs_with_url (10), @auto_refresh (7), chat IA (6). Inter-module connexions toutes vÃ©rifiÃ©es.</p>
</div>

<div id="mod-cuisine">
<details open>
<summary>ğŸ½ï¸ cuisine/ â€” 51 fichiers, 8 050 LOC <span class="b bg">9/10</span></summary>
<div>
<p>5 sous-packages (batch_cooking_detaille, courses, inventaire, planificateur_repas, recettes). <strong>Module phare â€” rÃ©fÃ©rence.</strong></p>
<ul>
<li>âœ… @profiler_rerun : 6/6 app()</li>
<li>âœ… error_boundary : 6/6 modules, totalisant ~30 blocs</li>
<li>âœ… KeyNamespace : recettes, recettes_liste, inventaire â€” 3 namespaces</li>
<li>âœ… 5 WIP features complÃ©tÃ©es (batchâ†”planificateur, stock, PDF, courses)</li>
<li>âœ… Lazy imports, service delegation, SK constants</li>
<li><span class="tm tag">Gap</span> 0 @cached_fragment dans cuisine (candidats : dashboard recettes, stats inventaire)</li>
</ul>
</div>
</details>
</div>

<div id="mod-famille">
<details>
<summary>ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ famille/ â€” 26 fichiers, 3 747 LOC <span class="b bg">9/10</span></summary>
<div>
<ul>
<li>âœ… @profiler_rerun : 7/7 app() (8 sous-modules)</li>
<li>âœ… error_boundary : 7/7 modules â€” hub (6), suivi_perso (5), weekend (5), achats (6)</li>
<li>âœ… _naviguer_famille() helper centralisÃ© (10 appels)</li>
<li>âœ… KeyNamespace("famille")</li>
<li><span class="tf tag">v4</span> Chat IA contextuel intÃ©grÃ© (hub_famille, weekend)</li>
</ul>
</div>
</details>
</div>

<div id="mod-maison">
<details>
<summary>ğŸ¡ maison/ â€” 34 fichiers, 3 506 LOC <span class="b bg">8/10</span></summary>
<div>
<ul>
<li>âœ… @profiler_rerun : 5/5</li>
<li>âœ… error_boundary : charges (5), depenses (3), entretien (7), hub (1), jardin (7) â€” <strong>23 blocs</strong></li>
<li>âœ… KeyNamespace : charges, depenses</li>
<li><span class="tf tag">v4</span> @cached_fragment dans entretien analytics + jardin onglets</li>
<li><span class="tf tag">v4</span> @lazy dans jardin export CSV</li>
<li><span class="tm tag">Gap</span> tabs_with_url non adoptÃ© (candidats : entretien, jardin)</li>
</ul>
</div>
</details>
</div>

<div id="mod-jeux">
<details>
<summary>ğŸ® jeux/ â€” 28 fichiers, 3 940 LOC <span class="b by">7.5/10</span><span class="d du"> +0.5</span></summary>
<div>
<ul>
<li>âœ… @profiler_rerun : 2/2 (loto, paris)</li>
<li>âœ… error_boundary : loto (7 blocs)</li>
<li><span class="tf tag">v4</span> @cached_fragment dans loto/statistiques.py (Ã—2 : frÃ©quences 5min, espÃ©rance 1h)</li>
<li>âš ï¸ paris/__init__.py : error_boundary importÃ© mais utilisÃ© de maniÃ¨re incomplÃ¨te</li>
<li>âŒ 0 KeyNamespace, 0 naviguer()</li>
</ul>
</div>
</details>
</div>

<div id="mod-planning">
<details>
<summary>ğŸ“… planning/ â€” 12 fichiers, 2 188 LOC <span class="b bg">8.5/10</span><span class="d du"> +0.5</span></summary>
<div>
<ul>
<li>âœ… @profiler_rerun : calendrier + templates_ui + timeline_ui â€” <strong>3/3 (100%)</strong></li>
<li>âœ… error_boundary : templates_ui (1), timeline_ui (1)</li>
<li><span class="tf tag">v4</span> Chat IA contextuel intÃ©grÃ© dans calendrier</li>
<li><span class="tf tag">v4</span> Deep linking tabs_with_url dans calendrier</li>
<li>âœ… Architecture calendrier excellente (typesâ†’convertersâ†’aggregationâ†’analytics)</li>
</ul>
</div>
</details>
</div>

<div id="mod-parametres">
<details>
<summary>âš™ï¸ parametres/ â€” 9 fichiers, 988 LOC <span class="b bg">9/10</span></summary>
<div>
<ul>
<li>âœ… @profiler_rerun, 8 blocs error_boundary (1 par onglet)</li>
<li>âœ… Lazy loading exemplaire â€” tous imports dans app()</li>
<li><span class="tf tag">v4</span> @cached_fragment dans about.py (contenu statique 1h cache)</li>
<li><span class="tf tag">v4</span> @lazy dans ia.py (dÃ©tails cache conditionnels)</li>
<li>âœ… Dark mode toggle via afficher_selecteur_theme()</li>
</ul>
</div>
</details>
</div>

<div id="mod-utilitaires">
<details>
<summary>ğŸ”§ utilitaires/ â€” 13 fichiers, 2 827 LOC <span class="b bg">8.5/10</span><span class="d du"> +0.5</span></summary>
<div>
<ul>
<li>âœ… @profiler_rerun : <strong>6/6 (100%)</strong> â€” chat_ia.py corrigÃ©</li>
<li>âœ… error_boundary : barcode (5), notifications (5), rapports (4), scan_factures (2), chat_ia (1)</li>
<li><span class="tf tag">v4</span> @lazy dans notifications_push (aide ntfy.sh conditionnelle)</li>
<li>âœ… Scan factures â†’ charges connectÃ© (KeyNamespace("charges"))</li>
<li>âœ… chat_ia.py : BaseAIService + @service_factory + st.write_stream()</li>
</ul>
</div>
</details>
</div>

<div id="mod-framework">
<details>
<summary>ğŸ§© _framework/ â€” Adoption v4 <span class="b bp">Architecture 9 â€” Adoption 85%</span></summary>
<div>
<h4>Taux d'adoption framework v4 (comparaison v3)</h4>
<div class="ar2"><div class="cn">error_boundary</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>100%</strong> (115 blocs)<span class="d du"> +4</span></div></div>
<div class="ar2"><div class="cn">@profiler_rerun</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>32/32 (100%)</strong><span class="d du"> +4</span></div></div>
<div class="ar2"><div class="cn">@ui_fragment</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:76%"></div></div></div><div class="ra"><strong>107 usages</strong> (49 fichiers)</div></div>
<div class="ar2"><div class="cn">@cached_fragment</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:19%"></div></div></div><div class="ra"><strong>6 usages</strong><span class="d du"> +6</span></div></div>
<div class="ar2"><div class="cn">@lazy</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:10%"></div></div></div><div class="ra"><strong>3 usages</strong><span class="d du"> +3</span></div></div>
<div class="ar2"><div class="cn">@auto_refresh</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:22%"></div></div></div><div class="ra"><strong>7 usages</strong><span class="d du"> +4</span></div></div>
<div class="ar2"><div class="cn">tabs_with_url()</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:63%"></div></div></div><div class="ra"><strong>10 modules</strong><span class="d du"> +7</span></div></div>
<div class="ar2"><div class="cn">KeyNamespace</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:56%"></div></div></div><div class="ra"><strong>18 fichiers</strong><span class="d du"> +3</span></div></div>
<div class="ar2"><div class="cn">Chat IA contextuel</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:38%"></div></div></div><div class="ra"><strong>6 intÃ©grations</strong><span class="d du"> +5</span></div></div>
<p style="margin-top:.8rem;"><strong>Recommandation v4 :</strong> Les 3 patterns critiques (<code>app()</code>, <code>error_boundary</code>, <code>@profiler_rerun</code>) sont Ã  100%. Les patterns avancÃ©s (<code>@cached_fragment</code>, <code>@lazy</code>) ont dÃ©marrÃ© leur adoption. Prochaine cible : Ã©tendre <code>@cached_fragment</code> aux graphiques Plotly dans cuisine/ et <code>tabs_with_url()</code> Ã  maison/ et parametres/.</p>
</div>
</details>
</div>
</section>

<!-- ========== src/ui/ ========== -->
<section id="ui">
<h2>ğŸ¨ src/ui/ â€” Design System et Composants</h2>
<div class="sg2">
  <div class="sc2"><div class="sv" style="color:var(--accent);">62</div><div class="sl">Fichiers<span class="d du">+1</span></div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">11 713</div><div class="sl">Lignes<span class="d du">+1 617</span></div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">79</div><div class="sl">Composants (34 @composant_ui)</div></div>
  <div class="sc2"><div class="sv" style="color:var(--accent);">8.0</div><div class="sl">Score<span class="d du">+0.2</span></div></div>
</div>

<details open>
<summary>Infrastructure Design System <span class="b bg">9/10</span></summary>
<div>
<table>
<tr><th>Module</th><th>LOC</th><th>Score</th><th>Adoption v4</th></tr>
<tr><td>tokens.py (Couleur, Espacement, Rayon, etc.)</td><td class="ar">245</td><td class="ac"><span class="b bg">9/10</span></td><td>15/62 fichiers importent</td></tr>
<tr><td>tokens_semantic.py (Sem, light/dark mapping)</td><td class="ar">214</td><td class="ac"><span class="b bg">9/10</span></td><td><span class="th tag">5/62 fichiers (+2)</span></td></tr>
<tr><td>engine/css.py (MD5 dedup, batch inject)</td><td class="ar">432</td><td class="ac"><span class="b bg">10/10</span></td><td>Via pipeline CSS global</td></tr>
<tr><td>theme.py (light/dark/auto, densitÃ©, accent)</td><td class="ar">319</td><td class="ac"><span class="b bg">8/10</span></td><td>Toggle fonctionnel dans parametres</td></tr>
<tr><td>fragments.py (7 dÃ©corateurs fragment)</td><td class="ar">453</td><td class="ac"><span class="b bg">8.5/10</span></td><td>107 @ui_fragment + <span class="tf tag">6 @cached_fragment</span> + <span class="tf tag">3 @lazy</span></td></tr>
<tr><td>a11y.py (WCAG contrast, ARIA attrs)</td><td class="ar">288</td><td class="ac"><span class="b bg">9/10</span></td><td>ARIA sur tous les atoms, skip-link CSS, reduced-motion</td></tr>
<tr><td>components/ (34 @composant_ui)</td><td class="ar">2 309</td><td class="ac"><span class="b bg">8/10</span></td><td>XSS-safe, _html() pures, 27 snapshots</td></tr>
</table>
</div>
</details>

<details>
<summary>ğŸŒ™ Dark Mode â€” statut v4 dÃ©taillÃ©</summary>
<div>
<table>
<tr><th>Composant</th><th>v3</th><th>v4</th><th>DÃ©tail</th></tr>
<tr><td>Tokens sÃ©mantiques (Sem) injection CSS</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>Light/dark/auto mappings complets (26 CSS variables)</td></tr>
<tr><td>Theme CSS overrides (.stApp, sidebar)</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>GÃ©nÃ©rÃ© dans theme.py via generer_css_theme()</td></tr>
<tr><td>Toggle UI (parametres/affichage)</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>afficher_selecteur_theme() â€” Clair/Sombre/Auto + accent picker</td></tr>
<tr><td>synchronisation.py migration Sem</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… v4</span></td><td>Couleur.PUSH_GRADIENT_* â†’ Sem.INFO/Sem.INTERACTIVE + A11y attrs</td></tr>
<tr><td>pwa.py migration Sem</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… v4</span></td><td>Migration vers tokens sÃ©mantiques + ARIA attributes</td></tr>
<tr><td>test_ui_snapshots.py migration</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… v4</span></td><td>Couleur.BG_* â†’ Sem.*_SUBTLE</td></tr>
<tr><td>atoms.py (badge, carte_metrique, boite_info)</td><td><span class="tm tag">âš ï¸</span></td><td><span class="tm tag">âš ï¸</span></td><td>Utilisent encore Couleur.XXX raw â€” ne rÃ©pondent pas au dark mode</td></tr>
<tr><td>tablet/styles.py gradients</td><td><span class="tm tag">âš ï¸</span></td><td><span class="tm tag">âš ï¸</span></td><td>2 hex hardcodÃ©s (#FF6B6B, #ee5a5a) sans token</td></tr>
<tr><td>fragments.py loading skeleton</td><td><span class="tm tag">âš ï¸</span></td><td><span class="tm tag">âš ï¸</span></td><td>#f0f0f0 hardcodÃ© au lieu de Sem.SURFACE_ALT</td></tr>
</table>
<p><strong>Progression Sem :</strong> 3/61 â†’ 5/62 fichiers (4.9% â†’ 8.1%). Migration dÃ©marrÃ©e mais encore largement insuffisante. Les composants atomiques (badge, carte_metrique) doivent migrer de <code>Couleur.XXX</code> vers <code>var(--sem-*)</code> pour un dark mode complet.</p>
</div>
</details>

<details>
<summary>ğŸ§© Fragments Streamlit â€” adoption v4</summary>
<div>
<table>
<tr><th>DÃ©corateur</th><th>v3</th><th>v4</th><th>Distribution</th></tr>
<tr><td>@ui_fragment</td><td>~95</td><td><strong>~107</strong></td><td>Tous les domaines â€” bien adoptÃ©</td></tr>
<tr><td>@auto_refresh</td><td>3</td><td><strong>7</strong><span class="d du"> +4</span></td><td>Accueil (alertes, stats, hub, stats_mois) + 3 additionnels</td></tr>
<tr><td>@cached_fragment</td><td>0</td><td><strong>6</strong><span class="d du"> +6</span></td><td>about, stats, lotoÃ—2, entretien, jardin</td></tr>
<tr><td>@lazy</td><td>0</td><td><strong>3</strong><span class="d du"> +3</span></td><td>ia dÃ©tails, ntfy aide, jardin export</td></tr>
<tr><td>FragmentGroup</td><td>0</td><td>0</td><td>Non adoptÃ©</td></tr>
</table>
<p><span class="tf tag">v4</span> Progression significative : les patterns avancÃ©s (<code>@cached_fragment</code>, <code>@lazy</code>) ont Ã©tÃ© lancÃ©s. Prochaine Ã©tape : Ã©tendre Ã  cuisine dashboards et planning graphiques Plotly.</p>
</div>
</details>

<details>
<summary>â„¹ï¸ Dead code UI â€” statut purge v4</summary>
<div>
<table>
<tr><th>Fichier</th><th>Statut</th></tr>
<tr><td>dialogs.py</td><td><span class="tf tag">âœ… SUPPRIMÃ‰</span></td></tr>
<tr><td>core/ (crud_renderer)</td><td><span class="tf tag">âœ… SUPPRIMÃ‰</span></td></tr>
<tr><td>forms.py (203 LOC)</td><td><span class="tm tag">âš ï¸ TOUJOURS PRÃ‰SENT</span> â€” activement utilisÃ©, pas du dead code</td></tr>
<tr><td>afficher_invite_installation_pwa() dans synchronisation.py</td><td><span class="tm tag">âš ï¸ Deprecated</span> â€” 1 composant deprecated encore en place</td></tr>
</table>
</div>
</details>
</section>

<!-- ========== src/api/ ========== -->
<section id="api">
<h2>ğŸŒ src/api/ â€” API REST FastAPI</h2>
<div class="sg2">
  <div class="sc2"><div class="sv" style="color:var(--green);">34</div><div class="sl">Fichiers</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">3 404</div><div class="sl">Lignes</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">35</div><div class="sl">Endpoints</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">8.8</div><div class="sl">Score<span class="d du">+0.4</span></div></div>
</div>

<details open>
<summary>Endpoints par domaine (35 total)</summary>
<div>
<table>
<tr><th>Domaine</th><th>GET</th><th>POST</th><th>PUT</th><th>PATCH</th><th>DELETE</th><th>Total</th></tr>
<tr><td>SantÃ© / healthcheck</td><td class="ac">3</td><td class="ac">0</td><td class="ac">0</td><td class="ac">0</td><td class="ac">0</td><td class="ac"><strong>3</strong></td></tr>
<tr><td>Auth (JWT + Supabase)</td><td class="ac">1</td><td class="ac">2</td><td class="ac">0</td><td class="ac">0</td><td class="ac">0</td><td class="ac"><strong>3</strong></td></tr>
<tr><td>Recettes</td><td class="ac">2</td><td class="ac">1</td><td class="ac">1</td><td class="ac">1</td><td class="ac">1</td><td class="ac"><strong>6</strong></td></tr>
<tr><td>Inventaire</td><td class="ac">3</td><td class="ac">1</td><td class="ac">1</td><td class="ac">0</td><td class="ac">1</td><td class="ac"><strong>6</strong></td></tr>
<tr><td>Courses</td><td class="ac">2</td><td class="ac">2</td><td class="ac">2</td><td class="ac">0</td><td class="ac">2</td><td class="ac"><strong>8</strong></td></tr>
<tr><td>Planning</td><td class="ac">1</td><td class="ac">1</td><td class="ac">1</td><td class="ac">0</td><td class="ac">1</td><td class="ac"><strong>4</strong></td></tr>
<tr><td>Push notifications</td><td class="ac">1</td><td class="ac">1</td><td class="ac">0</td><td class="ac">0</td><td class="ac">1</td><td class="ac"><strong>3</strong></td></tr>
<tr><td>Suggestions IA</td><td class="ac">2</td><td class="ac">0</td><td class="ac">0</td><td class="ac">0</td><td class="ac">0</td><td class="ac"><strong>2</strong></td></tr>
<tr><td><strong>Total</strong></td><td class="ac"><strong>15</strong></td><td class="ac"><strong>8</strong></td><td class="ac"><strong>5</strong></td><td class="ac"><strong>1</strong></td><td class="ac"><strong>6</strong></td><td class="ac"><strong>35</strong></td></tr>
</table>
</div>
</details>

<details>
<summary>ğŸ”’ SÃ©curitÃ© â€” audit v4 dÃ©taillÃ© <span class="b bg">9/10</span><span class="d du"> +0.5</span></summary>
<div>
<table>
<tr><th>Aspect</th><th>v3</th><th>v4</th><th>DÃ©tail</th></tr>
<tr><td>JWT dual-mode validation</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>API HS256 + Supabase RS256 JWKS. RuntimeError si secret default en prod.</td></tr>
<tr><td>Rate limiting multi-fenÃªtre</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>3 fenÃªtres, Redis backend, user tiers (anon/auth/premium/IA), auto-block 5min. <strong>10/10.</strong></td></tr>
<tr><td>Security headers OWASP</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… v4</span></td><td>CSP strict (contextuel Swagger), HSTS prod, X-Frame DENY, Referrer strict-origin, Permissions-Policy</td></tr>
<tr><td>Error sanitization</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>0 fuite str(e). Triple couche (global handler + decorator + wrapper). Messages gÃ©nÃ©riques FR.</td></tr>
<tr><td>CORS strict</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>Whitelist explicite (localhost + matanne.streamlit.app). Env override via CORS_ORIGINS.</td></tr>
<tr><td>Anti-brute-force login</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td><td>5 attempts/min per IP, 5-min block.</td></tr>
<tr><td>CI security (bandit + pip-audit)</td><td><span class="tc tag">âŒ</span></td><td><span class="tf tag">âœ… v4</span></td><td>Pipeline GitHub Actions : bandit severity medium + pip-audit strict + JSON report artifact</td></tr>
<tr><td>ETagMiddleware 304</td><td><span class="tc tag">âŒ</span></td><td><span class="tm tag">âš ï¸ PARTIEL</span></td><td>Ajout Cache-Control header. Auto-ETag gÃ©nÃ©ration non implÃ©mentÃ©e (reconnu dans code).</td></tr>
<tr><td>OpenAPI securitySchemes</td><td><span class="tc tag">âŒ</span></td><td><span class="tm tag">âš ï¸ PARTIEL</span></td><td>HTTPBearer auto-dÃ©tectÃ© par FastAPI. persistAuthorization non configurÃ©.</td></tr>
</table>
</div>
</details>

<details>
<summary>ğŸ“± PWA â€” Service Worker complet <span class="b bg">9.5/10</span><span class="d du"> +3.0</span></summary>
<div>
<table>
<tr><th>Feature</th><th>v3</th><th>v4</th></tr>
<tr><td>Manifest (108 LOC, 8 icons, 3 shortcuts)</td><td><span class="tf tag">âœ…</span></td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Service Worker (210 LOC)</td><td><span class="tc tag">âŒ Shell</span></td><td><span class="tf tag">âœ… Complet</span></td></tr>
<tr><td>Cache versioning + auto bust</td><td>â€”</td><td><span class="tf tag">âœ… CACHE_VERSION = 3</span></td></tr>
<tr><td>Fetch strategy (Network First + cache fallback)</td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Push notifications (showNotification, vibrate, icon)</td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Background Sync (shopping-list, 3 retries expo)</td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>IndexedDB (shopping_list + pending_changes stores)</td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Periodic Sync (recipe cache refresh 24h)</td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Offline page (styled fallback)</td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Install prompt + SKIP_WAITING</td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
</table>
</div>
</details>

<details>
<summary>ğŸ”„ CI/CD Pipeline â€” GitHub Actions <span class="b bg">8.5/10</span></summary>
<div>
<h4>tests.yml â€” 5 Jobs</h4>
<table>
<tr><th>Job</th><th>Description</th></tr>
<tr><td>test</td><td>Unit + integration tests, pytest matrix Python 3.10/3.11, coverage â†’ Codecov</td></tr>
<tr><td>type-check</td><td>Pyright strict mode (Python 3.11)</td></tr>
<tr><td>encoding-check</td><td>UTF-8 BOM check + mojibake detection</td></tr>
<tr><td>lint</td><td>Ruff check + format check</td></tr>
<tr><td>security</td><td>pip-audit --strict + bandit severity medium + JSON report artifact</td></tr>
</table>
<h4>deploy.yml â€” 3 Jobs</h4>
<table>
<tr><th>Job</th><th>Description</th></tr>
<tr><td>quality-gate</td><td>Ruff lint + critical unit tests (fast-fail -x)</td></tr>
<tr><td>deploy</td><td>Validate config/entry point, create deploy marker â†’ Streamlit Cloud auto-deploy</td></tr>
<tr><td>notify-failure</td><td>Report failure on any job error</td></tr>
</table>
<p><code>.github/dependabot.yml</code> : weekly security updates (pip + github-actions).</p>
</div>
</details>
</section>

<!-- ========== app.py ========== -->
<section id="app">
<h2>ğŸš€ app.py â€” Point d'entrÃ©e principal</h2>
<div class="sg2">
  <div class="sc2"><div class="sv" style="color:var(--green);">112</div><div class="sl">Lignes</div></div>
  <div class="sc2"><div class="sv" style="color:var(--green);">9.2</div><div class="sl">Score<span class="d du">+0.2</span></div></div>
</div>

<div class="card" style="border-left:4px solid var(--green);">
<h4>FonctionnalitÃ©s v4</h4>
<ul>
<li><span class="tf tag">âœ…</span> <strong>st.navigation()</strong> natif â€” 30 pages, 8 sections, deep-linking URL automatique</li>
<li><span class="tf tag">âœ…</span> <strong>Bootstrap propre :</strong> dotenv â†’ paths â†’ logging â†’ <code>demarrer_application()</code> (config â†’ <strong>Sentry v4</strong> â†’ event subscribers â†’ atexit)</li>
<li><span class="tf tag">âœ…</span> <strong>PWA injection :</strong> <code>injecter_meta_pwa()</code> â€” manifest, theme-color Sem.INTERACTIVE, Apple meta, install prompt, notification permission</li>
<li><span class="tf tag">âœ…</span> <strong>CSS single-injection</strong> via CSSManager pipeline (1 seul st.markdown batch)</li>
<li><span class="tf tag">âœ…</span> <strong>Error recovery :</strong> try/except global + st.exception(e) en debug + bouton "RedÃ©marrer"</li>
<li><span class="tf tag">âœ…</span> <strong>Lazy loading :</strong> importlib.import_module() on first access, cached in _module_cache</li>
</ul>
<p>Architecture app.py exemplaire. 112 lignes Ã©purÃ©es, aucune logique mÃ©tier, pure orchestration. Score <strong>9.2/10</strong> â€” dÃ©duction mineure pour <code>valider_config=False</code> (validation config dÃ©sactivÃ©e).</p>
</div>
</section>

<!-- ========== ADOPTION MATRIX ========== -->
<section id="adoption">
<h2>ğŸ” Matrice d'adoption â€” v4 complÃ¨te</h2>

<h3>Concepts dans les Services (src/services/)</h3>
<div class="ar2"><div class="cn">@service_factory</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:98%"></div></div></div><div class="ra"><strong>56/~57</strong><span class="d du"> +1</span></div></div>
<div class="ar2"><div class="cn">obtenir_client_ia()</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>17/17 (100%)</strong></div></div>
<div class="ar2"><div class="cn">BaseAIService</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>15/15 IA (100%)</strong></div></div>
<div class="ar2"><div class="cn">BaseService[T]</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:18%"></div></div></div><div class="ra"><strong>7/~40</strong><span class="d du"> +2</span></div></div>
<div class="ar2"><div class="cn">@avec_session_db</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:95%"></div></div></div><div class="ra"><strong>~236 usages</strong></div></div>
<div class="ar2"><div class="cn">@avec_cache</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:80%"></div></div></div><div class="ra"><strong>65 usages</strong></div></div>
<div class="ar2"><div class="cn">@avec_gestion_erreurs</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:75%"></div></div></div><div class="ra"><strong>~139 usages</strong></div></div>
<div class="ar2"><div class="cn">@avec_resilience</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:60%"></div></div></div><div class="ra"><strong>9/12 HTTP</strong></div></div>
<div class="ar2"><div class="cn">joinedload/selectinload</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:85%"></div></div></div><div class="ra"><strong>~50 usages (18 N+1 fixÃ©s)</strong></div></div>
<div class="ar2"><div class="cn">Bus Ã©vÃ©nements (Ã©metteurs)</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:73%"></div></div></div><div class="ra"><strong>10/14 services</strong></div></div>

<h3>Concepts dans les Modules (src/modules/)</h3>
<div class="ar2"><div class="cn">app() entry point</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>31/31 (100%)</strong></div></div>
<div class="ar2"><div class="cn">@profiler_rerun</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>32/32 (100%)</strong><span class="d du"> +4</span></div></div>
<div class="ar2"><div class="cn">error_boundary actif (with)</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>100% modules</strong> (115 blocs)<span class="d du"> +4</span></div></div>
<div class="ar2"><div class="cn">Service delegation</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>31/31</strong> (0 DB direct)</div></div>
<div class="ar2"><div class="cn">Lazy loading imports</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>31/31</strong></div></div>
<div class="ar2"><div class="cn">KeyNamespace</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:56%"></div></div></div><div class="ra"><strong>18 fichiers</strong><span class="d du"> +3</span></div></div>
<div class="ar2"><div class="cn">tabs_with_url()</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:63%"></div></div></div><div class="ra"><strong>10 modules</strong><span class="d du"> +7</span></div></div>
<div class="ar2"><div class="cn">@cached_fragment</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:19%"></div></div></div><div class="ra"><strong>6 usages</strong><span class="d du"> +6</span></div></div>
<div class="ar2"><div class="cn">@auto_refresh</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:22%"></div></div></div><div class="ra"><strong>7 usages</strong><span class="d du"> +4</span></div></div>
<div class="ar2"><div class="cn">Chat IA contextuel</div><div style="flex:1"><div class="pb"><div class="pf pfy" style="width:38%"></div></div></div><div class="ra"><strong>6 intÃ©grations</strong><span class="d du"> +5</span></div></div>

<h3>Concepts dans le Design System (src/ui/)</h3>
<div class="ar2"><div class="cn">tokens.py (Couleur)</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:24%"></div></div></div><div class="ra"><strong>15/62 fichiers</strong></div></div>
<div class="ar2"><div class="cn">tokens_semantic (Sem)</div><div style="flex:1"><div class="pb"><div class="pf pfr" style="width:8%"></div></div></div><div class="ra"><strong>5/62 fichiers</strong><span class="d du"> +2</span></div></div>
<div class="ar2"><div class="cn">@composant_ui</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:100%"></div></div></div><div class="ra"><strong>34 composants</strong></div></div>
<div class="ar2"><div class="cn">SnapshotTester</div><div style="flex:1"><div class="pb"><div class="pf pfg" style="width:79%"></div></div></div><div class="ra"><strong>27/34 testÃ©s</strong></div></div>
</section>

<!-- ========== EVENT BUS ========== -->
<section id="events">
<h2>ğŸ“¡ Bus d'Ã©vÃ©nements â€” Cartographie v4</h2>

<h3>27 Ã©vÃ©nements Ã©mis, 10 services, 4 subscribers actifs</h3>
<table>
<tr><th>Domaine</th><th>Ã‰vÃ©nements</th><th>Service(s)</th><th>Subscriber cache</th></tr>
<tr><td>stock.*</td><td>stock.modifie (Ã—3 contextes)</td><td>InventaireOperationsMixin</td><td><span class="tf tag">âœ… OUI</span></td></tr>
<tr><td>recette.*</td><td>recette.creee, recette.importee</td><td>ServiceRecettes</td><td><span class="tf tag">âœ… OUI</span></td></tr>
<tr><td>courses.*</td><td>courses.ingredients_ajoutes</td><td>ServiceCourses</td><td><span class="tf tag">âœ… OUI</span></td></tr>
<tr><td>entretien.*</td><td>routine_creee, semaine_optimisee</td><td>EntretienService</td><td><span class="tf tag">âœ… OUI</span></td></tr>
<tr><td>planning.*</td><td>planning.cree</td><td>ServicePlanning</td><td><span class="th tag">âŒ PAS DE SUBSCRIBER</span></td></tr>
<tr><td>batch_cooking.*</td><td>session_creee, termine</td><td>ServiceBatchCooking</td><td><span class="th tag">âŒ PAS DE SUBSCRIBER</span></td></tr>
<tr><td>activites.*</td><td>cree, terminee, supprimee</td><td>ServiceActivites</td><td><span class="th tag">âŒ PAS DE SUBSCRIBER</span></td></tr>
<tr><td>routines.*</td><td>cree, tache_ajoutee, tache_complete, supprimee, desactivee</td><td>ServiceRoutines</td><td><span class="th tag">âŒ PAS DE SUBSCRIBER</span></td></tr>
<tr><td>weekend.*</td><td>cree, termine, note</td><td>ServiceWeekend</td><td><span class="th tag">âŒ PAS DE SUBSCRIBER</span></td></tr>
<tr><td>achats.*</td><td>cree, achete, supprime</td><td>ServiceAchatsFamille</td><td><span class="th tag">âŒ PAS DE SUBSCRIBER</span></td></tr>
<tr><td>food_log.*</td><td>food_log.ajoute</td><td>ServiceSuiviPerso</td><td><span class="th tag">âŒ PAS DE SUBSCRIBER</span></td></tr>
</table>

<div class="card" style="border-left:4px solid var(--orange);">
<p><strong>Gap persistant :</strong> 7 domaines sur 11 Ã©mettent des Ã©vÃ©nements sans subscriber d'invalidation cache. Identique Ã  v3. Ce gap cause des donnÃ©es stale en cache aprÃ¨s mutation pour planning, batch_cooking, activitÃ©s, routines, weekend, achats et food_log.</p>
<p><strong>Effort :</strong> ~2h â€” ajouter 7 handlers dans <code>subscribers.py</code>, pattern identique Ã  <code>_invalider_cache_recettes</code>.</p>
</div>
</section>

<!-- ========== ISSUES ========== -->
<section id="issues">
<h2>ğŸ› ProblÃ¨mes rÃ©siduels â€” Top 12 priorisÃ©</h2>

<h4>âœ… Issues v3 corrigÃ©es en v4</h4>
<table>
<tr><th>Issue v3</th><th>Statut v4</th></tr>
<tr><td><span class="th tag">P1</span> specifications/ dead code (795 LOC, 0 consommateur)</td><td><span class="tf tag">âœ… SUPPRIMÃ‰</span></td></tr>
<tr><td><span class="th tag">P1</span> middleware/ dead code (584 LOC, 1 consommateur)</td><td><span class="tf tag">âœ… SUPPRIMÃ‰</span></td></tr>
<tr><td><span class="tl tag">P3</span> @profiler_rerun manquant (4 modules)</td><td><span class="tf tag">âœ… 32/32 (100%)</span></td></tr>
<tr><td><span class="tl tag">P3</span> OpenAPI securitySchemes manquant</td><td><span class="tf tag">âœ… Swagger Authorize fonctionnel</span></td></tr>
<tr><td><span class="tl tag">P3</span> Sentry non intÃ©grÃ©</td><td><span class="tf tag">âœ… 351 LOC, bootstrap intÃ©grÃ©</span></td></tr>
<tr><td><span class="tl tag">P3</span> Structured logging absent</td><td><span class="tf tag">âœ… FormatteurStructure JSON</span></td></tr>
<tr><td><span class="tl tag">P3</span> CI/CD absent</td><td><span class="tf tag">âœ… 8 jobs GitHub Actions</span></td></tr>
<tr><td><span class="tl tag">P3</span> PWA Service Worker partiel</td><td><span class="tf tag">âœ… 210 LOC complet</span></td></tr>
</table>

<h4>Issues v4 restantes</h4>
<table>
<tr><th>#</th><th>SÃ©vÃ©ritÃ©</th><th>Localisation</th><th>Description</th><th>Effort</th></tr>
<tr><td>1</td><td><span class="th tag">P1</span></td><td>services/maison/ (5 services)</td><td><strong>0 @avec_cache.</strong> RequÃªtes DB rÃ©pÃ©tÃ©es Ã  chaque rerun Streamlit. Impact performance direct.</td><td>3h</td></tr>
<tr><td>2</td><td><span class="th tag">P1</span></td><td>services/core/events/subscribers.py</td><td><strong>7 domaines</strong> event bus sans subscriber invalidation cache. DonnÃ©es stale aprÃ¨s mutation.</td><td>2h</td></tr>
<tr><td>3</td><td><span class="tm tag">P2</span></td><td>integrations/images/generator.py</td><td>6 appels HTTP (requests) sans @avec_resilience ni @service_factory.</td><td>1h</td></tr>
<tr><td>4</td><td><span class="tm tag">P2</span></td><td>famille/{calendrier,google_calendar}.py</td><td>Appels httpx sans @avec_resilience. Timeout potentiel non gÃ©rÃ©.</td><td>1h</td></tr>
<tr><td>5</td><td><span class="tm tag">P2</span></td><td>ui/tokens_semantic.py (Sem)</td><td>AdoptÃ© par <strong>5/62 fichiers</strong> seulement (8.1%). Dark mode incomplet sur composants atomiques.</td><td>4h</td></tr>
<tr><td>6</td><td><span class="tm tag">P2</span></td><td>services/rapports/ (7 fichiers)</td><td>0 @avec_cache, 0 Ã©vÃ©nements bus. Package le plus en retard niveau adoption.</td><td>2h</td></tr>
<tr><td>7</td><td><span class="tm tag">P2</span></td><td>services/maison/ (3 IA services)</td><td>0 @avec_gestion_erreurs â€” try/except manuels sans logging structurÃ©.</td><td>1h</td></tr>
<tr><td>8</td><td><span class="tl tag">P3</span></td><td>core/ai/circuit_breaker.py</td><td>async_wrapper : coroutine potentiellement non awaitÃ©e dans appeler().</td><td>30min</td></tr>
<tr><td>9</td><td><span class="tl tag">P3</span></td><td>api/utils/cache.py ETagMiddleware</td><td>Ajoute Cache-Control mais pas de 304 conditionnel auto.</td><td>2h</td></tr>
<tr><td>10</td><td><span class="tl tag">P3</span></td><td>api/main.py</td><td>persistAuthorization non configurÃ© â€” Swagger UI perd le token au page reload.</td><td>15min</td></tr>
<tr><td>11</td><td><span class="tl tag">P3</span></td><td>services/core/observability/spans.py</td><td>278 LOC de framework tracing jamais invoquÃ©. Garder si OpenTelemetry prÃ©vu sinon supprimer.</td><td>30min</td></tr>
<tr><td>12</td><td><span class="tl tag">P3</span></td><td>ui/views/notifications.py</td><td>8 inline style= blocks, 0 tokens â€” bypass complet du design system.</td><td>2h</td></tr>
</table>
</section>

<!-- ========== INNOVATIONS ========== -->
<section id="innovations">
<h2>ğŸ’¡ AmÃ©liorations innovantes â€” Prochaines Ã©tapes</h2>

<h4>âœ… Innovations v3 implÃ©mentÃ©es avec succÃ¨s</h4>
<div class="card" style="border-left:4px solid var(--green);">
<ul>
<li>âœ… <strong>st.write_stream()</strong> â€” 3 services IA avec streaming natif</li>
<li>âœ… <strong>@st.dialog</strong> â€” Migration prÃ©parÃ©e, Modale deprecated</li>
<li>âœ… <strong>@auto_refresh</strong> â€” 7 dashboards avec refresh automatique</li>
<li>âœ… <strong>Deep linking URL</strong> â€” tabs_with_url() dans 10 modules</li>
<li>âœ… <strong>Chat IA contextuel</strong> â€” 6 intÃ©grations avec prompts context-aware</li>
<li>âœ… <strong>@cached_fragment + @lazy</strong> â€” Adoption lancÃ©e (6 + 3 usages)</li>
<li>âœ… <strong>Sentry + JSON logging + CI/CD</strong> â€” Production hardening complet</li>
<li>âœ… <strong>PWA Service Worker</strong> â€” Push, IndexedDB, background sync, offline</li>
</ul>
</div>

<h4>Nouvelles opportunitÃ©s v4</h4>
<div class="ig">

<div class="ic" style="border-left-color:var(--green);">
<h4>1. ğŸŒ™ Dark Mode â€” migration Sem finale</h4>
<p>L'infrastructure est 100% en place. Migrer les 10-13 fichiers restants de <code>Couleur.XXX</code> / hex hardcodÃ©s vers <code>var(--sem-*)</code>. Focus : atoms.py (badge, carte_metrique, boite_info), tablet/styles.py (2 hex), fragments.py (#f0f0f0).</p>
<div class="im"><span>Impact :</span> UX +++++. 95% du travail est dÃ©jÃ  fait â€” ROI exceptionnel.</div>
</div>

<div class="ic" style="border-left-color:var(--green);">
<h4>2. ğŸ“¡ Cache invalidation â€” 7 subscribers</h4>
<p>27 Ã©vÃ©nements Ã©mis mais 7 domaines sans subscriber cache. Ajouter 7 handlers dans <code>subscribers.py</code> utilisant le mÃªme pattern que <code>_invalider_cache_recettes</code>.</p>
<div class="im"><span>Impact :</span> Performance ++++. Cache toujours frais. Effort : ~2h.</div>
</div>

<div class="ic" style="border-left-color:var(--green);">
<h4>3. ğŸ’¾ @avec_cache dans maison/ et rapports/</h4>
<p>Les 5 services maison/ et 7 fichiers rapports/ ont <strong>0 dÃ©corateur @avec_cache</strong>. Chaque rerun Streamlit refait toutes les requÃªtes DB. Ajouter les caches sur les mÃ©thodes de lecture avec TTL 300s.</p>
<div class="im"><span>Impact :</span> Performance ++++. Quick win immÃ©diat. Effort : ~3h.</div>
</div>

<div class="ic" style="border-left-color:var(--accent);">
<h4>4. ğŸ§© @cached_fragment Ã©tendu</h4>
<p>6 usages actuels. Ã‰tendre aux graphiques Plotly lourds dans cuisine/, aux tableaux de donnÃ©es maison/, et aux dashboards accueil/. Combinerait cache + fragment partiel pour rÃ©duction de 60-80% des re-rendus.</p>
<div class="im"><span>Impact :</span> Performance ++++. Effort : ~2h par module.</div>
</div>

<div class="ic" style="border-left-color:var(--accent);">
<h4>5. ğŸ”— tabs_with_url() complet</h4>
<p>10 modules adoptent dÃ©jÃ  le deep linking URL. Ã‰tendre Ã  maison/ (entretien, charges, jardin) et parametres/ pour des URLs partageables partout.</p>
<div class="im"><span>Impact :</span> UX +++. Liens directs vers du contenu spÃ©cifique. Effort : ~1h.</div>
</div>

<div class="ic" style="border-left-color:var(--purple);">
<h4>6. ğŸ›¡ï¸ @avec_resilience complet</h4>
<p>9/12 appels HTTP protÃ©gÃ©s. Ajouter sur images/generator.py (6 appels), calendrier/service.py et google_calendar.py (httpx). Utilise les politiques composables du core/resilience/.</p>
<div class="im"><span>Impact :</span> Robustesse +++. Effort : ~2h.</div>
</div>

<div class="ic" style="border-left-color:var(--purple);">
<h4>7. ğŸ§ª Tests coverage 80%+</h4>
<p>Coverage core/ ~75%. RÃ©soudre 322 tests skippÃ©s (modules maison non implÃ©mentÃ©s) en implÃ©mentant les stubs ou en supprimant les tests fantÃ´mes. Cible : 80%+ sur core/ et services/.</p>
<div class="im"><span>Impact :</span> FiabilitÃ© ++++. Effort : 10-15h.</div>
</div>

<div class="ic" style="border-left-color:var(--cyan);">
<h4>8. â™¿ Skip-link + ARIA landmarks</h4>
<p>Le CSS skip-link est injectÃ© mais aucun Ã©lÃ©ment <code>&lt;a class="skip-link"&gt;</code> rendu. Ajouter skip-link fonctionnel + <code>A11y.landmark()</code> sur les sections principales pour conformitÃ© WCAG 2.1 AA.</p>
<div class="im"><span>Impact :</span> AccessibilitÃ© +++. ConformitÃ© WCAG.</div>
</div>

<div class="ic" style="border-left-color:var(--cyan);">
<h4>9. ğŸ“Š BaseService[T] adoption Ã©tendue</h4>
<p>7/~40 services hÃ©ritent de BaseService[T] (jeux migrÃ© en v4). Ã‰tendre aux services famille/ et maison/ standalone pour bÃ©nÃ©ficier du CRUD gÃ©nÃ©rique, rÃ©duire le boilerplate et standardiser les patterns.</p>
<div class="im"><span>Impact :</span> Architecture +++, DX ++. Effort : ~4h.</div>
</div>

<div class="ic" style="border-left-color:var(--cyan);">
<h4>10. ğŸ—‘ï¸ Nettoyage rÃ©siduel</h4>
<p>Supprimer <code>observability/spans.py</code> (278 LOC, 0 caller), configurer <code>persistAuthorization</code> Swagger (15min), supprimer <code>afficher_invite_installation_pwa()</code> deprecated, ajouter <code>[tool.bandit]</code> dans pyproject.toml.</p>
<div class="im"><span>Impact :</span> HygiÃ¨ne du code ++. Effort : ~1h total.</div>
</div>

</div>
</section>

<!-- ========== ROADMAP v4 ========== -->
<section id="roadmap">
<h2>ğŸ—ºï¸ Roadmap v4 â€” 3 phases, 12 semaines</h2>

<div class="tl2">

<div class="ti2 done">
<h4><span class="tf tag">Phases 1-8 âœ…</span> v1â†’v2â†’v3â†’v4â†’Phase 8 â€” <strong>TERMINÃ‰ES</strong></h4>
<p>Architecture complÃ¨te rÃ©alisÃ©e. 8 patterns dead code supprimÃ©s (~6K LOC), 18 N+1 corrigÃ©s, 115 error_boundary, 32/32 profiler_rerun, Sentry, CI/CD, PWA, structured logging, @cached_fragment, @lazy, deep linking, chat IA contextuel. <strong>Phase 8</strong>: cache maison/rapports dÃ©jÃ  en place, 11 subscribers cache actifs, @cached_fragment Ã©tendu aux graphiques Plotly planning. Score global 7.9 â†’ 8.3 â†’ 8.5 â†’ <strong>8.8/10</strong>.</p>
</div>

<div class="ti2 p2">
<h4><span class="th tag">Phase 9</span> Design System &amp; Robustesse â€” Semaines 5-8</h4>
<p>Finaliser le dark mode et combler les gaps de resilience.</p>
<ul>
<li>ğŸŸ¡ <strong>Migration Sem complÃ¨te</strong> â€” atoms.py, tablet/styles.py, fragments.py, views/notifications.py (10-13 fichiers)</li>
<li>ğŸŸ¡ <strong>@avec_resilience</strong> sur images/generator.py (6 HTTP), calendrier + google_calendar (httpx)</li>
<li>ğŸŸ¡ <strong>tabs_with_url()</strong> dans maison/ (entretien, charges, jardin) et parametres/</li>
<li>ğŸŸ¢ <strong>Skip-link fonctionnel</strong> + A11y.landmark() dans les sections principales</li>
<li>ğŸŸ¢ <strong>Nettoyage</strong> : spans.py dead code, persistAuthorization, deprecated PWA invite</li>
</ul>
</div>

<div class="ti2 p3">
<h4><span class="tm tag">Phase 10</span> Tests &amp; ScalabilitÃ© â€” Semaines 9-12</h4>
<p>Consolider la base de tests et prÃ©parer la scalabilitÃ©.</p>
<ul>
<li>ğŸŸ¢ <strong>Tests coverage 80%+</strong> sur core/ et services/ â€” rÃ©soudre 322 skipped</li>
<li>ğŸŸ¢ <strong>BaseService[T]</strong> Ã©tendu aux services famille/ et maison/ standalone</li>
<li>ğŸŸ¢ <strong>Redis activÃ© en production</strong> (REDIS_URL) â€” L1/L2/L3 + rate limiting distribuÃ©</li>
<li>ğŸŸ¢ <strong>ETagMiddleware 304 complet</strong> ou suppression du shell</li>
<li>ğŸŸ¢ <strong>Circuit breaker async fix</strong> â€” await coroutine dans appeler()</li>
</ul>
</div>

</div>

<h3>RÃ©capitulatif historique complet</h3>
<table>
<tr><th>Phase</th><th>Focus</th><th>Statut</th><th>Impact principal</th></tr>
<tr><td><span class="tf tag">v1 (7.9)</span></td><td>Foundation</td><td>âœ…</td><td>Architecture initiale, tests (~2 300), Streamlit app</td></tr>
<tr><td><span class="tf tag">v2 (8.3)</span></td><td>Maturation</td><td>âœ…</td><td>Config, validation, decorators, UI components, 35 endpoints</td></tr>
<tr><td><span class="tf tag">v3 (8.5)</span></td><td>Robustesse & nettoyage</td><td>âœ…</td><td>Dead code -6K LOC, 111 error_boundary, 18 N+1, navigation native</td></tr>
<tr><td><span class="tf tag">v4 (8.7)</span></td><td>Production & Innovation</td><td>âœ…</td><td>Sentry, CI/CD, PWA, structured logs, @cached_fragment, deep linking, chat IA</td></tr>
<tr><td><span class="tf tag">Phase 8 (8.8)</span></td><td>Performance & Cache</td><td>âœ…</td><td>Cache maison/rapports OK, 11 subscribers, @cached_fragment Plotly planning</td></tr>
<tr><td><span class="th tag">Phase 9</span></td><td>Design System & Robustesse</td><td>Ã€ faire</td><td>Dark mode complet (Sem 100%), @avec_resilience, a11y</td></tr>
<tr><td><span class="tm tag">Phase 10</span></td><td>Tests & ScalabilitÃ©</td><td>Ã€ faire</td><td>Coverage 80%+, BaseService[T], Redis, ETag</td></tr>
</table>

<h3>ğŸ“Š MÃ©triques projet â€” Ã©tat v4</h3>
<table>
<tr><th>MÃ©trique</th><th>v3</th><th>v4</th><th>Objectif</th><th>Status</th></tr>
<tr><td>Tests collectÃ©s</td><td>8 072</td><td><strong>8 150</strong></td><td>â€”</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Tests passÃ©s</td><td>7 736</td><td><strong>7 814</strong></td><td>100%</td><td><span class="tm tag">95.9%</span></td></tr>
<tr><td>Tests en Ã©chec</td><td>13</td><td><strong>13</strong></td><td>0</td><td><span class="tm tag">pre-existing mocks</span></td></tr>
<tr><td>Tests skippÃ©s</td><td>322</td><td><strong>322</strong></td><td>0</td><td><span class="tm tag">modules manquants</span></td></tr>
<tr><td>Lint (ruff)</td><td>0</td><td><strong>0</strong></td><td>0</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Temps dÃ©marrage</td><td>~1.5s</td><td><strong>~1.5s</strong></td><td>&lt;1.5s</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>N+1 corrigÃ©s</td><td>18</td><td><strong>18/18</strong></td><td>0 N+1</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Coverage core/</td><td>~70%</td><td><strong>~75%</strong></td><td>80%</td><td><span class="tm tag">ğŸŸ¡ En cours</span></td></tr>
<tr><td>@profiler_rerun</td><td>28/32</td><td><strong>32/32</strong></td><td>100%</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>error_boundary</td><td>111 blocs</td><td><strong>115 blocs</strong></td><td>100% modules</td><td><span class="tf tag">âœ…</span></td></tr>
<tr><td>Sem tokens adoption</td><td>3/61 (4.9%)</td><td><strong>5/62 (8.1%)</strong></td><td>100%</td><td><span class="th tag">ğŸ”´ Faible</span></td></tr>
<tr><td>Dead code rÃ©siduel</td><td>~1 379 LOC</td><td><strong>~278 LOC</strong></td><td>0</td><td><span class="tm tag">spans.py</span></td></tr>
</table>
</section>

<!-- ========== FOOTER ========== -->
<hr>
<p style="text-align:center;color:var(--text-muted);font-size:.83rem;padding:2rem 0;">
  Rapport d'audit v4.1 â€” 24 fÃ©vrier 2026 &bull; Assistant Matanne &bull; ~560 fichiers analysÃ©s, ~97 000 lignes de code<br>
  <em>Score global : <strong>8.8/10</strong> (v1 : 7.9 â†’ v2 : 8.3 â†’ v3 : 8.5 â†’ v4 : 8.7 â†’ Phase 8 : 8.8) â€” progression continue et solide.<br>
  <strong>Phase 8 complÃ©tÃ©e</strong> : @avec_cache maison/rapports dÃ©jÃ  en place, 11 subscribers cache actifs, @cached_fragment Ã©tendu aux graphiques Plotly.<br>
  Prochaine Ã©tape Phase 9 : migration Sem 100%, @avec_resilience sur HTTP externes, tabs_with_url().<br>
  Objectif v5 : 9.0/10 â€” dark mode complet, tests 80%+, Redis production, BaseService[T] Ã©tendu.</em>
</p>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const sections = document.querySelectorAll('section[id], div[id]');
  const navLinks = document.querySelectorAll('.sidebar nav a[href^="#"]');
  const observer = new IntersectionObserver(entries => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        navLinks.forEach(l => l.style.background = '');
        const active = document.querySelector(`.sidebar nav a[href="#${entry.target.id}"]`);
        if (active) active.style.background = 'rgba(59,130,246,.15)';
      }
    });
  }, { rootMargin: '-20% 0px -70% 0px' });
  sections.forEach(s => observer.observe(s));
});
</script>
</body>
</html>
