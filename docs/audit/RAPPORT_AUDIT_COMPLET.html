<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport d'Audit Complet ‚Äî Assistant Matanne v7</title>
    <style>
        :root {
            --bg: #0d1117;
            --surface: #161b22;
            --surface2: #1c2333;
            --border: #30363d;
            --text: #e6edf3;
            --text-muted: #8b949e;
            --accent: #58a6ff;
            --green: #3fb950;
            --red: #f85149;
            --orange: #d29922;
            --purple: #bc8cff;
            --pink: #f778ba;
            --cyan: #39d2c0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            padding: 0;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 2rem; }

        /* Header */
        .hero {
            background: linear-gradient(135deg, #1a1e2e 0%, #0d1117 50%, #1a1532 100%);
            border-bottom: 1px solid var(--border);
            padding: 3rem 2rem;
            text-align: center;
        }
        .hero h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem; background: linear-gradient(90deg, var(--accent), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero .subtitle { color: var(--text-muted); font-size: 1.1rem; }
        .hero .date { color: var(--accent); font-size: 0.9rem; margin-top: 0.5rem; }

        /* Summary Cards */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .summary-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.2rem;
            text-align: center;
        }
        .summary-card .value { font-size: 2rem; font-weight: 800; color: var(--accent); }
        .summary-card .label { font-size: 0.8rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }

        /* TOC */
        .toc {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem 2rem;
            margin: 2rem 0;
        }
        .toc h2 { font-size: 1.2rem; margin-bottom: 1rem; color: var(--accent); }
        .toc ol { padding-left: 1.5rem; columns: 2; }
        .toc li { margin-bottom: 0.3rem; }
        .toc a { color: var(--text); text-decoration: none; }
        .toc a:hover { color: var(--accent); text-decoration: underline; }

        /* Sections */
        section { margin: 3rem 0; }
        h2 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text);
            border-bottom: 2px solid var(--accent);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        h3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--purple);
            margin: 1.5rem 0 0.8rem;
        }
        h4 {
            font-size: 1.05rem;
            font-weight: 600;
            color: var(--cyan);
            margin: 1rem 0 0.5rem;
        }

        p { margin-bottom: 0.8rem; }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            font-size: 0.9rem;
        }
        th {
            background: var(--surface2);
            color: var(--accent);
            font-weight: 600;
            text-align: left;
            padding: 0.6rem 0.8rem;
            border: 1px solid var(--border);
            position: sticky;
            top: 0;
        }
        td {
            padding: 0.5rem 0.8rem;
            border: 1px solid var(--border);
            vertical-align: top;
        }
        tr:nth-child(even) { background: var(--surface); }
        tr:hover { background: rgba(88, 166, 255, 0.05); }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.15rem 0.6rem;
            border-radius: 99px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-green { background: rgba(63,185,80,0.15); color: var(--green); }
        .badge-red { background: rgba(248,81,73,0.15); color: var(--red); }
        .badge-orange { background: rgba(210,153,34,0.15); color: var(--orange); }
        .badge-blue { background: rgba(88,166,255,0.15); color: var(--accent); }
        .badge-purple { background: rgba(188,140,255,0.15); color: var(--purple); }

        /* Alert boxes */
        .alert {
            border-radius: 8px;
            padding: 1rem 1.2rem;
            margin: 1rem 0;
            border-left: 4px solid;
        }
        .alert-critical { background: rgba(248,81,73,0.08); border-color: var(--red); }
        .alert-warning { background: rgba(210,153,34,0.08); border-color: var(--orange); }
        .alert-info { background: rgba(88,166,255,0.08); border-color: var(--accent); }
        .alert-success { background: rgba(63,185,80,0.08); border-color: var(--green); }
        .alert strong { display: block; margin-bottom: 0.3rem; }

        /* Progress bars */
        .progress-bar {
            background: var(--surface2);
            border-radius: 99px;
            height: 8px;
            overflow: hidden;
            margin: 0.3rem 0;
        }
        .progress-fill {
            height: 100%;
            border-radius: 99px;
            transition: width 0.3s;
        }

        /* Code */
        code {
            background: var(--surface2);
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.85em;
            color: var(--pink);
        }

        /* Lists */
        ul, ol { padding-left: 1.5rem; margin: 0.5rem 0; }
        li { margin-bottom: 0.3rem; }

        /* Collapsible sections */
        details {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin: 1rem 0;
            overflow: hidden;
        }
        details summary {
            padding: 0.8rem 1.2rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--text);
            user-select: none;
        }
        details summary:hover { background: var(--surface2); }
        details[open] summary { border-bottom: 1px solid var(--border); }
        details .content { padding: 1rem 1.2rem; }

        /* Grid layouts */
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        .three-col { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; }

        @media (max-width: 768px) {
            .two-col, .three-col { grid-template-columns: 1fr; }
            .toc ol { columns: 1; }
            .hero h1 { font-size: 1.8rem; }
        }

        /* Print */
        @media print {
            body { background: white; color: black; }
            .hero { background: white; border: none; }
            .hero h1 { -webkit-text-fill-color: #1a56db; }
            th { background: #f3f4f6; }
            .alert { border-left-width: 3px; }
            details { break-inside: avoid; }
        }

        .score-ring {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            font-size: 1.3rem;
            font-weight: 800;
        }

        .adoption-cell { text-align: center; }
        .check { color: var(--green); }
        .cross { color: var(--red); }
    </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="hero">
    <h1>üîç Rapport d'Audit Complet</h1>
    <div class="subtitle">Assistant Matanne ‚Äî Analyse exhaustive du codebase vs ROADMAP v7</div>
    <div class="date">G√©n√©r√© le 26 f√©vrier 2026 &bull; ROADMAP v7 (derni√®re mise √† jour : 26 f√©vrier 2026)</div>
</div>

<div class="container">

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXECUTIVE SUMMARY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="executive">
<h2>0. R√©sum√© ex√©cutif</h2>

<div class="summary-grid">
    <div class="summary-card">
        <div class="value">627</div>
        <div class="label">Fichiers .py</div>
    </div>
    <div class="summary-card">
        <div class="value">~110k</div>
        <div class="label">Lignes de code</div>
    </div>
    <div class="summary-card">
        <div class="value">84</div>
        <div class="label">Mod√®les ORM</div>
    </div>
    <div class="summary-card">
        <div class="value">64</div>
        <div class="label">Services</div>
    </div>
    <div class="summary-card">
        <div class="value">95</div>
        <div class="label">Tables SQL</div>
    </div>
    <div class="summary-card">
        <div class="value">8 150</div>
        <div class="label">Tests collect√©s</div>
    </div>
    <div class="summary-card">
        <div class="value">31</div>
        <div class="label">Modules navigu√©s</div>
    </div>
    <div class="summary-card">
        <div class="value">22</div>
        <div class="label">Composants UI enregistr√©s</div>
    </div>
</div>

<div class="two-col">
<div>
<h3>R√©partition du code</h3>
<table>
    <tr><th>R√©pertoire</th><th>Fichiers</th><th>LOC</th><th>%</th></tr>
    <tr><td><code>src/services/</code></td><td>210</td><td>41 505</td><td>37.5%</td></tr>
    <tr><td><code>src/modules/</code></td><td>217</td><td>41 945</td><td>37.8%</td></tr>
    <tr><td><code>src/core/</code></td><td>93</td><td>14 329</td><td>12.9%</td></tr>
    <tr><td><code>src/ui/</code></td><td>72</td><td>12 492</td><td>11.3%</td></tr>
    <tr><td><code>src/api/</code></td><td>35</td><td>3 311</td><td>3.0%</td></tr>
    <tr><td><code>src/app.py</code></td><td>1</td><td>221</td><td>0.2%</td></tr>
    <tr><td><strong>TOTAL</strong></td><td><strong>627*</strong></td><td><strong>~113 803</strong></td><td></td></tr>
</table>
<p style="font-size:0.8rem;color:var(--text-muted)">* Hors __pycache__, tests, docs</p>
</div>
<div>
<h3>Sant√© globale</h3>
<table>
    <tr><th>Crit√®re</th><th>Note</th><th>Commentaire</th></tr>
    <tr><td>Architecture</td><td><span class="badge badge-green">A</span></td><td>4 couches bien s√©par√©es, registre singleton, event bus</td></tr>
    <tr><td>Patterns</td><td><span class="badge badge-green">A-</span></td><td>8 dead patterns √©limin√©s, adoption &gt;90% sur @service_factory</td></tr>
    <tr><td>S√©curit√©</td><td><span class="badge badge-orange">B</span></td><td>JWT corrig√©, OWASP headers, mais 3 bugs API inventaire</td></tr>
    <tr><td>Tests</td><td><span class="badge badge-green">A-</span></td><td>8 045 passed/8 150, couverture in√©gale par module</td></tr>
    <tr><td>Performance</td><td><span class="badge badge-green">A</span></td><td>Lazy loading, cache multi-niveaux+Redis, 18 N+1 corrig√©s</td></tr>
    <tr><td>UI/UX</td><td><span class="badge badge-green">A-</span></td><td>Token system 3-tier, a11y, mais ~30% composants d√©cor√©s</td></tr>
    <tr><td>Dead Code</td><td><span class="badge badge-orange">B+</span></td><td>~6 000 LOC patterns supprim√©s, ~2 500 LOC dead restant</td></tr>
    <tr><td>Documentation</td><td><span class="badge badge-orange">B</span></td><td>Bonne couverture, mais r√©f√©rences obsol√®tes dans copilot-instructions</td></tr>
</table>
</div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABLE OF CONTENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav class="toc">
<h2>üìë Table des mati√®res</h2>
<ol>
    <li><a href="#app">app.py ‚Äî Point d'entr√©e (221 LOC)</a></li>
    <li><a href="#core">src/core/ ‚Äî Noyau applicatif (93 fichiers, 14 329 LOC)</a></li>
    <li><a href="#api">src/api/ ‚Äî API FastAPI (35 fichiers, 3 311 LOC)</a></li>
    <li><a href="#modules">src/modules/ ‚Äî Modules m√©tier (217 fichiers, 41 945 LOC)</a></li>
    <li><a href="#services">src/services/ ‚Äî Couche services (210 fichiers, 41 505 LOC)</a></li>
    <li><a href="#ui">src/ui/ ‚Äî Couche pr√©sentation (72 fichiers, 12 492 LOC)</a></li>
    <li><a href="#roadmap">Comparaison ROADMAP v7</a></li>
    <li><a href="#completeness">√âvaluation de compl√©tude</a></li>
    <li><a href="#innovations">Am√©liorations innovantes Streamlit</a></li>
    <li><a href="#concepts">V√©rification des concepts</a></li>
    <li><a href="#recommendations">Recommandations prioritaires</a></li>
</ol>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 1. APP.PY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="app">
<h2>1. app.py ‚Äî Point d'entr√©e (221 LOC)</h2>

<p>Le fichier <code>app.py</code> a consid√©rablement √©volu√© de 139 LOC (v6) √† 221 LOC (v7), int√©grant les widgets globaux Phase D.</p>

<h3>Architecture du bootstrap</h3>
<table>
    <tr><th>Phase</th><th>Lignes</th><th>Description</th></tr>
    <tr><td>1. Environment</td><td>1-25</td><td>Chargement <code>.env.local</code>, logging, <code>sys.path</code></td></tr>
    <tr><td>2. Bootstrap</td><td>26-50</td><td><code>bootstrap()</code>, <code>st.set_page_config()</code>, meta PWA</td></tr>
    <tr><td>3. Raccourcis</td><td>51-80</td><td>Raccourcis clavier JS + mode focus toggle</td></tr>
    <tr><td>4. Navigation</td><td>81-120</td><td><code>st.navigation(construire_pages())</code></td></tr>
    <tr><td>5. Main</td><td>121-170</td><td><code>@profiler_rerun</code>, error boundary, <code>page.run()</code></td></tr>
    <tr><td>6. Widgets globaux</td><td>171-221</td><td><strong>NOUVEAU</strong> : Chat IA global, notifications live, gamification</td></tr>
</table>

<h3>Nouveaut√©s v7</h3>
<ul>
    <li><strong>Widgets globaux Phase D</strong> : <code>_afficher_widgets_globaux()</code> charge paresseusement chat global, notifications live, et gamification sidebar</li>
    <li><strong>Mode focus</strong> : <code>is_mode_focus()</code> masque header/footer si activ√©</li>
    <li><strong>Banni√®re maintenance</strong> : Si <code>MAINTENANCE_MODE=true</code>, affiche banni√®re et return early</li>
    <li><strong>Page timing</strong> : Warning si <code>page.run()</code> d√©passe 2 secondes</li>
    <li><strong>@profiler_rerun</strong> : D√©cor√© sur <code>main()</code></li>
</ul>

<div class="alert alert-info">
    <strong>üí° Bonne pratique</strong>
    Tous les imports de modules sont dans les fonctions (lazy loading pr√©serv√©). Le d√©marrage reste rapide (~1.5s).
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 2. CORE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="core">
<h2>2. src/core/ ‚Äî Noyau applicatif (93 fichiers, 14 329 LOC)</h2>

<h3>2.1 Inventaire des sous-packages</h3>
<table>
    <tr><th>Package</th><th>Fichiers</th><th>LOC</th><th>R√¥le</th></tr>
    <tr><td><code>models/</code></td><td>22</td><td>3 891</td><td>84 mod√®les ORM SQLAlchemy 2.0 (<code>Mapped</code>, <code>mapped_column</code>)</td></tr>
    <tr><td><code>caching/</code></td><td>9</td><td>1 877</td><td>Cache multi-niveaux L1‚ÜíL2‚ÜíL3‚ÜíRedis + orchestrateur</td></tr>
    <tr><td><code>validation/</code></td><td>12</td><td>1 659</td><td>Schemas Pydantic v2, sanitizer anti-XSS, validators</td></tr>
    <tr><td><code>ai/</code></td><td>7</td><td>1 580</td><td>ClientIA Mistral, rate limiting, cache s√©mantique, circuit breaker</td></tr>
    <tr><td><code>config/</code></td><td>5</td><td>1 120</td><td>Pydantic BaseSettings, loader .env, validator</td></tr>
    <tr><td><code>db/</code></td><td>6</td><td>980</td><td>Engine SQLAlchemy, sessions, migrations SQL-file</td></tr>
    <tr><td><code>decorators/</code></td><td>7</td><td>945</td><td>@avec_session_db, @avec_cache, @avec_gestion_erreurs, etc.</td></tr>
    <tr><td><code>state/</code></td><td>5</td><td>670</td><td>GestionnaireEtat, slices, naviguer(), revenir()</td></tr>
    <tr><td><code>monitoring/</code></td><td>6</td><td>590</td><td>M√©triques, Sentry, rerun_profiler, health</td></tr>
    <tr><td><code>date_utils/</code></td><td>6</td><td>520</td><td>Semaines, p√©riodes, formatage, helpers</td></tr>
    <tr><td><code>resilience/</code></td><td>2</td><td>350</td><td>Policies composables (executer() retourne T directement)</td></tr>
    <tr><td><code>observability/</code></td><td>2</td><td>147</td><td>Contexte d'observabilit√©</td></tr>
</table>

<h3>2.2 Mod√®les ORM (84 classes, 22 fichiers)</h3>
<details>
<summary>R√©partition par domaine (84 mod√®les)</summary>
<div class="content">
<table>
    <tr><th>Fichier</th><th>Classes</th><th>Tables</th></tr>
    <tr><td>recettes.py</td><td>Recette, IngredientRecette, Planning, PlanRepas, RecettePlanRepas, NoteRecette, RetourRecette, EtiquetteRecette, FavoriRecette</td><td>9</td></tr>
    <tr><td>users.py</td><td>ProfilUtilisateur, TokenGarmin, ActiviteGarmin, ResumeQuotidienGarmin, JournalAlimentaire, ActiviteWeekend, AchatFamille</td><td>7</td></tr>
    <tr><td>maison.py</td><td>Meuble, Piece, ScoreHabitat, TacheEntretien, ChargesMaison, ProjetMaison, TacheProjet, EcoTip, ObjectifEnergetique</td><td>9</td></tr>
    <tr><td>jeux.py</td><td>GrilleLoto, PariSportif, Match, Equipe, Championnat, PronosticIA, TransactionBankroll, NotificationJeux, SerieStats</td><td>9</td></tr>
    <tr><td>famille.py</td><td>ActiviteFamille, Routine, BudgetFamille, CategorieBudget</td><td>4</td></tr>
    <tr><td>sante.py</td><td>MetriqueSante, EntreeSante, ObjectifSante</td><td>3</td></tr>
    <tr><td>calendrier.py</td><td>EvenementCalendrier, ConfigCalendrierExterne, JournalSyncCalendrier</td><td>3</td></tr>
    <tr><td>inventaire.py</td><td>ArticleInventaire, ArticleCourses, SessionBatchCooking, RecetteBatchCooking</td><td>4</td></tr>
    <tr><td>jardin.py</td><td>Plante, Recolte, TacheJardin, ZoneJardin</td><td>4</td></tr>
    <tr><td>habitat.py</td><td>PieceHabitat, EquipementPiece, AmeliorationHabitat, DiagnosticHabitat</td><td>4</td></tr>
    <tr><td>temps_entretien.py</td><td>TempsEntretien, StatistiquesEntretien</td><td>2</td></tr>
    <tr><td>notifications.py</td><td>Notification, AbonnementPush, PreferenceNotification, NotificationEnvoyee</td><td>4</td></tr>
    <tr><td>preferences.py</td><td>PreferenceUtilisateur</td><td>1</td></tr>
    <tr><td>backup.py</td><td>SauvegardeConfig, HistoriqueSauvegarde</td><td>2</td></tr>
    <tr><td>actions.py</td><td>ActionUtilisateur</td><td>1</td></tr>
    <tr><td>gamification.py</td><td>BadgeUtilisateur, PointsActivite, Defi</td><td>3</td></tr>
    <tr><td>energie.py</td><td>ConsommationEnergie, FactureEnergie, ObjectifEnergie</td><td>3</td></tr>
    <tr><td>mixins.py</td><td>CreeLeMixin, TimestampMixin, CreatedAtMixin, TimestampFullMixin</td><td>‚Äî</td></tr>
    <tr><td>base.py</td><td>Base (DeclarativeBase)</td><td>‚Äî</td></tr>
    <tr><td>__init__.py</td><td>Re-exports</td><td>‚Äî</td></tr>
    <tr><td colspan="2"><strong>TOTAL</strong></td><td><strong>~84 tables</strong></td></tr>
</table>
</div>
</details>

<h3>2.3 Adoption des d√©corateurs</h3>
<p style="font-size:0.8rem;color:var(--text-muted)">Comptage automatis√© le 25 f√©vrier 2026 via <code>Select-String -Pattern "@decorator"</code> sur <code>src/**/*.py</code></p>
<table>
    <tr><th>D√©corateur</th><th>Occurrences</th><th>Œî&nbsp;vs&nbsp;pr√©c√©dent</th><th>Statut</th></tr>
    <tr><td><code>@avec_session_db</code></td><td>293</td><td style="color:var(--green)">+23</td><td><span class="badge badge-green">Tr√®s adopt√©</span></td></tr>
    <tr><td><code>@avec_gestion_erreurs</code></td><td>183</td><td style="color:var(--green)">+1</td><td><span class="badge badge-green">Tr√®s adopt√©</span></td></tr>
    <tr><td><code>@avec_cache</code></td><td>118</td><td style="color:var(--green)">+12</td><td><span class="badge badge-green">Bien adopt√©</span></td></tr>
    <tr><td><code>@service_factory</code></td><td>59</td><td style="color:var(--text-muted)">=</td><td><span class="badge badge-green">Complet</span></td></tr>
    <tr><td><code>@profiler_rerun</code></td><td>43</td><td style="color:var(--green)">+21</td><td><span class="badge badge-green">Tr√®s adopt√©</span></td></tr>
    <tr><td><code>@avec_resilience</code></td><td>24</td><td style="color:var(--text-muted)">=</td><td><span class="badge badge-blue">Cibl√© HTTP</span></td></tr>
    <tr><td><code>@chronometre</code></td><td>11</td><td style="color:var(--green)">+1</td><td><span class="badge badge-blue">Cibl√© perf</span></td></tr>
    <tr><td><code>@avec_validation</code></td><td>4</td><td style="color:var(--text-muted)">=</td><td><span class="badge badge-orange">Faible</span></td></tr>
    <tr><td><code>@persistent_state</code></td><td>4</td><td style="color:var(--green)">+1</td><td><span class="badge badge-orange">Faible</span></td></tr>
    <tr><td><code>@avec_circuit_breaker</code></td><td>0</td><td style="color:var(--text-muted)">=</td><td><span class="badge badge-red">Dead code</span></td></tr>
    <tr style="background:var(--surface2);font-weight:600"><td>TOTAL</td><td>739</td><td style="color:var(--green)">+59</td><td></td></tr>
</table>

<div class="alert alert-info">
    <strong>üí° √âvolutions notables v7</strong>
    <ul>
        <li><code>@profiler_rerun</code> : +21 occurrences (22‚Üí43), d√©sormais d√©ploy√© sur <strong>tous les modules app()</strong> ‚Äî promu de "Bien adopt√©" √† "Tr√®s adopt√©"</li>
        <li><code>@avec_session_db</code> : +23 (270‚Üí293), nouveaux services CRUD (d√©penses, s√©ries, budget, gamification)</li>
        <li><code>@avec_cache</code> : +12 (106‚Üí118), extension aux services m√©t√©o, calendrier, suggestions</li>
        <li><code>@avec_circuit_breaker</code> : reste dead code (0 callers r√©els, 2 mentions docstring) ‚Äî <strong>√† supprimer</strong></li>
        <li><code>@avec_validation</code> : stagne √† 1 usage r√©el (+ 3 docstrings) ‚Äî <strong>sous-exploit√©</strong></li>
    </ul>
</div>

<h3>2.4 Mixin timestamps (adoption)</h3>
<table>
    <tr><th>Mixin</th><th>Usages</th><th>Statut</th></tr>
    <tr><td><code>CreeLeMixin</code></td><td>57</td><td><span class="badge badge-green">Principal</span></td></tr>
    <tr><td><code>TimestampMixin</code></td><td>43</td><td><span class="badge badge-green">Secondaire</span></td></tr>
    <tr><td><code>CreatedAtMixin</code></td><td>0</td><td><span class="badge badge-red">Dead ‚Äî alias EN</span></td></tr>
    <tr><td><code>TimestampFullMixin</code></td><td>0</td><td><span class="badge badge-red">Dead ‚Äî alias EN</span></td></tr>
</table>

<h3>2.5 Dead code identifi√© (~550 LOC)</h3>
<div class="alert alert-warning">
    <strong>‚ö†Ô∏è Code mort dans core/</strong>
    <ul>
        <li><code>logging.py</code> (281 LOC) ‚Äî module entier inutilis√© externement (tous les consommateurs utilisent <code>logging.getLogger()</code> directement)</li>
        <li><code>CreatedAtMixin</code> + <code>TimestampFullMixin</code> ‚Äî 0 usages, alias EN morts</li>
        <li><code>@avec_circuit_breaker</code> ‚Äî 0 callers (le circuit breaker est utilis√© via <code>CircuitBreaker</code> directement)</li>
        <li><code>valider_plage()</code> ‚Äî deprecated, 0 callers</li>
        <li><code>errors.py</code> ‚Äî re-exporte depuis <code>exceptions.py</code> mais 0 import direct</li>
    </ul>
</div>

<h3>2.6 Incoh√©rences de nommage</h3>
<table>
    <tr><th>Nom actuel (EN)</th><th>Correction propos√©e (FR)</th><th>Fichier</th></tr>
    <tr><td><code>format_week_label()</code></td><td><code>formater_label_semaine()</code></td><td>date_utils/</td></tr>
    <tr><td><code>get_weekday_*()</code></td><td><code>obtenir_jour_semaine_*()</code></td><td>date_utils/</td></tr>
    <tr><td><code>is_redis_available()</code></td><td><code>est_redis_disponible()</code></td><td>caching/redis.py</td></tr>
    <tr><td><code>Project</code> (class)</td><td><code>Projet</code></td><td>models/</td></tr>
</table>

<h3>2.7 D√©rives documentation</h3>
<div class="alert alert-warning">
    <strong>‚ö†Ô∏è .github/copilot-instructions.md d√©synchronis√©</strong>
    <ul>
        <li>R√©f√©rence <code>errors_base.py</code> (supprim√© ‚Üí renomm√© <code>exceptions.py</code>)</li>
        <li>Dit "19 fichiers" pour models (r√©el : 22 fichiers)</li>
        <li>Dit <code>errors.py</code> comme module primaire (r√©el : <code>exceptions.py</code> a 18 importateurs, <code>errors.py</code> a 0)</li>
    </ul>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 3. API ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="api">
<h2>3. src/api/ ‚Äî API FastAPI (35 fichiers, ~3 311 LOC source)</h2>

<h3>3.1 Architecture</h3>
<table>
    <tr><th>Composant</th><th>Fichiers</th><th>LOC</th></tr>
    <tr><td>Routes (endpoints)</td><td>7 routers + main.py</td><td>~1 200</td></tr>
    <tr><td>Schemas Pydantic</td><td>6</td><td>~600</td></tr>
    <tr><td>Auth + Security</td><td>4</td><td>~500</td></tr>
    <tr><td>Utils (CRUD, cache, etc.)</td><td>5</td><td>~400</td></tr>
    <tr><td>Rate Limiting</td><td>4</td><td>~350</td></tr>
    <tr><td>Dependencies</td><td>2</td><td>~150</td></tr>
    <tr><td>Tests</td><td>~18</td><td>~4 314</td></tr>
</table>

<h3>3.2 Endpoints (30 routes, 7 routers)</h3>
<table>
    <tr><th>Router</th><th>Routes</th><th>Auth</th><th>Rate Limit</th></tr>
    <tr><td>/api/recettes</td><td>5 (CRUD + search)</td><td>‚úÖ JWT</td><td>‚úÖ</td></tr>
    <tr><td>/api/planning</td><td>4 (CRUD + generate)</td><td>‚úÖ JWT</td><td>‚úÖ</td></tr>
    <tr><td>/api/courses</td><td>4 (CRUD + optimize)</td><td>‚úÖ JWT</td><td>‚úÖ</td></tr>
    <tr><td>/api/inventaire</td><td>5 (CRUD + alerts)</td><td>‚úÖ JWT</td><td>‚úÖ</td></tr>
    <tr><td>/api/suggestions</td><td>3 (suggest + feedback)</td><td>‚úÖ JWT</td><td>‚úÖ</td></tr>
    <tr><td>/api/push</td><td>4 (subscribe + send)</td><td>‚úÖ JWT</td><td>‚úÖ</td></tr>
    <tr><td>/api/famille</td><td>5 (family management)</td><td>‚úÖ JWT</td><td>‚úÖ</td></tr>
    <tr><td>Root</td><td>/health, /metrics, /docs</td><td>Mixte</td><td>‚Äî</td></tr>
</table>

<h3>3.3 Bugs confirm√©s</h3>
<div class="alert alert-critical">
    <strong>üêõ 3 BUGS CRITIQUES dans routes/inventaire.py</strong>
    <ol>
        <li><strong>InventaireItemCreate model mismatch</strong> ‚Äî POST set <code>nom</code> directement mais le mod√®le ORM <code>ArticleInventaire</code> utilise <code>ingredient_id</code> + relationship. L'article est cr√©√© avec <code>nom=None</code> en DB.</li>
        <li><strong>modifier_article_inventaire ignore nom/unite/categorie</strong> ‚Äî Le endpoint PATCH n'applique que <code>quantite</code>, <code>date_peremption</code>, <code>localisation</code>. Les champs <code>nom</code>, <code>unite</code>, <code>categorie</code> du payload sont silencieusement ignor√©s.</li>
        <li><strong>lister_inventaire s√©rialisation manuelle</strong> ‚Äî Construction manuelle d'un dict au lieu de <code>model_validate()</code>, bypassant les schemas Pydantic et risquant des incoh√©rences de format.</li>
    </ol>
</div>

<h3>3.4 S√©curit√©</h3>
<table>
    <tr><th>Mesure</th><th>Statut</th><th>D√©tail</th></tr>
    <tr><td>JWT signature verification</td><td><span class="badge badge-green">Corrig√© v7</span></td><td><code>verify_signature=False</code> ‚Üí <code>valider_token()</code></td></tr>
    <tr><td>OWASP Security Headers</td><td><span class="badge badge-green">Complet</span></td><td>X-Frame, HSTS, CSP, Permissions-Policy</td></tr>
    <tr><td>Rate limiting</td><td><span class="badge badge-orange">In-memory</span></td><td>Race condition en multi-worker (pas de Redis lock)</td></tr>
    <tr><td>/metrics protection</td><td><span class="badge badge-green">Corrig√© v7</span></td><td><code>require_role("admin")</code></td></tr>
    <tr><td>Error sanitization</td><td><span class="badge badge-green">Corrig√© v7</span></td><td>Messages g√©n√©riques en r√©ponse, logs d√©taill√©s internes</td></tr>
    <tr><td>ETag / 304</td><td><span class="badge badge-green">Complet</span></td><td>MD5 body hash, <code>If-None-Match</code> ‚Üí 304</td></tr>
    <tr><td>Supabase unsigned token</td><td><span class="badge badge-orange">Risque</span></td><td>Accept√© sans v√©rification si <code>SUPABASE_JWT_SECRET</code> non d√©fini</td></tr>
</table>

<h3>3.5 Dead code API</h3>
<ul>
    <li>Imports inutilis√©s : <code>time</code> (auth routes), <code>query_async</code> (courses), <code>datetime</code> (recette schemas), <code>timezone</code> (auth)</li>
    <li>Schemas inutilis√©s : <code>ErreurResponse</code>, <code>PaginationParams</code></li>
    <li>Push schemas inline au lieu de dans <code>schemas/</code></li>
</ul>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 4. MODULES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="modules">
<h2>4. src/modules/ ‚Äî Modules m√©tier (217 fichiers, 41 945 LOC)</h2>

<h3>4.1 R√©partition par domaine</h3>
<table>
    <tr><th>Domaine</th><th>Fichiers</th><th>LOC</th><th>%</th></tr>
    <tr><td>üè† maison/</td><td>63</td><td>12 213</td><td>29.1%</td></tr>
    <tr><td>üçΩÔ∏è cuisine/</td><td>50</td><td>9 543</td><td>22.7%</td></tr>
    <tr><td>üé∞ jeux/</td><td>28</td><td>4 754</td><td>11.3%</td></tr>
    <tr><td>üë®‚Äçüë©‚Äçüë¶ famille/</td><td>26</td><td>4 833</td><td>11.5%</td></tr>
    <tr><td>üîß utilitaires/</td><td>13</td><td>3 641</td><td>8.7%</td></tr>
    <tr><td>üìÖ planning/</td><td>13</td><td>3 053</td><td>7.3%</td></tr>
    <tr><td>‚öôÔ∏è _framework/</td><td>6</td><td>1 341</td><td>3.2%</td></tr>
    <tr><td>‚öôÔ∏è parametres/</td><td>9</td><td>1 267</td><td>3.0%</td></tr>
    <tr><td>üè† accueil/</td><td>7</td><td>1 037</td><td>2.5%</td></tr>
    <tr><td>üé® design_system</td><td>1</td><td>263</td><td>0.6%</td></tr>
</table>

<h3>4.2 Adoption des patterns (31 modules navigu√©s)</h3>
<table>
    <tr>
        <th>Pattern</th>
        <th>Adoption</th>
        <th>Barre</th>
        <th>Manquants</th>
    </tr>
    <tr>
        <td><code>@profiler_rerun</code></td>
        <td>97% (30/31)</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:97%;background:var(--green)"></div></div></td>
        <td>cockpit_familial</td>
    </tr>
    <tr>
        <td><code>error_boundary</code></td>
        <td>97% (30/31)</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:97%;background:var(--green)"></div></div></td>
        <td>cockpit_familial</td>
    </tr>
    <tr>
        <td><code>tabs_with_url</code></td>
        <td>68% (21/31)</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:68%;background:var(--orange)"></div></div></td>
        <td>10 modules</td>
    </tr>
    <tr>
        <td><code>KeyNamespace</code></td>
        <td>61% (19/31)</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:61%;background:var(--orange)"></div></div></td>
        <td>12 modules</td>
    </tr>
    <tr>
        <td>Lazy imports</td>
        <td>48% (15/31)</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:48%;background:var(--red)"></div></div></td>
        <td>16 modules</td>
    </tr>
    <tr>
        <td><code>@cached_fragment</code></td>
        <td>6% (2/31)</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:6%;background:var(--red)"></div></div></td>
        <td>29 modules</td>
    </tr>
    <tr>
        <td><code>BaseModule</code></td>
        <td>6% (2/31)</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:6%;background:var(--red)"></div></div></td>
        <td>29 modules</td>
    </tr>
</table>

<div class="alert alert-critical">
    <strong>üö® CRITIQUE : planning/cockpit_familial.py</strong>
    Le SEUL module navigu√© qui manque TOUS les patterns (pas de @profiler_rerun, pas d'error_boundary, pas de KeyNamespace). 336 LOC compl√®tement nus. N√©cessite une mise √† niveau imm√©diate.
</div>

<h3>4.3 Modules orphelins (7 modules, ~5 322 LOC)</h3>
<div class="alert alert-warning">
    <strong>‚ö†Ô∏è 7 modules avec app() mais NON dans la navigation</strong>
    <p>Ces modules repr√©sentent ~13% du code modules et sont inaccessibles aux utilisateurs :</p>
</div>
<table>
    <tr><th>Module orphelin</th><th>LOC</th><th>Raison probable</th></tr>
    <tr><td><code>famille/activites</code></td><td>~450</td><td>Remplac√© par hub_famille?</td></tr>
    <tr><td><code>famille/routines</code></td><td>~370</td><td>Remplac√© par hub_famille?</td></tr>
    <tr><td><code>maison/eco_tips</code></td><td>~720</td><td>Cr√©√© Phase 5 mais non rout√©</td></tr>
    <tr><td><code>maison/energie</code></td><td>~744</td><td>Cr√©√© Phase 5 mais non rout√©</td></tr>
    <tr><td><code>maison/meubles</code></td><td>~440</td><td>Cr√©√© Phase 5 mais non rout√©</td></tr>
    <tr><td><code>maison/projets</code></td><td>~480</td><td>Cr√©√© Phase 5, dans la navigation mais orphelin dans les faits</td></tr>
    <tr><td><code>maison/jardin_zones</code></td><td>~300</td><td>Sous-module de jardin non rout√©</td></tr>
</table>

<h3>4.4 Fichiers legacy √† supprimer (~1 904 LOC)</h3>
<table>
    <tr><th>Fichier</th><th>LOC</th><th>Description</th></tr>
    <tr><td><code>maison/eco_tips/__init__old.py</code></td><td>720</td><td>Ancienne version avant refactoring</td></tr>
    <tr><td><code>maison/energie/__init__old.py</code></td><td>744</td><td>Ancienne version avant refactoring</td></tr>
    <tr><td><code>maison/meubles/__init__old.py</code></td><td>440</td><td>Ancienne version avant refactoring</td></tr>
</table>

<h3>4.5 Fichiers monolithiques (&gt;400 LOC)</h3>
<p><strong>20 fichiers</strong> d√©passent 400 LOC, totalisant ~10 213 LOC (24% du code modules dans 9% des fichiers).</p>
<details>
<summary>Voir les 10 plus gros fichiers</summary>
<div class="content">
<table>
    <tr><th>Fichier</th><th>LOC</th><th>Action recommand√©e</th></tr>
    <tr><td>maison/entretien/onglets_core.py</td><td>680</td><td>Extraire mutations en helpers</td></tr>
    <tr><td>cuisine/planificateur_repas/__init__.py</td><td>620</td><td>Diviser en onglets</td></tr>
    <tr><td>maison/jardin/onglets_culture.py</td><td>580</td><td>Extraire helpers de culture</td></tr>
    <tr><td>famille/suivi_perso/tableau_bord.py</td><td>560</td><td>Extraire graphiques</td></tr>
    <tr><td>jeux/paris/__init__.py</td><td>540</td><td>Diviser en onglets</td></tr>
    <tr><td>cuisine/inventaire/__init__.py</td><td>520</td><td>Extraire UI stock</td></tr>
    <tr><td>jeux/loto/__init__.py</td><td>510</td><td>Diviser en onglets</td></tr>
    <tr><td>famille/jules/__init__.py</td><td>480</td><td>Extraire widgets Jules</td></tr>
    <tr><td>maison/charges/onglets.py</td><td>460</td><td>Extraire graphiques budget</td></tr>
    <tr><td>cuisine/recettes/detail.py</td><td>450</td><td>Extraire actions recette</td></tr>
</table>
</div>
</details>

<h3>4.6 Services inline √† d√©placer vers src/services/</h3>
<table>
    <tr><th>Classe inline</th><th>Fichier module</th><th>Destination</th></tr>
    <tr><td><code>EntretienService</code></td><td>maison/entretien/</td><td><code>src/services/maison/</code> (existe d√©j√†!)</td></tr>
    <tr><td><code>JardinService</code></td><td>maison/jardin/</td><td><code>src/services/maison/</code> (existe d√©j√†!)</td></tr>
    <tr><td><code>ProjetsService</code></td><td>maison/projets/</td><td><code>src/services/maison/</code> (existe d√©j√†!)</td></tr>
</table>
<p>Note : ces 3 services existent AUSSI dans <code>src/services/maison/</code>. Il s'agit potentiellement de doublons ‚Äî v√©rifier si les modules les utilisent directement ou via le service registry.</p>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 5. SERVICES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="services">
<h2>5. src/services/ ‚Äî Couche services (210 fichiers, 41 505 LOC)</h2>

<h3>5.1 Inventaire des sous-packages</h3>
<table>
    <tr><th>Package</th><th>Fichiers</th><th>LOC</th><th>Services</th><th>Mixins</th></tr>
    <tr><td><code>core/</code></td><td>50</td><td>9 117</td><td>14</td><td>12</td></tr>
    <tr><td><code>cuisine/</code></td><td>54</td><td>9 936</td><td>11</td><td>10</td></tr>
    <tr><td><code>famille/</code></td><td>26</td><td>5 384</td><td>13</td><td>5</td></tr>
    <tr><td><code>integrations/</code></td><td>32</td><td>5 939</td><td>5</td><td>1</td></tr>
    <tr><td><code>jeux/</code></td><td>19</td><td>5 289</td><td>12</td><td>3</td></tr>
    <tr><td><code>maison/</code></td><td>13</td><td>2 947</td><td>5</td><td>4</td></tr>
    <tr><td><code>rapports/</code></td><td>7</td><td>1 684</td><td>2</td><td>3</td></tr>
    <tr><td><code>inventaire/</code></td><td>7</td><td>1 137</td><td>1</td><td>4</td></tr>
    <tr><td>Root</td><td>2</td><td>72</td><td>1</td><td>0</td></tr>
    <tr><td><strong>TOTAL</strong></td><td><strong>210</strong></td><td><strong>41 505</strong></td><td><strong>~64</strong></td><td><strong>~42</strong></td></tr>
</table>

<h3>5.2 Adoption des patterns par les 57 services m√©tier</h3>
<table>
    <tr><th>Pattern</th><th>Count</th><th>%</th><th>Barre</th></tr>
    <tr>
        <td><code>@service_factory</code></td>
        <td>53/57</td>
        <td>93%</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:93%;background:var(--green)"></div></div></td>
    </tr>
    <tr>
        <td><code>@avec_session_db</code></td>
        <td>~40/57</td>
        <td>70%</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:70%;background:var(--green)"></div></div></td>
    </tr>
    <tr>
        <td><code>@avec_cache</code></td>
        <td>~30/57</td>
        <td>53%</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:53%;background:var(--orange)"></div></div></td>
    </tr>
    <tr>
        <td>Emits events</td>
        <td>20/57</td>
        <td>35%</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:35%;background:var(--red)"></div></div></td>
    </tr>
    <tr>
        <td><code>BaseAIService</code></td>
        <td>16/57</td>
        <td>28%</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:28%;background:var(--blue)"></div></div></td>
    </tr>
    <tr>
        <td><code>BaseService[T]</code></td>
        <td>15/57</td>
        <td>26%</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:26%;background:var(--blue)"></div></div></td>
    </tr>
    <tr>
        <td><code>@avec_resilience</code></td>
        <td>12/57</td>
        <td>21%</td>
        <td><div class="progress-bar"><div class="progress-fill" style="width:21%;background:var(--orange)"></div></div></td>
    </tr>
</table>

<h3>5.3 Probl√®mes critiques identifi√©s</h3>

<div class="alert alert-critical">
    <strong>üö® Singleton-breaking Session dans __init__</strong>
    <p>6 services acceptent <code>Session</code> dans leur constructeur, ce qui est du <strong>dead code trompeur</strong> car <code>@service_factory</code> instancie sans arguments :</p>
    <ul>
        <li><code>SyncService</code>, <code>SeriesService</code> (jeux)</li>
        <li><code>ActionHistoryService</code> (core)</li>
        <li><code>ServiceRecurrence</code>, <code>ServiceRappels</code>, <code>ServiceTemplates</code> (cuisine)</li>
    </ul>
    <p>Impact : Le param√®tre Session est toujours <code>None</code> via factory. Les m√©thodes utilisent le fallback <code>@avec_session_db</code> de toute fa√ßon.</p>
</div>

<div class="alert alert-critical">
    <strong>üö® Appels HTTP sans @avec_resilience</strong>
    <ul>
        <li><code>integrations/images/providers.py</code> ‚Äî 7 fonctions <code>requests.get/post</code> bruts (Pexels, Pixabay, Unsplash, Leonardo, HuggingFace, Pollinations, Replicate)</li>
        <li><code>core/notifications/notif_web_persistence.py</code> ‚Äî Appels Supabase REST sans protection</li>
    </ul>
</div>

<div class="alert alert-warning">
    <strong>‚ö†Ô∏è Protocols PEP 544 jamais utilis√©s (144 LOC dead)</strong>
    <p><code>protocols.py</code> d√©finit 6 protocols <code>@runtime_checkable</code> mais z√©ro <code>isinstance()</code> dans tout le codebase.</p>
</div>

<h3>5.4 Noms de classe dupliqu√©s</h3>
<table>
    <tr><th>Classe</th><th>Fichier 1</th><th>Fichier 2</th><th>Risque</th></tr>
    <tr><td><code>PlanningAnalysisMixin</code></td><td>planning/analysis.py</td><td>planning/global_analysis.py</td><td><span class="badge badge-red">Shadowing</span></td></tr>
    <tr><td><code>PredictionService</code></td><td>suggestions/predictions.py</td><td>jeux/prediction_service.py</td><td><span class="badge badge-orange">Confusion</span></td></tr>
</table>

<h3>5.5 Service sans registration</h3>
<p><code>ServicePlanningUnifie</code> dans <code>global_planning.py</code> : d√©finit un service mais n'a <strong>pas de <code>@service_factory</code></strong>. Service possiblement mort ou migration incompl√®te.</p>

<h3>5.6 Fichiers volumineux (22 fichiers &gt;400 LOC)</h3>
<details>
<summary>Top 10 fichiers services &gt;400 LOC</summary>
<div class="content">
<table>
    <tr><th>Fichier</th><th>LOC</th><th>Action</th></tr>
    <tr><td>cuisine/recettes/utils.py</td><td>542</td><td>Diviser par concern</td></tr>
    <tr><td>cuisine/courses/service.py</td><td>482</td><td>Extraire mixins</td></tr>
    <tr><td>integrations/web/pwa_templates.py</td><td>470</td><td>D√©placer vers static/templates</td></tr>
    <tr><td>jeux/_internal/prediction_service.py</td><td>470</td><td>Extraire schemas dans types.py</td></tr>
    <tr><td>integrations/weather/service.py</td><td>463</td><td>Ok ‚Äî a d√©j√† des mixins</td></tr>
    <tr><td>core/registry.py</td><td>452</td><td>Acceptable (infrastructure)</td></tr>
    <tr><td>jeux/_internal/backtest_service.py</td><td>450</td><td>Extraire types</td></tr>
    <tr><td>core/notifications/utils.py</td><td>448</td><td>Diviser</td></tr>
    <tr><td>maison/entretien_gamification_mixin.py</td><td>448</td><td>Surveiller</td></tr>
    <tr><td>cuisine/suggestions/service.py</td><td>445</td><td>Large mais d√©j√† BaseAIService</td></tr>
</table>
</div>
</details>

<h3>5.7 Gap d'adoption Event Bus</h3>
<p>Seuls 35% des services √©mettent des √©v√©nements. Services qui font du CRUD mais n'√©mettent pas :</p>
<table>
    <tr><th>Service</th><th>CRUD?</th><th>Events?</th></tr>
    <tr><td><code>BarcodeService</code></td><td>‚úÖ articles</td><td><span class="cross">‚úó</span></td></tr>
    <tr><td><code>ServiceJules</code></td><td>‚úÖ enfant</td><td><span class="cross">‚úó</span></td></tr>
    <tr><td><code>CalendarSyncService</code></td><td>‚úÖ events</td><td><span class="cross">‚úó</span></td></tr>
    <tr><td><code>ServiceTemplates</code></td><td>‚úÖ templates</td><td><span class="cross">‚úó</span></td></tr>
</table>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 6. UI ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="ui">
<h2>6. src/ui/ ‚Äî Couche pr√©sentation (72 fichiers, 12 492 LOC)</h2>

<h3>6.1 Architecture des sous-packages</h3>
<table>
    <tr><th>Package</th><th>Fichiers</th><th>LOC</th><th>R√¥le</th></tr>
    <tr><td><code>components/</code></td><td>25</td><td>5 580</td><td>Composants r√©utilisables (atoms, charts, data, forms, etc.)</td></tr>
    <tr><td>Top-level</td><td>10</td><td>1 838</td><td>Tokens, th√®me, a11y, fragments, keys, animations, registry</td></tr>
    <tr><td><code>views/</code></td><td>11</td><td>1 366</td><td>Vues auth, design system, import, m√©t√©o, notifs, PWA, sync</td></tr>
    <tr><td><code>tablet/</code></td><td>6</td><td>989</td><td>Mode tablette/cuisine, timer, styles</td></tr>
    <tr><td><code>feedback/</code></td><td>5</td><td>686</td><td>Spinners, toasts, progress, results</td></tr>
    <tr><td><code>state/</code></td><td>2</td><td>441</td><td>URLState, tabs_with_url, selectbox_with_url</td></tr>
    <tr><td><code>grid/</code></td><td>1</td><td>409</td><td>Row, Grid, Stack, layouts</td></tr>
    <tr><td><code>engine/</code></td><td>2</td><td>394</td><td>CSSEngine (session-scoped, dedup par hash)</td></tr>
    <tr><td><code>layout/</code></td><td>6</td><td>363</td><td>Initialisation, header, footer, styles</td></tr>
    <tr><td><code>testing/</code></td><td>2</td><td>248</td><td>SnapshotTester, visual regression</td></tr>
    <tr><td><code>integrations/</code></td><td>2</td><td>178</td><td>Google Calendar UI</td></tr>
</table>

<h3>6.2 Design System ‚Äî √âvaluation</h3>
<table>
    <tr><th>Aspect</th><th>Rating</th><th>D√©tail</th></tr>
    <tr><td>Token system</td><td><span class="badge badge-green">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span></td><td>3 tiers (primitif ‚Üí s√©mantique ‚Üí th√®me), dark mode cascade</td></tr>
    <tr><td>CSS Engine</td><td><span class="badge badge-green">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span></td><td>Session-scoped, dedup par hash, batch injection. Risque ClassVar √©limin√©.</td></tr>
    <tr><td>Accessibilit√©</td><td><span class="badge badge-green">‚≠ê‚≠ê‚≠ê‚≠ê</span></td><td>A11y.py (WCAG 2.1), ARIA, reduced-motion. Manque skip-link rendu + CI.</td></tr>
    <tr><td>Fragment system</td><td><span class="badge badge-green">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span></td><td>5 patterns + FragmentGroup, graceful fallbacks</td></tr>
    <tr><td>Component registry</td><td><span class="badge badge-orange">‚≠ê‚≠ê‚≠ê</span></td><td>22/70+ fonctions d√©cor√©es (~30%)</td></tr>
    <tr><td>Lazy loading</td><td><span class="badge badge-green">‚≠ê‚≠ê‚≠ê‚≠ê</span></td><td>PEP 562 <code>__getattr__</code> avec 130+ symboles. 9 symboles cass√©s.</td></tr>
    <tr><td>Documentation</td><td><span class="badge badge-orange">‚≠ê‚≠ê‚≠ê</span></td><td>3 docs, mais r√©f√©rences obsol√®tes (progress.py, A11y.aria, Modale)</td></tr>
</table>

<h3>6.3 Bugs critiques UI</h3>
<div class="alert alert-critical">
    <strong>üö® Imports paresseux cass√©s (9 symboles)</strong>
    <p>Dans <code>ui/__init__.py</code>, les mappings Layouts pointent vers <code>.layouts</code> qui <strong>n'existe pas</strong> (le vrai module est <code>.grid</code>) :</p>
    <ul>
        <li><code>Row</code>, <code>Grid</code>, <code>Stack</code>, <code>Gap</code>, <code>two_columns</code>, <code>three_columns</code>, <code>metrics_row</code>, <code>card_grid</code> ‚Üí <code>ModuleNotFoundError</code></li>
        <li><code>sidebar_main</code> ‚Üí n'existe nulle part (le vrai nom est <code>sidebar_layout</code>)</li>
    </ul>
</div>

<h3>6.4 Composants non d√©cor√©s (@composant_ui manquants)</h3>
<p>Sur ~70+ fonctions export√©es, seules 22 ont le d√©corateur <code>@composant_ui</code>. Non d√©cor√©s notables :</p>
<ul>
    <li>Tous: <code>filters.py</code>, <code>forms.py</code>, <code>data.py</code>, <code>data_editors.py</code>, <code>metrics_row.py</code></li>
    <li><code>chat_global.py</code>, <code>mode_focus.py</code>, <code>notifications_live.py</code>, <code>progressive_loading.py</code></li>
    <li><code>jules_aujourdhui.py</code>, <code>quest_ce_quon_mange.py</code>, <code>historique_undo.py</code>, <code>gamification_widget.py</code></li>
</ul>

<h3>6.5 Dead code UI</h3>
<table>
    <tr><th>√âl√©ment</th><th>Fichier</th><th>LOC</th><th>Statut</th></tr>
    <tr><td><code>Modale</code> class</td><td>dynamic.py</td><td>~80</td><td><span class="badge badge-orange">DEPRECATED</span> mais encore export√©</td></tr>
    <tr><td><code>afficher_sidebar()</code></td><td>sidebar.py</td><td>~24</td><td><span class="badge badge-orange">DEPRECATED</span> stub</td></tr>
    <tr><td><code>MODULES_MENU</code></td><td>sidebar.py</td><td>1</td><td>Dict vide <code>{}</code>, dead</td></tr>
    <tr><td><code>design_system.py</code> view</td><td>views/</td><td>154</td><td>Non export√© dans <code>views/__init__.py</code></td></tr>
    <tr><td><code>CSSManager</code> / <code>StyleSheet</code></td><td>css.py</td><td>2</td><td>Aliases backward-compat</td></tr>
</table>

<h3>6.6 Keyframes dupliqu√©s</h3>
<p>Les keyframes (<code>fadeIn</code>, <code>slideUp</code>, <code>shimmer</code>, <code>pulse</code>, <code>spin</code>) sont d√©finis dans <strong>deux endroits</strong> :</p>
<ul>
    <li><code>animations.py</code> ‚Äî bloc CSS brut <code>_ANIMATION_CSS</code></li>
    <li><code>engine/css.py</code> ‚Äî via <code>CSSEngine.register_keyframes()</code></li>
</ul>
<p>Les deux sont inject√©s au d√©marrage. CSSEngine d√©duplique par hash, mais c'est une redondance source.</p>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 7. ROADMAP v7 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="roadmap">
<h2>7. Comparaison ROADMAP v7</h2>

<p>La ROADMAP v7 (1 080 lignes, mise √† jour 26 f√©vrier 2026) documente 10 phases d'audit + 5 sprints de francisation. Voici l'√©valuation de leur impl√©mentation r√©elle.</p>

<h3>7.1 Phases d'audit ‚Äî Statut r√©el</h3>
<table>
    <tr><th>Phase</th><th>Titre</th><th>ROADMAP</th><th>R√©alit√©</th><th>Verdict</th></tr>
    <tr>
        <td>Phase 1</td>
        <td>Corrections critiques</td>
        <td>‚úÖ 5/5</td>
        <td>Persistence maison/ en DB, ServiceSuggestions ‚Üí BaseAI, JWT fix, /metrics prot√©g√©, tests</td>
        <td><span class="badge badge-green">Confirm√© ‚úÖ</span></td>
    </tr>
    <tr>
        <td>Phase 2</td>
        <td>Homog√©n√©isation patterns</td>
        <td>‚úÖ 5/5</td>
        <td>KeyNamespace d√©ploy√© (61%), tabs_with_url (68%), BaseService migration partielle</td>
        <td><span class="badge badge-orange">Partiel ‚ö†Ô∏è</span></td>
    </tr>
    <tr>
        <td>Phase 3</td>
        <td>Robustesse modules</td>
        <td>‚úÖ 28 modules</td>
        <td>error_boundary 97%, @profiler_rerun 97%. cockpit_familial manquant.</td>
        <td><span class="badge badge-green">Quasi-complet ‚úÖ</span></td>
    </tr>
    <tr>
        <td>Phase 4</td>
        <td>Nettoyage & documentation</td>
        <td>‚úÖ 5/5</td>
        <td>BaseModule pilote (2 modules), @composant_ui ajout√©s (22 total), docs cr√©√©s, mixins timestamps</td>
        <td><span class="badge badge-green">Confirm√© ‚úÖ</span></td>
    </tr>
    <tr>
        <td>Phase 5</td>
        <td>Modules manquants</td>
        <td>‚úÖ 5/5</td>
        <td>4 modules cr√©√©s (eco_tips, energie, meubles, projets) mais 3 sont <strong>ORPHELINS</strong> (non rout√©s)</td>
        <td><span class="badge badge-orange">Code OK, routing ‚ö†Ô∏è</span></td>
    </tr>
    <tr>
        <td>Phase 6</td>
        <td>Innovations Streamlit</td>
        <td>‚úÖ 6/6</td>
        <td>st.write_stream OK, @st.dialog OK, @auto_refresh OK, deep linking OK, chat IA OK, Specification supprim√© (dead)</td>
        <td><span class="badge badge-green">Confirm√© ‚úÖ</span></td>
    </tr>
    <tr>
        <td>Phase 7</td>
        <td>Production Hardening</td>
        <td>‚úÖ 7/7</td>
        <td>Security headers, ETag, Sentry, SW PWA, structured logging, CI/CD ‚Äî tous v√©rifi√©s</td>
        <td><span class="badge badge-green">Confirm√© ‚úÖ</span></td>
    </tr>
    <tr>
        <td>Phase 10</td>
        <td>Tests & Scalabilit√©</td>
        <td>‚úÖ 5/5</td>
        <td>Circuit breaker async fix, ETag 304, 4 BaseService[T] migr√©s, Redis cache, stats</td>
        <td><span class="badge badge-green">Confirm√© ‚úÖ</span></td>
    </tr>
    <tr>
        <td>Sprint 5</td>
        <td>Francisation compl√®te</td>
        <td>‚úÖ 5 sous-sprints</td>
        <td>45 classes renomm√©es, 34 tables, 95 SQL tables en fran√ßais, 14 √©v√©nements typ√©s</td>
        <td><span class="badge badge-green">Confirm√© ‚úÖ</span></td>
    </tr>
    <tr>
        <td>Rationalisation</td>
        <td>Dead patterns</td>
        <td>‚úÖ 8 supprim√©s</td>
        <td>Result, Repository, Specification, UoW, IoC, Middleware, CQRS, UI v2 ‚Äî tous v√©rifi√©s supprim√©s</td>
        <td><span class="badge badge-green">Confirm√© ‚úÖ</span></td>
    </tr>
</table>

<h3>7.2 Items restants de la ROADMAP</h3>
<table>
    <tr><th>Priorit√©</th><th>Item</th><th>Statut r√©el</th></tr>
    <tr>
        <td><span class="badge badge-red">HAUTE</span></td>
        <td>322 tests skipp√©s (modules maison non impl√©ment√©s)</td>
        <td>Modules cr√©√©s (eco_tips, energie, meubles) mais tests toujours skipp√©s car modules non rout√©s dans navigation ‚Üí inaccessibles</td>
    </tr>
    <tr>
        <td><span class="badge badge-red">HAUTE</span></td>
        <td>Coverage fichiers √† 0%</td>
        <td>Partiellement r√©solu : resilience (0‚Üí95%), observability (0‚Üí98%). Restent : barcode.py, rapports/generation.py, plan_jardin.py</td>
    </tr>
    <tr>
        <td><span class="badge badge-red">HAUTE</span></td>
        <td>D√©ployer SQL Supabase</td>
        <td>Non v√©rifiable depuis le code ‚Äî probablement fait manuellement</td>
    </tr>
    <tr>
        <td><span class="badge badge-orange">MOYENNE</span></td>
        <td>Activer Redis en production</td>
        <td>Code impl√©ment√© (<code>CacheRedis</code>, <code>REDIS_URL</code> dans settings). Activation d√©pend de l'infrastructure.</td>
    </tr>
    <tr>
        <td><span class="badge badge-orange">MOYENNE</span></td>
        <td>Lazy load images recettes</td>
        <td><span class="badge badge-green">Fait</span> ‚Äî <code>loading="lazy" decoding="async"</code> sur <code>&lt;img&gt;</code></td>
    </tr>
    <tr>
        <td><span class="badge badge-orange">MOYENNE</span></td>
        <td>Sentry integration</td>
        <td><span class="badge badge-green">Fait</span> ‚Äî <code>core/monitoring/sentry.py</code> (351 LOC) + bootstrap</td>
    </tr>
    <tr>
        <td><span class="badge badge-blue">BASSE</span></td>
        <td>Reconnaissance vocale</td>
        <td>Non impl√©ment√©</td>
    </tr>
    <tr>
        <td><span class="badge badge-blue">BASSE</span></td>
        <td>Mode hors-ligne (SW)</td>
        <td><span class="badge badge-green">Fait</span> ‚Äî <code>static/sw.js</code> (249 LOC)</td>
    </tr>
    <tr>
        <td><span class="badge badge-blue">BASSE</span></td>
        <td>Multi-famille</td>
        <td>Non impl√©ment√©</td>
    </tr>
</table>

<h3>7.3 M√©triques ROADMAP vs R√©alit√©</h3>
<table>
    <tr><th>M√©trique</th><th>ROADMAP v7</th><th>Audit r√©el</th><th>Delta</th></tr>
    <tr><td>Tests collect√©s</td><td>8 150</td><td>8 150</td><td><span class="badge badge-green">= Match</span></td></tr>
    <tr><td>Tests pass√©s</td><td>8 045</td><td>8 045</td><td><span class="badge badge-green">= Match</span></td></tr>
    <tr><td>Tests √©chec</td><td>48</td><td>48</td><td><span class="badge badge-green">= Match</span></td></tr>
    <tr><td>Tests skipp√©s</td><td>31</td><td>31</td><td><span class="badge badge-green">= Match</span></td></tr>
    <tr><td>Tables SQL</td><td>95</td><td>84 mod√®les ORM + tables SQL-only</td><td><span class="badge badge-blue">Coh√©rent</span></td></tr>
    <tr><td>Nommage FR</td><td>100%</td><td>~98% (4 fonctions EN restantes)</td><td><span class="badge badge-orange">Quasi 100%</span></td></tr>
    <tr><td>√âv√©nements typ√©s</td><td>14</td><td>14</td><td><span class="badge badge-green">= Match</span></td></tr>
    <tr><td>Services</td><td>30+</td><td>64</td><td><span class="badge badge-green">D√©passe</span></td></tr>
    <tr><td>N+1 corrig√©s</td><td>18/18</td><td>18/18</td><td><span class="badge badge-green">= Match</span></td></tr>
    <tr><td>Lint issues</td><td>0</td><td>0</td><td><span class="badge badge-green">= Match</span></td></tr>
</table>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 8. COMPLETENESS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="completeness">
<h2>8. √âvaluation de compl√©tude</h2>

<h3>8.1 Couverture fonctionnelle</h3>
<table>
    <tr><th>Domaine</th><th>Modules</th><th>Services</th><th>Mod√®les</th><th>Compl√©tude</th></tr>
    <tr><td>üçΩÔ∏è Cuisine</td><td>5 modules</td><td>11 services</td><td>9 mod√®les</td><td><span class="badge badge-green">95%</span></td></tr>
    <tr><td>üë®‚Äçüë©‚Äçüë¶ Famille</td><td>7 modules</td><td>13 services</td><td>7 mod√®les</td><td><span class="badge badge-green">90%</span></td></tr>
    <tr><td>üè† Maison</td><td>8 modules (3 orphelins)</td><td>5 services</td><td>13 mod√®les</td><td><span class="badge badge-orange">75%</span></td></tr>
    <tr><td>üé∞ Jeux</td><td>2 modules</td><td>12 services</td><td>9 mod√®les</td><td><span class="badge badge-green">90%</span></td></tr>
    <tr><td>üìÖ Planning</td><td>2 modules (+1 orphelin)</td><td>8 services cuisine+planning</td><td>3 mod√®les</td><td><span class="badge badge-orange">80%</span></td></tr>
    <tr><td>üîß Utilitaires</td><td>6 modules</td><td>4 services</td><td>4 mod√®les</td><td><span class="badge badge-green">85%</span></td></tr>
    <tr><td>‚öôÔ∏è API</td><td>30 endpoints</td><td>7 routers</td><td>JWT + rate limit</td><td><span class="badge badge-orange">80%</span></td></tr>
    <tr><td>üé® UI Framework</td><td>72 fichiers</td><td>Design System</td><td>3 doc files</td><td><span class="badge badge-green">85%</span></td></tr>
</table>

<h3>8.2 Gap analysis</h3>
<div class="two-col">
<div>
<h4>‚úÖ Points forts</h4>
<ul>
    <li>Architecture 4 couches claire et mature</li>
    <li>8 dead patterns √©limin√©s (~6 000 LOC)</li>
    <li>18 N+1 queries corrig√©s</li>
    <li>95 tables SQL fran√ßis√©es</li>
    <li>Cache multi-niveaux L1‚ÜíL2‚ÜíL3‚ÜíRedis</li>
    <li>64 services avec 93% d'adoption @service_factory</li>
    <li>PWA avec Service Worker + IndexedDB</li>
    <li>CI/CD pipeline complet (lint, test, security, deploy)</li>
    <li>Design System token 3-tier avec dark mode</li>
    <li>8 045/8 150 tests passent</li>
</ul>
</div>
<div>
<h4>‚ùå Lacunes identifi√©es</h4>
<ul>
    <li>3 bugs API inventaire confirm√©s (model mismatch)</li>
    <li>9 imports paresseux UI cass√©s (ModuleNotFoundError)</li>
    <li>7 modules orphelins (~5 322 LOC inaccessibles)</li>
    <li>1 module critique sans aucun pattern (cockpit_familial)</li>
    <li>~2 500 LOC dead code restant toutes couches</li>
    <li>~1 904 LOC legacy __init__old.py √† supprimer</li>
    <li>copilot-instructions.md d√©synchronis√©</li>
    <li>35% seulement des services √©mettent des events</li>
    <li>30% seulement des composants UI d√©cor√©s @composant_ui</li>
    <li>6 services avec Session __init__ dead code</li>
</ul>
</div>
</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 9. INNOVATIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="innovations">
<h2>9. Am√©liorations innovantes Streamlit</h2>

<h3>9.1 Innovations impl√©ment√©es</h3>
<table>
    <tr><th>Innovation</th><th>Impl√©mentation</th><th>Statut</th><th>Impact</th></tr>
    <tr>
        <td><code>st.navigation()</code></td>
        <td><code>construire_pages()</code> dans navigation.py</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Multi-page natif, chargement diff√©r√©</td>
    </tr>
    <tr>
        <td><code>st.write_stream()</code></td>
        <td>jules_ai.py, weekend_ai.py, chat_contextuel.py</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Streaming IA natif</td>
    </tr>
    <tr>
        <td><code>@st.fragment</code></td>
        <td>5 d√©corateurs wrapper (ui_fragment, auto_refresh, isolated, lazy, cached_fragment)</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Isolation re-render, auto-refresh dashboards</td>
    </tr>
    <tr>
        <td><code>@st.dialog</code></td>
        <td>confirm_dialog() remplace Modale</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Modales natives, plus besoin de wrappers</td>
    </tr>
    <tr>
        <td>Deep linking URL</td>
        <td><code>tabs_with_url()</code> dans ui/state/url.py</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>21/31 modules avec tabs URL</td>
    </tr>
    <tr>
        <td>Chat global IA</td>
        <td>chat_global.py + Phase D widgets</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Assistant IA disponible depuis toute page</td>
    </tr>
    <tr>
        <td>Notifications live</td>
        <td>notifications_live.py dans Phase D widgets</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Alertes temps r√©el overlay</td>
    </tr>
    <tr>
        <td>Gamification</td>
        <td>gamification_widget.py + ServiceGamification</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Badges, points, d√©fis dans sidebar</td>
    </tr>
    <tr>
        <td>Mode Focus</td>
        <td>mode_focus.py + is_mode_focus() dans app.py</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Masque header/footer pour immersion</td>
    </tr>
    <tr>
        <td>Mode Tablette/Cuisine</td>
        <td>ui/tablet/ (6 fichiers, 989 LOC)</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>UI optimis√©e touch, timer int√©gr√©</td>
    </tr>
    <tr>
        <td>PWA offline</td>
        <td>static/sw.js + integrations/web/pwa/</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Cache recettes/courses offline, background sync</td>
    </tr>
    <tr>
        <td>Raccourcis clavier</td>
        <td>JS inject√© dans app.py</td>
        <td><span class="badge badge-green">Production</span></td>
        <td>Navigation rapide au clavier</td>
    </tr>
</table>

<h3>9.2 Innovations recommand√©es (non impl√©ment√©es)</h3>
<table>
    <tr><th>Innovation</th><th>Description</th><th>Difficult√©</th><th>Impact</th></tr>
    <tr>
        <td><code>st.connection()</code></td>
        <td>Remplacer le custom engine SQLAlchemy par <code>st.connection("sql")</code> pour caching int√©gr√©</td>
        <td><span class="badge badge-orange">Moyen</span></td>
        <td>Simplification DB + cache natif</td>
    </tr>
    <tr>
        <td>Multipage headless testing</td>
        <td><code>AppTest</code> de Streamlit pour tests E2E des modules sans browser</td>
        <td><span class="badge badge-blue">Faible</span></td>
        <td>Tests UI automatis√©s</td>
    </tr>
    <tr>
        <td><code>st.logo()</code></td>
        <td>Logo natif dans sidebar (Streamlit 1.33+)</td>
        <td><span class="badge badge-blue">Faible</span></td>
        <td>Branding am√©lior√©</td>
    </tr>
    <tr>
        <td><code>st.html()</code> container</td>
        <td>Remplacement des <code>st.markdown(unsafe_allow_html=True)</code> par <code>st.html()</code></td>
        <td><span class="badge badge-blue">Faible</span></td>
        <td>S√©curit√© XSS renforc√©e</td>
    </tr>
    <tr>
        <td>Speech-to-text</td>
        <td>Widget reconnaissance vocale pour ajout rapide (courses, notes)</td>
        <td><span class="badge badge-red">√âlev√©</span></td>
        <td>UX mobile significative</td>
    </tr>
</table>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 10. CONCEPTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="concepts">
<h2>10. V√©rification des concepts</h2>

<p><strong>Objectif</strong> : v√©rifier que les concepts adopt√©s sont correctement utilis√©s (et non supprim√©s √† tort).</p>

<h3>10.1 Concepts correctement adopt√©s</h3>
<table>
    <tr><th>Concept</th><th>Impl√©mentation</th><th>Qualit√©</th></tr>
    <tr><td>Service Factory + Registry</td><td><code>@service_factory</code> (93% adoption), <code>ServiceRegistry</code> singleton</td><td><span class="badge badge-green">Excellent</span></td></tr>
    <tr><td>BaseService[T] generics</td><td>15 services avec CRUD uniforme h√©rit√©</td><td><span class="badge badge-green">Bon</span></td></tr>
    <tr><td>BaseAIService</td><td>16 services IA avec rate limit + cache auto</td><td><span class="badge badge-green">Excellent</span></td></tr>
    <tr><td>Event Bus pub/sub</td><td>14 types d'√©v√©nements, 20 services √©metteurs, wildcards</td><td><span class="badge badge-orange">Bon mais sous-utilis√©</span></td></tr>
    <tr><td>Cache multi-niveaux</td><td>L1 m√©moire ‚Üí L2 session ‚Üí L3 fichier ‚Üí Redis</td><td><span class="badge badge-green">Excellent</span></td></tr>
    <tr><td>Resilience policies</td><td><code>executer()</code> retourne T directement, retry + timeout + circuit breaker</td><td><span class="badge badge-green">Bon</span></td></tr>
    <tr><td>@avec_session_db</td><td>293 usages, context manager auto-commit/rollback</td><td><span class="badge badge-green">Excellent</span></td></tr>
    <tr><td>Pydantic v2 schemas</td><td>Validation API + config, ~31 fichiers schemas</td><td><span class="badge badge-green">Bon</span></td></tr>
    <tr><td>PEP 562 lazy loading</td><td><code>__getattr__</code> dans ui/, core/, navigation module cache</td><td><span class="badge badge-green">Bon</span></td></tr>
    <tr><td>Fragment isolation</td><td>5 decorators + FragmentGroup + graceful fallback</td><td><span class="badge badge-green">Excellent</span></td></tr>
    <tr><td>Design tokens 3-tier</td><td>Primitif ‚Üí S√©mantique ‚Üí Th√®me avec dark mode</td><td><span class="badge badge-green">Excellent</span></td></tr>
    <tr><td>KeyNamespace</td><td>19/31 modules, collision prevention</td><td><span class="badge badge-orange">Bon mais incomplet</span></td></tr>
</table>

<h3>10.2 Concepts correctement supprim√©s (v7 rationalisation)</h3>
<table>
    <tr><th>Concept supprim√©</th><th>Raison</th><th>Verdict</th></tr>
    <tr><td>Result Monad</td><td>0 callers production, over-engineering</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
    <tr><td>Repository Pattern</td><td>SQLAlchemy ORM suffit, @avec_session_db direct</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
    <tr><td>Specification Pattern</td><td>Cr√©√© Phase 6, supprim√© car jamais utilis√©</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
    <tr><td>Unit of Work</td><td>@avec_session_db g√®re d√©j√† le commit/rollback</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
    <tr><td>IoC Container</td><td>@service_factory + registre suffisent</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
    <tr><td>Middleware Pipeline</td><td>@avec_resilience remplace</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
    <tr><td>CQRS</td><td>Inutile en app single-user Streamlit</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
    <tr><td>ReactiveServiceMixin</td><td>0 callers, jamais adopt√©</td><td><span class="badge badge-green">Correct ‚úÖ</span></td></tr>
</table>

<h3>10.3 Concepts √† renforcer</h3>
<table>
    <tr><th>Concept</th><th>Statut actuel</th><th>Action recommand√©e</th></tr>
    <tr><td>Event Bus</td><td>35% des services</td><td>Ajouter √©missions sur BarcodeService, ServiceJules, CalendarSyncService, ServiceTemplates</td></tr>
    <tr><td>@composant_ui</td><td>30% des composants</td><td>D√©corer les ~48 composants restants pour compl√©ter le design system registry</td></tr>
    <tr><td>KeyNamespace</td><td>61% des modules</td><td>Ajouter sur les 12 modules manquants</td></tr>
    <tr><td>tabs_with_url</td><td>68% des modules √† tabs</td><td>Ajouter sur les 10 modules sans deep linking</td></tr>
    <tr><td>BaseModule[T]</td><td>6% (2 modules)</td><td>√âvaluer pertinence de migration progressive ‚Äî optionnel</td></tr>
    <tr><td>@avec_validation</td><td>4 usages</td><td>Ajouter sur les endpoints API et formulaires critiques</td></tr>
</table>

<h3>10.4 Concepts morts √† nettoyer</h3>
<table>
    <tr><th>Concept "vivant" mais mort</th><th>LOC</th><th>Action</th></tr>
    <tr><td><code>@avec_circuit_breaker</code> d√©corateur</td><td>~30</td><td>Supprimer (CircuitBreaker utilis√© directement)</td></tr>
    <tr><td>PEP 544 Protocols (6 protocols)</td><td>144</td><td>Supprimer ou commencer √† utiliser avec isinstance()</td></tr>
    <tr><td>CreatedAtMixin + TimestampFullMixin</td><td>~20</td><td>Supprimer (0 usages, alias EN)</td></tr>
    <tr><td>errors.py (re-export shim)</td><td>~40</td><td>Supprimer (0 importateurs, tout utilise exceptions.py)</td></tr>
    <tr><td>football_compat.py</td><td>240</td><td>Supprimer si callers migr√©s</td></tr>
    <tr><td>notif_web.py shim</td><td>25</td><td>Supprimer quand callers migr√©s</td></tr>
</table>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê 11. RECOMMENDATIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section id="recommendations">
<h2>11. Recommandations prioritaires</h2>

<h3>üî¥ Priorit√© CRITIQUE (impact imm√©diat)</h3>

<div class="alert alert-critical">
    <strong>1. Corriger les 3 bugs API inventaire</strong>
    <ul>
        <li>Aligner <code>InventaireItemCreate</code> avec le mod√®le ORM (<code>ingredient_id</code> au lieu de <code>nom</code>)</li>
        <li>Impl√©menter le PATCH complet dans <code>modifier_article_inventaire</code></li>
        <li>Remplacer la s√©rialisation manuelle par <code>model_validate()</code></li>
    </ul>
</div>

<div class="alert alert-critical">
    <strong>2. Corriger les 9 imports paresseux UI cass√©s</strong>
    <ul>
        <li>Changer <code>".layouts"</code> ‚Üí <code>".grid"</code> dans <code>ui/__init__.py</code></li>
        <li>Renommer <code>sidebar_main</code> ‚Üí <code>sidebar_layout</code></li>
    </ul>
</div>

<div class="alert alert-critical">
    <strong>3. Mettre √† jour cockpit_familial.py</strong>
    <ul>
        <li>Ajouter <code>@profiler_rerun</code>, <code>error_boundary</code>, <code>KeyNamespace</code></li>
    </ul>
</div>

<h3>üü† Priorit√© HAUTE (dette technique)</h3>

<table>
    <tr><th>#</th><th>Action</th><th>Impact</th><th>Effort</th></tr>
    <tr><td>4</td><td>Router les 3 modules maison orphelins (eco_tips, energie, meubles) dans navigation.py</td><td>~5 322 LOC deviennent accessibles</td><td>30 min</td></tr>
    <tr><td>5</td><td>Supprimer les 3 fichiers <code>__init__old.py</code></td><td>-1 904 LOC dead</td><td>5 min</td></tr>
    <tr><td>6</td><td>Supprimer le dead code core (logging.py externe, CreatedAtMixin, errors.py shim, @avec_circuit_breaker)</td><td>-~400 LOC dead</td><td>30 min</td></tr>
    <tr><td>7</td><td>Mettre √† jour <code>.github/copilot-instructions.md</code> (errors_base‚Üíexceptions, 22 fichiers mod√®les)</td><td>DX am√©lior√©e</td><td>15 min</td></tr>
    <tr><td>8</td><td>Supprimer les 6 param√®tres Session dead dans constructeurs services</td><td>Code cleaner</td><td>20 min</td></tr>
    <tr><td>9</td><td>Ajouter <code>@avec_resilience</code> sur les 7 providers images HTTP</td><td>Robustesse API externes</td><td>30 min</td></tr>
    <tr><td>10</td><td>Renommer les 4 fonctions EN restantes dans core/ (format_week_label, etc.)</td><td>Coh√©rence FR 100%</td><td>20 min</td></tr>
</table>

<h3>üü° Priorit√© MOYENNE (qualit√© continue)</h3>

<table>
    <tr><th>#</th><th>Action</th><th>Impact</th></tr>
    <tr><td>11</td><td>Compl√©ter KeyNamespace sur les 12 modules manquants</td><td>Pr√©vention collisions cl√©s</td></tr>
    <tr><td>12</td><td>Ajouter tabs_with_url sur les 10 modules sans deep linking</td><td>UX navigation</td></tr>
    <tr><td>13</td><td>D√©corer les ~48 composants UI manquant @composant_ui</td><td>Design system complet</td></tr>
    <tr><td>14</td><td>Ajouter √©mission d'events sur 4 services CRUD sans events</td><td>R√©activit√© inter-modules</td></tr>
    <tr><td>15</td><td>Diviser les 20 fichiers modules &gt;400 LOC</td><td>Maintenabilit√©</td></tr>
    <tr><td>16</td><td>R√©soudre les noms de classe dupliqu√©s (PlanningAnalysisMixin, PredictionService)</td><td>Clart√©</td></tr>
    <tr><td>17</td><td>Corriger les r√©f√©rences obsol√®tes dans ui/docs/ (progress.py, A11y.aria, error_boundary)</td><td>Documentation fiable</td></tr>
    <tr><td>18</td><td>D√©placer lazy imports vers 16 modules sans imports diff√©r√©s</td><td>Performance d√©marrage</td></tr>
</table>

<h3>üü¢ Priorit√© BASSE (am√©lioration continue)</h3>

<table>
    <tr><th>#</th><th>Action</th></tr>
    <tr><td>19</td><td>Supprimer Modale deprecated + afficher_sidebar stub + MODULES_MENU vide</td></tr>
    <tr><td>20</td><td>Supprimer/consolider les keyframes dupliqu√©s (animations.py vs css.py)</td></tr>
    <tr><td>21</td><td>Exporter ou supprimer views/design_system.py (non accessible actuellement)</td></tr>
    <tr><td>22</td><td>Ajouter skip-to-content link op√©rationnel (CSS existe mais aucun composant ne le rend)</td></tr>
    <tr><td>23</td><td>Enregistrer ServicePlanningUnifie avec @service_factory ou supprimer</td></tr>
    <tr><td>24</td><td>Supprimer protocols.py (6 protocols jamais v√©rifi√©s √† runtime) ou les utiliser</td></tr>
    <tr><td>25</td><td>√âvaluer migration progressive vers BaseModule[T] pour les modules complexes</td></tr>
</table>

<h3>Estimation effort total</h3>
<div class="summary-grid">
    <div class="summary-card">
        <div class="value" style="color:var(--red)">~2h</div>
        <div class="label">Critique (#1-3)</div>
    </div>
    <div class="summary-card">
        <div class="value" style="color:var(--orange)">~3h</div>
        <div class="label">Haute (#4-10)</div>
    </div>
    <div class="summary-card">
        <div class="value" style="color:var(--accent)">~8h</div>
        <div class="label">Moyenne (#11-18)</div>
    </div>
    <div class="summary-card">
        <div class="value" style="color:var(--green)">~4h</div>
        <div class="label">Basse (#19-25)</div>
    </div>
</div>

</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<footer style="text-align:center; padding:3rem 0 2rem; border-top:1px solid var(--border); margin-top:3rem;">
    <p style="color:var(--text-muted); font-size:0.85rem;">
        Rapport d'audit v7 ‚Äî Assistant Matanne<br>
        G√©n√©r√© automatiquement le 26 f√©vrier 2026<br>
        627 fichiers analys√©s &bull; 5 r√©pertoires audit√©s &bull; ~113 800 LOC
    </p>
</footer>

</div>
</body>
</html>
