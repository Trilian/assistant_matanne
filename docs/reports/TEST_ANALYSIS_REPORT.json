{
  "rapport_analyse_tests": {
    "date": "2026-01-29",
    "resumé": {
      "total_fichiers_test": 109,
      "total_fichiers_source": 171,
      "ratio_couverture": "109/171 (63.7%)",
      "fichiers_avec_erreurs": 88,
      "fichiers_avec_erreurs_import": 2
    },
    "répartition_tests_par_répertoire": {
      "tests/core": 15,
      "tests/e2e": 3,
      "tests/integration": 26,
      "tests/logic": 4,
      "tests/services": 24,
      "tests/ui": 13,
      "tests/utils": 23,
      "root": 1
    },
    "répartition_sources_par_domaine": {
      "core": 37,
      "domains": 63,
      "services": 26,
      "ui": 19,
      "utils": 21,
      "api": 3,
      "root": 2
    },
    "erreurs_identifiées": {
      "erreurs_encodage": {
        "total": 88,
        "description": "Erreurs d'encodage UTF-8 (caractères Ã au lieu de é)",
        "fichiers_affectés": [
          "src/domains/famille/ui/sante.py",
          "tests/conftest.py",
          "tests/core/test_action_history.py",
          "tests/core/test_ai_agent_sync.py",
          "tests/core/test_ai_cache.py",
          "tests/core/test_ai_parser.py",
          "tests/core/test_cache.py",
          "tests/core/test_cache_multi.py",
          "tests/core/test_database.py",
          "tests/core/test_errors_base.py",
          "tests/core/test_lazy_loader.py",
          "tests/core/test_parser_ai.py",
          "tests/core/test_performance.py",
          "tests/core/test_performance_optimizations.py",
          "tests/core/test_state.py",
          "tests/e2e/test_e2e.py",
          "tests/e2e/test_e2e_streamlit.py",
          "tests/integration/test_accueil.py",
          "tests/integration/test_courses_module.py",
          "tests/integration/test_famille.py",
          "tests/integration/test_module_cuisine_courses.py",
          "tests/integration/test_module_cuisine_recettes.py",
          "tests/integration/test_module_famille_helpers.py",
          "tests/integration/test_module_maison.py",
          "tests/integration/test_module_maison_helpers.py",
          "tests/integration/test_module_planning_vue_ensemble.py",
          "tests/integration/test_modules_cuisine.py",
          "tests/integration/test_modules_famille.py",
          "tests/integration/test_modules_integration.py",
          "tests/integration/test_modules_maison.py",
          "tests/integration/test_modules_planning.py",
          "tests/integration/test_offline.py",
          "tests/integration/test_parametres.py",
          "tests/integration/test_planning_module.py",
          "tests/integration/test_push_notifications_extended.py",
          "tests/integration/test_pwa.py",
          "tests/integration/test_rapports.py",
          "tests/integration/test_redis_multi_tenant.py",
          "tests/logic/test_all_logic_clean.py",
          "tests/logic/test_all_logic_modules.py",
          "tests/logic/test_logic_modules_pure.py",
          "tests/services/test_api.py",
          "tests/services/test_api_extended.py",
          "tests/services/test_auth.py",
          "tests/services/test_backup.py",
          "tests/services/test_base_service.py",
          "tests/services/test_base_service_unified.py",
          "tests/services/test_budget.py",
          "tests/services/test_calendar_sync.py",
          "tests/services/test_courses.py",
          "tests/services/test_inventaire.py",
          "tests/services/test_inventaire_schemas.py",
          "tests/services/test_io_service.py",
          "tests/services/test_notifications.py",
          "tests/services/test_notifications_pure.py",
          "tests/services/test_notifications_service.py",
          "tests/services/test_planning_unified.py",
          "tests/services/test_predictions.py",
          "tests/services/test_rapports_pdf_service.py",
          "tests/services/test_recettes.py",
          "tests/services/test_services_comprehensive.py",
          "tests/services/test_suggestions_ia_service.py",
          "tests/services/test_weather.py",
          "tests/ui/test_dashboard_widgets.py",
          "tests/ui/test_planning_components.py",
          "tests/ui/test_ui_atoms.py",
          "tests/ui/test_ui_base_form.py",
          "tests/ui/test_ui_components.py",
          "tests/ui/test_ui_data.py",
          "tests/ui/test_ui_forms.py",
          "tests/ui/test_ui_layouts.py",
          "tests/ui/test_ui_progress.py",
          "tests/ui/test_ui_spinners.py",
          "tests/ui/test_ui_tablet_mode.py",
          "tests/ui/test_ui_toasts.py",
          "tests/utils/test_barcode.py",
          "tests/utils/test_camera_scanner.py",
          "tests/utils/test_dates_helpers.py",
          "tests/utils/test_food_helpers.py",
          "tests/utils/test_formatters.py",
          "tests/utils/test_formatters_dates.py",
          "tests/utils/test_formatters_numbers.py",
          "tests/utils/test_formatters_text.py",
          "tests/utils/test_formatters_units.py",
          "tests/utils/test_helpers.py",
          "tests/utils/test_helpers_data.py",
          "tests/utils/test_helpers_stats.py",
          "tests/utils/test_image_recipe_utils.py",
          "tests/utils/test_recipe_import.py",
          "tests/utils/test_suggestions_ia.py",
          "tests/utils/test_utils_and_pydantic_fix.py",
          "tests/utils/test_utils_helpers_extended.py",
          "tests/utils/test_utils_validators.py",
          "tests/utils/test_validators.py",
          "tests/utils/test_validators_common.py",
          "tests/utils/test_validators_food.py",
          "tests/utils/test_validators_pydantic.py"
        ],
        "priorité": "CRITIQUE",
        "impact": "Tous les fichiers de test ont des caractères mal encodés"
      },
      "erreurs_import": {
        "total": 2,
        "description": "Imports de fonctions inexistantes dans les fichiers de logique",
        "détails": [
          {
            "fichier": "tests/integration/test_planning_module.py",
            "ligne_approx": "12",
            "erreur": "ImportError: cannot import name 'render_planning' from 'src.domains.cuisine.logic.planning_logic'",
            "cause": "La fonction render_planning n'existe pas dans planning_logic.py",
            "fichier_source": "src/domains/cuisine/logic/planning_logic.py",
            "disponible": "get_debut_semaine, get_fin_semaine, organiser_repas_par_jour, etc. (pas de fonctions render_*)"
          },
          {
            "fichier": "tests/integration/test_courses_module.py",
            "ligne_approx": "11",
            "erreur": "ImportError: cannot import name 'render_liste_active' from 'src.domains.cuisine.logic.courses'",
            "cause": "Tentative d'importer de 'courses' au lieu de 'courses_logic.py', et les fonctions render_* n'existent pas",
            "fichier_source": "src/domains/cuisine/logic/courses_logic.py",
            "disponible": "filtrer_par_priorite, grouper_par_rayon, calculer_statistiques, etc. (pas de fonctions render_*)"
          }
        ],
        "priorité": "HAUTE",
        "impact": "Ces tests ne peuvent pas s'exécuter"
      }
    },
    "modules_tests_insuffisants": {
      "ratio_faible": [
        {
          "domaine": "logic",
          "fichiers_test": 4,
          "priorité": "MOYENNE",
          "description": "Très peu de tests unitaires pour la logique métier pure"
        },
        {
          "domaine": "e2e",
          "fichiers_test": 3,
          "priorité": "MOYENNE",
          "description": "Très peu de tests end-to-end"
        }
      ],
      "domaines_bien_testés": [
        {
          "domaine": "integration",
          "fichiers_test": 26,
          "description": "Bien couvert avec tests d'intégration"
        },
        {
          "domaine": "services",
          "fichiers_test": 24,
          "description": "Bonne couverture des services"
        }
      ]
    },
    "recommandations": [
      {
        "priorité": 1,
        "action": "Corriger les erreurs d'encodage",
        "détails": "Reconvertir 88 fichiers de Latin-1 vers UTF-8. Utiliser un script batch pour fixer l'encodage."
      },
      {
        "priorité": 2,
        "action": "Corriger les imports manquants",
        "détails": [
          "test_planning_module.py: Vérifier si render_planning doit être déplacé depuis planning.py ou si les tests doivent importer depuis ui/",
          "test_courses_module.py: Corriger l'import pour utiliser courses_logic.py et vérifier les bonnes fonctions à importer"
        ]
      },
      {
        "priorité": 3,
        "action": "Augmenter la couverture des tests logiques",
        "détails": "Ajouter des tests unitaires pour la logique métier pure dans tests/logic/"
      },
      {
        "priorité": 4,
        "action": "Améliorer les tests end-to-end",
        "détails": "Ajouter plus de tests e2e pour les workflows critiques"
      }
    ],
    "statistiques_détaillées": {
      "tests_par_catégorie": {
        "core": "Tests pour la couche fondamentale (config, DB, decorators, AI, etc.)",
        "services": "Tests pour les services métier (recettes, courses, planning, etc.)",
        "ui": "Tests pour les composants d'interface utilisateur",
        "integration": "Tests d'intégration entre modules",
        "logic": "Tests pour la logique métier pure",
        "utils": "Tests pour les utilitaires (formatters, validators, etc.)",
        "e2e": "Tests end-to-end pour les workflows complets"
      },
      "couverture_par_domaine_source": {
        "core": "37 fichiers source - couverture via tests/core (15 fichiers)",
        "domains": "63 fichiers source - couverture dispersée (integration, ui, logic)",
        "services": "26 fichiers source - couverture via tests/services (24 fichiers)",
        "ui": "19 fichiers source - couverture via tests/ui (13 fichiers)",
        "utils": "21 fichiers source - couverture via tests/utils (23 fichiers)"
      }
    }
  }
}
